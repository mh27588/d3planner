Simulator = {};!function(r,n,t,e,o,i,u,a,f){function c(r){var n,t=r.length,o=this,i=0,u=o.i=o.j=0,a=o.S=[];for(t||(r=[t++]);e>i;)a[i]=i++;for(i=0;e>i;i++)a[i]=a[u=m&u+r[i%t]+(n=a[i])],a[u]=n;(o.g=function(r){for(var n,t=0,i=o.i,u=o.j,a=o.S;r--;)n=a[i=m&i+1],t=t*e+a[m&(a[i]=a[u=m&u+n])+(a[u]=n)];return o.i=i,o.j=u,t})(e)}function p(r,n){var t,e=[],o=typeof r;if(n&&"object"==o)for(t in r)try{e.push(p(r[t],n-1))}catch(i){}return e.length?e:"string"==o?r:r+"\x00"}function l(r,n){for(var t,e=r+"",o=0;o<e.length;)n[m&o]=m&(t^=19*n[m&o])+e.charCodeAt(o++);return g(n)}function s(t){try{return h?g(h.randomBytes(e)):(r.crypto.getRandomValues(t=new Uint8Array(e)),g(t))}catch(o){return[+new Date,r,(t=r.navigator)&&t.plugins,r.screen,g(n)]}}function g(r){return String.fromCharCode.apply(0,r)}var h,y=t.pow(e,o),d=t.pow(2,i),v=2*d,m=e-1,j=t["seed"+f]=function(r,i,u){var a=[];i=1==i?{entropy:!0}:i||{};var h=l(p(i.entropy?[r,g(n)]:null==r?s():r,3),a),m=new c(a);return l(g(m.S),n),(i.pass||u||function(r,n,e){return e?(t[f]=r,n):r})(function(){for(var r=m.g(o),n=y,t=0;d>r;)r=(r+t)*e,n*=e,t=m.g(1);for(;r>=v;)r/=2,n/=2,t>>>=1;return(r+t)/n},h,"global"in i?i.global:this==t)};if(l(t[f](),n),u&&u.exports){u.exports=j;try{h=require("crypto")}catch(w){}}else a&&a.amd&&a(function(){return j})}(this,[],Math,256,6,52,"object"==typeof module&&module,"function"==typeof define&&define,"random");!function(){function e(e){this.heap=[],this.map={},this.scoreFn=e}var t=Simulator,h=0;e.prototype.empty=function(){return 0===this.heap.length},e.prototype.size=function(){return this.heap.length},e.prototype.push=function(e){(void 0===e._heapkey||void 0===this.map[e._heapkey])&&(this.heap.push(e),this.siftUp(this.heap.length-1))},e.prototype.top=function(){return this.heap[0]},e.prototype.pop=function(){var e=this.heap[0],t=this.heap.pop();return delete this.map[e._heapkey],delete e._heapkey,this.heap.length&&(this.heap[0]=t,this.siftDown(0)),e},e.prototype.siftUp=function(e){for(var t=this.heap[e],p=this.scoreFn(t);e>0;){var i=Math.floor((e-1)/2),a=this.heap[i];if(this.scoreFn(a)<p)break;this.heap[e]=a,this.map[a._heapkey]=e,e=i}return this.heap[e]=t,void 0===t._heapkey&&(t._heapkey=h++),this.map[t._heapkey]=e,e},e.prototype.siftDown=function(e){for(var t=this.heap[e],p=this.scoreFn(t);2*e+1<this.heap.length;){var i=2*e+1,a=this.heap[i],s=this.scoreFn(a);if(i+1<this.heap.length){var o=this.heap[i+1],n=this.scoreFn(o);s>n&&(a=o,s=n,++i)}if(s>=p)break;this.heap[e]=a,this.map[a._heapkey]=e,e=i}return this.heap[e]=t,void 0===t._heapkey&&(t._heapkey=h++),this.map[t._heapkey]=e,e},e.prototype.remove=function(e){if(void 0!==e._heapkey&&void 0!==this.map[e._heapkey]){var t=this.map[e._heapkey],h=this.heap.pop();delete this.map[e._heapkey],delete e._heapkey,t<this.heap.length&&(this.heap[t]=h,t=this.siftUp(t),this.siftDown(t))}},t.Heap=e}();!function(){function t(t,a){return Math.sqrt(t*t+a*a)}function a(t,a){return t*t+a*a}function i(){this.edges=[],this.pos={x:0,y:0}}function e(){this.pos={x:0,y:0},this.area=0}function r(t,a){"object"==typeof t?(this.x=t.x,this.y=t.y,this.value=t.value):(this.x=t,this.y=a,this.value=0)}function n(t){var a={};return function(){var i=JSON.stringify(Array.prototype.slice.apply(arguments));return i in a||(a[i]=t.apply(this,arguments)),a[i]}}function h(t,a,i){var e=0,r=1;if(a>i){var n=a;a=i,i=n,r=-1}for(var h=.001*(i-a),o=t(a),s=a;i>s;s+=h){var c=Math.min(s+h,i),M=t(c);e+=.5*(M+o)*(c-s),o=M}return r*e}function o(t,a,i){return a*a*Math.acos((t*t+a*a-i*i)/(2*t*a))+i*i*Math.acos((t*t+i*i-a*a)/(2*t*i))-.5*Math.sqrt((-t+a+i)*(t-a+i)*(t+a-i)*(t+a+i))}function s(t,a,i){if(a>i){var e=a;a=i,i=e}return t=Math.abs(t),i-a>t?a*a*Math.PI:t>i+a?0:o(t,a,i)}var c=Simulator;i.prototype.moveTo=function(t,a){this.pos.x=t,this.pos.y=a},i.prototype.lineTo=function(t,a){this.edges.push({x0:this.pos.x,y0:this.pos.y,x1:t,y1:a}),this.pos.x=t,this.pos.y=a},i.prototype.circleTo=function(a,i,e,r,n){this.edges.push({x0:this.pos.x,y0:this.pos.y,x1:a,y1:i,cx:e,cy:r,r:t(e-this.pos.x,r-this.pos.y),circle:n||1}),this.pos.x=a,this.pos.y=i},i.prototype.copy=function(t){if(this.edges.length){t.moveTo(this.edges[0].x0,this.edges[0].y0);for(var a=0;a<this.edges.length;++a){var i=this.edges[a];i.circle?t.circleTo(i.x1,i.y1,i.cx,i.cy,i.circle):t.lineTo(i.x1,i.y1)}return t}},e.prototype.moveTo=function(t,a){this.pos.x=t,this.pos.y=a},e.prototype.lineTo=function(t,a){this.area+=.5*(this.pos.x*a-this.pos.y*t),this.pos.x=t,this.pos.y=a},e.prototype.circleTo=function(t,i,e,r,n){this.area+=.5*(this.pos.x*i-this.pos.y*t);var h=a(e-this.pos.x,r-this.pos.y),o=(this.pos.x-e)*(i-r)-(this.pos.y-r)*(t-e),s=(this.pos.x-e)*(t-e)+(this.pos.y-r)*(i-r),c=Math.atan2(o/h,s/h);(n||1)>0?0>c&&(c+=2*Math.PI):c>0&&(c-=2*Math.PI),this.area+=.5*(c*h-o),this.pos.x=t,this.pos.y=i},r.prototype.line=function(t,a,i,e){var r=Math.atan2(a-this.y,t-this.x),n=Math.atan2(e-this.y,i-this.x),h=n-r;h>Math.PI&&(h-=2*Math.PI),h<-Math.PI&&(h+=2*Math.PI),this.value+=h},r.prototype.circle=function(t,i,e,r,n,h,o){var s=a(t-n,i-h),c=Math.atan2(i-this.y,t-this.x),M=Math.atan2(r-this.y,e-this.x),u=M-c;0>u&&(u+=2*Math.PI),a(n-this.x,h-this.y)<s?0>o&&(u-=2*Math.PI):u>Math.PI&&(u-=2*Math.PI),this.value+=u},i.prototype.intersect=function(i,n,h,o){function s(t,e,r){c?a(t-o.pos.x,e-o.pos.y)>1e-9&&o.circleTo(t,e,i,n,r.value>M?1:-1):(o.moveTo(t,e),c={x:t,y:e,a:r.value})}o||(o=new e);for(var c,M,u=new r(i,n),y=0;y<this.edges.length;++y){var l=this.edges[y],v=new r(u);if(l.circle){u.circle(l.x0,l.y0,l.x1,l.y1,l.cx,l.cy,l.circle);var f=t(l.cx-i,l.cy-n);if(f<h-l.r){s(l.x0,l.y0,v),o.circleTo(l.x1,l.y1,l.cx,l.cy,l.circle),M=u.value;continue}if(f>h+l.r||f<l.r-l)continue;var x=.5*(f*f-h*h+l.r*l.r)/f,p=Math.acos(x/l.r),I=Math.atan2(n-l.cy,i-l.cx),T=Math.atan2(l.y0-l.cy,l.x0-l.cx),P=Math.atan2(l.y1-l.cy,l.x1-l.cx);for(T>P&&(P+=2*Math.PI);I+p>T;)I-=2*Math.PI;for(;T>I+p;)I+=2*Math.PI;for(var m=l.x0,d=l.y0;P>I-p;){var g=Math.max(T,I-p),w=Math.min(P,I+p),b=l.cx+Math.cos(g)*l.r,q=l.cy+Math.sin(g)*l.r,A=l.cx+Math.cos(w)*l.r,O=l.cy+Math.sin(w)*l.r;v.circle(m,d,b,q,l.cx,l.cy,l.circle),s(b,q,v),o.circleTo(A,O,l.cx,l.cy,l.circle),v.circle(b,q,A,O,l.cx,l.cy,l.circle),M=v.value,I+=2*Math.PI,m=A,d=O}}else{u.line(l.x0,l.y0,l.x1,l.y1);var S=t(l.x1-l.x0,l.y1-l.y0),j=(i-l.x0)*(l.y1-l.y0)-(n-l.y0)*(l.x1-l.x0),D=(i-l.x0)*(l.x1-l.x0)+(n-l.y0)*(l.y1-l.y0),J=Math.abs(j)/S;if(J>h)continue;J=Math.sqrt(h*h-J*J);var L=D/S,N=(L-J)/S,k=(L+J)/S;if(N>1||0>k)continue;N=Math.max(0,N),k=Math.min(1,k);var b=l.x0+(l.x1-l.x0)*N,q=l.y0+(l.y1-l.y0)*N,A=l.x0+(l.x1-l.x0)*k,O=l.y0+(l.y1-l.y0)*k;v.line(l.x0,l.y0,b,q),s(b,q,v),o.lineTo(A,O),v.line(b,q,A,O),M=v.value}}return c?(u.value+=c.a,s(c.x,c.y,u)):this.contains(i,n)&&(o.moveTo(i-h,n),o.circleTo(i+h,n,i,n),o.circleTo(i-h,n,i,n)),o},i.prototype.contains=function(t,a){for(var i=0,e=0;e<this.edges.length;++e){var r=this.edges[e];if(r.circle){var n=Math.atan2(r.y0-r.cy,r.x0-r.cx),h=Math.atan2(r.y1-r.cy,r.x1-r.cx);if(r.circle<0){var o=n;n=h,h=o}n>h&&(h+=2*Math.PI);var s=Math.abs(r.cy-a);if(s>r.r)continue;var c=Math.sqrt(r.r*r.r-s*s);if(r.cx-c>t){for(var M=Math.atan2(a-r.cy,-c);n+1e-9>M;)M+=2*Math.PI;for(;M>h+1e-9;)M-=2*Math.PI;M>n+1e-9&&++i}if(r.cx+c>t){for(var M=Math.atan2(a-r.cy,c);n-1e-9>M;)M+=2*Math.PI;for(;M>h-1e-9;)M-=2*Math.PI;M>n-1e-9&&++i}}else{var u=r.x0,y=r.x1,l=r.y0,v=r.y1;if(l>v){var o=l;l=v,v=o,o=u,u=y,y=o}if(l>a+1e-9||a+1e-9>v)continue;if(l>a-1e-9)u>t&&++i;else{var f=u+(y-u)*(a-l)/(v-l);f>t&&++i}}}return!!(1&i)},i.prototype.area=function(){var t=new e;return this.copy(t),t.area},i.prototype.capsule=function(a,i,e,r,n){var h=i-r,o=e-a,s=t(h,o);if(1e-6>s)return this.moveTo(a-n,i),this.circleTo(a+n,i,a,i),void this.circleTo(a-n,i,a,i);var c=n/s;h*=c,o*=c,this.moveTo(a-h,i-o),this.lineTo(e-h,r-o),this.circleTo(e+h,r+o,e,r),this.lineTo(a+h,i+o),this.circleTo(a-h,i-o,a,i)},i.prototype.cone=function(t,a,i,e,r,n){var h=Math.cos(i-.5*e),o=Math.sin(i-.5*e),s=Math.cos(i+.5*e),c=Math.sin(i+.5*e),M=o*n,u=-h*n,y=-c*n,l=s*n,v=t+h*r,f=a+o*r,x=t+s*r,p=a+c*r;this.moveTo(t+M,a+u),this.lineTo(v+M,f+u),n>1e-9&&this.circleTo(v+h*n,f+o*n,v,f),this.circleTo(x+s*n,p+c*n,t,a),n>1e-9&&this.circleTo(x+y,p+l,x,p),this.lineTo(t+y,a+l),n>1e-9&&e<Math.PI-1e-6&&this.circleTo(t+M,a+u,t,a)},i.prototype.lines=function(t,a,i,e,r,n,h){var o=e*(h-1),s=i-.5*o,c=r>n?2*Math.asin(n/r):2*Math.PI,M=t+Math.cos(s)*(r+n),u=a+Math.sin(s)*(r+n);this.moveTo(M,u);for(var y=0;h>y;++y){var l=s+e*y,v=h-1>y?l+e:s+2*Math.PI,f=.5*(v+l),x=v-l,p=t+Math.cos(l)*r,I=a+Math.sin(l)*r;if(c>x){var T=r*Math.sin(.5*x),P=r*Math.cos(.5*x)+Math.sqrt(n*n-T*T);this.circleTo(t+Math.cos(f)*P,a+Math.sin(f)*P,p,I)}else if(v-l<=Math.PI+1e-9){var P=2*n*Math.cos(.5*x)/Math.sin(x),m=l+.5*Math.PI,d=v-.5*Math.PI,g=t+Math.cos(v)*r,w=a+Math.sin(v)*r;this.circleTo(p+Math.cos(m)*n,I+Math.sin(m)*n,p,I),this.lineTo(t+Math.cos(f)*P,a+Math.sin(f)*P),this.lineTo(g+Math.cos(d)*n,w+Math.sin(d)*n)}else{var m=l+.5*Math.PI,d=v-.5*Math.PI,b=Math.cos(m)*n,q=Math.sin(m)*n,A=Math.cos(d)*n,O=Math.sin(d)*n,g=t+Math.cos(v)*r,w=a+Math.sin(v)*r;this.circleTo(p+b,I+q,p,I),this.lineTo(t+b,a+q),this.circleTo(t+A,a+O,t,a),this.lineTo(g+A,w+O)}}this.circleTo(M,u,t+Math.cos(s)*r,a+Math.sin(s)*r)},c.math={},c.math.circleIntersection=s,c.math.circleArea=n(function(t,a,i,e,r){function n(t,a,i){return i>=t+a?2*Math.PI*a:t-a>=i?0:2*Math.acos((t*t+a*a-i*i)/(2*t*a))*a}var c=t,M=a;if(c>M){var u=c;c=M,M=u}if(e||r){if(r){var y=h(function(t){return(n(e,t,i)-n(e,t,r))*s(t,c,M)},Math.max(0,e-i),Math.min(e+i,M+c));return y/(Math.PI*(i*i-r*r))}var y=h(function(t){return n(e,t,i)*s(t,c,M)},Math.max(0,e-i),Math.min(e+i,M+c));return y/(Math.PI*i*i)}var l=M-c;if(l>i)return c*c*Math.PI;var y=c*c*Math.PI*l*l;return y+=h(function(t){return 2*t*o(t,c,M)},l,Math.min(i,M+c)),y/(i*i)}),c.math.slowball=n(function(t,a,i,e){return h(function(i){return s(i,t,a)},i,e)}),c.math.lineArea=n(function(t,a,e,r,n,h,o,s){var c=new i;if(n=(n||0)*Math.PI/180,void 0===e&&(e=0),void 0===r&&(r=e+t+a),!o||1>=o){var M=Math.cos(n),u=Math.sin(n);s=s||0,r+=s,c.capsule(-e+M*s,u*s,-e+M*r,u*r,a)}else c.lines(-e,0,n,h*Math.PI/180,r,a,o);return c.intersect(0,0,t).area}),c.math.lineDistance=n(function(t,a,e,r,n,o,s,c,M){function u(t){var n=new i;return!c||1>=c?n.capsule(-r+l*M,v*M,-r+l*(t+M),v*(t+M),e):n.lines(-r,0,o,s*Math.PI/180,t,e,c),n.intersect(0,0,a).area}function y(a){return 1-Math.pow(1-u(a)/f,t)}o=(o||0)*Math.PI/180,void 0===r&&(r=0),void 0===n&&(n=r+a+e),n=Math.min(n,r+a+e);var l=Math.cos(o),v=Math.sin(o);M=M||0;var f=Math.PI*a*a,x=y(n);return 1e-6>x?void 0:n-h(y,0,n)/x}),c.math.waveOfLight=n(function(t,a,e,r,n,o,s){function c(t){var n=new i;n.capsule(-r,0,-r+t,0,e);var h=new i;return n.intersect(0,0,a,h),Math.max(0,h.area()-h.intersect(-o,0,s).area)}function M(a){return 1-Math.pow(1-c(a)/u,t)}var u=Math.PI*a*a,y=M(n);return 1e-6>y?void 0:{area:c(n),distance:n-h(M,0,n)/y}}),c.math.rollingThunder=n(function(t,a,e,r,n,h,o,s){h=(h||0)*Math.PI/180;var c=new i;c.cone(-r,0,0,h,n,e);var M=new i;c.intersect(0,0,a,M);var u=Math.max(0,M.area()-M.intersect(-o,0,s+e).area);return 1e-6>u?void 0:{area:u,distance:n/2}}),c.math.coneArea=n(function(t,a,e,r,n,h){var o=new i;return h=(h||0)*Math.PI/180,void 0===e&&(e=0),void 0===n&&(n=e+t),o.cone(-e,0,h,(r||90)*Math.PI/180,n,a),o.intersect(0,0,t).area}),c.math.limitedAverage=n(function(t,a,i){if(t>.999)return i;for(var e=Math.pow(1-t,a),r=0,n=1;a>=n;++n)e*=(a-n+1)/n*t/(1-t),r+=e*Math.min(n,i);return r})}();!function(){var t=Simulator;t.initClass={},t.affixes={},t.gems={},t.extend=function(){var t=!1,s=1,e=arguments[0]||{};for("boolean"==typeof e&&(t=e,e=arguments[1]||{},s=2),"object"!=typeof e&&(e={});s<arguments.length;++s){var a=arguments[s];if(null!=a)for(var i in a){var r=e[i],n=a[i];if(e!==n)if(t&&n&&n instanceof Object){var h;h=n instanceof Array?r&&r instanceof Array?r:[]:r&&r instanceof Object?r:{},e[i]=this.extend(t,h,n)}else void 0!==n&&(e[i]=n)}}return e},t.eventQueue=new t.Heap(function(t){return t.time}),t.handlers={},t.after=function(t,s,e){t=Math.ceil(t);var a={time:this.time+t,func:s,data:e,castInfo:this.castInfo()};return this.eventQueue.push(a),a},t.register=function(t,s,e){this.handlers[t]||(this.handlers[t]=[]),this.handlers[t].push({func:s,castInfo:this.newCastInfo(),data:e})},t.unregister=function(t,s){var e=this.handlers[t];if(e)for(var a=0;a<e.length;++a)if(e[a].func===s)return void e.splice(a,1)},t.trigger=function(t,s){var e=[];if(this.handlers[t]){s=s||{},s.time=this.time,s.event=t;for(var a=0;a<this.handlers[t].length;++a){var i=this.handlers[t][a];this.pushCastInfo(i.castInfo),s.data=i.data,e.push(i.func.call(this,s)),this.popCastInfo()}delete s.data,delete s.time,delete s.event}return e},t.removeEvent=function(s){t.eventQueue.remove(s)},t.init=function(s){this.baseStats=s.stats,this.target={},this.params=s.params||{},this.time=0,this.initresource=s.params.startResource,this.target.radius=Math.max(s.params.targetRadius||0,1),this.target.area=Math.PI*Math.pow(this.target.radius,2),this.target.size=s.params.targetSize||0,this.target.count=(s.params.targetCount||0)+(s.params.targetElites||0)+(s.params.targetBosses||0),this.target.count||(this.target.count=1),this.target.distance=s.params.targetDistance||0,this.target.eliteCount=(s.params.targetElites||0)+(s.params.targetBosses||0),this.target.index=this.target.eliteCount,this.target.elite=this.target.eliteCount/this.target.count,this.target.boss=(s.params.targetBosses||0)/this.target.count,this.target.type=s.params.targetType||"",this.target.density=this.target.count/this.target.area,this.target.health=s.params.targetHealth,this.target.maxdr=.95,this.target.mincc=.65,this.target.list=function(s){var e=[];if(s&&void 0!==s.targets&&s.targets<1)return e;for(var a=s&&s.firsttarget||0,i=Math.min(s&&s.targets||t.target.count,t.target.count),r=a>=this.index||a+i<=this.eliteCount?a+i:this.index+i-(this.eliteCount-a),n=Math.min(r,this.eliteCount),h=a;n>h;++h)e.push(h);for(var h=Math.max(a,this.index);r>h;++h)e.push(h);return e},this.target.random=function(s,e,a){for(var i=this.list(a),r=[],n=0;n<i.length;++n)t.random(s+i[n],e,a?a.count:1)&&r.push(i[n]);return r},this.target.next=function(t){if(1===t.targets){if(t.firsttarget){if(t.firsttarget===this.index+this.count-this.eliteCount-1)return;return t.firsttarget+1}return this.eliteCount>=2?1:this.index+1-this.eliteCount}},this.target.elite&&(this.target.maxdr=65,this.target.mincc=.65),this.target.boss&&(this.target.maxdr=70,this.target.mincc=.85),this.priority=s.priority;try{var e={wizard:"sim/wizard",demonhunter:"sim/demonhunter",witchdoctor:"sim/witchdoctor",monk:"sim/monk",barbarian:"sim/barbarian",crusader:"sim/crusader"};importScripts(e[s.stats.charClass])}catch(a){throw a}this.stats=new this.Stats(this.baseStats,this.buffs),this.trigger("init"),this.trigger("update");for(var i in this.affixes)this.stats[i]&&(this.pushCastInfo({triggered:i}),this.affixes[i].call(i,this.stats[i]),this.popCastInfo());for(var i in this.stats.gems)this.gems[i]&&(this.pushCastInfo({triggered:i}),this.gems[i].call(i,this.stats.gems[i]),this.popCastInfo())},t.verbose=!1,t.run=function(s){s=s||36e3;for(var e=this.time;!this.eventQueue.empty()&&this.time<e+1.5*s&&!t.targetDead();){var a=this.eventQueue.pop();this.time=a.time,this.trigger("update"),this.pushCastInfo(a.castInfo),a.data=a.data||{},a.data.time=a.time,a.data.event=a,a.func(a.data),this.popCastInfo()}this.trigger("finish")};var s={};t.random=function(t,e,a,i){void 0===a&&(a=1),i?e*=a:1!==a&&(e=1-Math.pow(1-e,a)),s[t]=(void 0===s[t]?.5:s[t])+e;var r=Math.floor(s[t]);return s[t]-=r,r},t.castInfoStack=[],t.pushCastInfo=function(t){this.castInfoStack.push(t)},t.popCastInfo=function(){this.castInfoStack.pop()},t.castInfo=function(){return this.castInfoStack.length?this.castInfoStack[this.castInfoStack.length-1]:void 0},t.newCastInfo=function(){var t=this.castInfo();return t&&(t=this.extend(!0,{},t),delete t.user),t},t.getCastInfo=function(){for(var t=arguments.length&&arguments[0]===!0?1:0,s=this.castInfoStack.length-1;s>=0;--s)if(this.castInfoStack[s])for(var e=t;e<arguments.length;++e)if(arguments[e]in this.castInfoStack[s])return t?this.castInfoStack[s]:this.castInfoStack[s][arguments[e]]},t.getCastId=function(){return this.getCastInfo("castId")},t.postMessage=function(t){postMessage(t)},onmessage=function(s){"start"===s.data.type&&(t.init(s.data),t.run(),t.postResults())},t.testrun=function(s){t.postMessage=function(s){console.log(t.extend(!0,{},s))},t.init(s),t.run(),t.postResults()},t.listUnion=function(t,s){for(var e=[],a=0,i=0;a<t.length||i<s.length;)t[a]===s[i]?(e.push(t[a++]),++i):i>=s.length||t[a]<s[i]?e.push(t[a++]):e.push(s[i++]);return e},t.listIntersection=function(t,s){for(var e=[],a=0,i=0;a<t.length&&i<s.length;)t[a]===s[i]?(e.push(t[a++]),++i):t[a]<s[i]?++a:++i;return e}}();!function(){function addStat(t,s,i,e){if(i){e||(e=1);var a=statInfo[s];if(a&&a.special&&t.special){if(t.special[s]||(t.special[s]=[]),i instanceof Array)t.special[s].push({percent:i[0]*e}),i=i[0];else if("number"==typeof i)t.special[s].push({percent:i*e});else{if(i.list){for(var r=0;r<i.list.length;++r)addStat(t,s,i.list[r],e);return}var n=Sim.extend({},i);n.percent*=e,t.special[s].push(n),i=void 0===i.elems&&void 0===i.pet&&void 0===i.skills?i.percent:void 0}return void(i&&(a.mult?t[s]=(t[s]||1)*(1+.01*i*e):t[s]=(t[s]||0)+i*e))}if(a&&0==a.args)t[s]=1;else if(a&&void 0!==a.args&&1!=a.args)if(-1==a.args)t[s]=i;else{void 0===t[s]&&(t[s]={});var h=a.argnames||["min","max"];if(a&&a.dr){t[s][h[0]]=100-.01*(100-(t[s][h[0]]||0))*Math.max(0,100-(void 0!==i[0]?i[0]:i[h[0]])*e);for(var r=1;r<a.args;++r)t[s][h[r]]=Math.max(t[s][h[r]]||0,(void 0!==i[r]?i[r]:i[h[r]])*e)}else for(var r=0;r<a.args;++r)t[s][h[r]]=(!a.nostack&&t[s][h[r]]||0)+(void 0!==i[r]?i[r]:i[h[r]])*e}else"number"!=typeof i&&(i=i[0]),void 0===t[s]||a&&a.nostack?t[s]=i*e:a&&a.dr?t[s]=100-.01*(100-t[s])*Math.max(0,100-i*e):t[s]+=i*e}}function Stats(t,s){Sim.extend(!0,this,t),this.status={};for(var i in Sim.target.list())this.status[i]={};for(var i in s){var e=s[i],a=0,r=e.stats;if(e.targets){for(var n in e.targets){var h=e.targets[n].stats;if(h&&this.status[n])for(var d in h)Sim.statusBuffs[d]&&h[d]&&(this.status[n][d]=1);r=r||h,a+=e.targets[n].params.multiply?e.targets[n].stacks:1}a/=Sim.target.count}else a=e.params.multiply?e.stacks:1;if(r)for(var d in r)this.add(d,r[d],a)}for(var d in Sim.statusBuffs)if(this[d]){for(var i in this.status)this.status[i][d]=1;this[d]=Sim.target.count}else{this[d]=0;for(var i in this.status)this.status[d]&&(this[d]+=1)}Sim.trigger("updatestats",{stats:this}),this.finalize(!0)}var Sim=Simulator,elementList={arc:"Arcane",col:"Cold",fir:"Fire",hol:"Holy",lit:"Lightning",phy:"Physical",psn:"Poison"},statInfo={basearmor:{base:!0},baseblock:{base:!0},blockamount:{args:2,base:!0},wpnphy:{args:2,damage:!0},wpnfir:{args:2,damage:!0},wpncol:{args:2,damage:!0},wpnpsn:{args:2,damage:!0},wpnarc:{args:2,damage:!0},wpnlit:{args:2,damage:!0},wpnhol:{args:2,damage:!0},damage:{special:!0},dmgmul:{special:!0,mult:!0},dmgtaken:{special:!0},dmgred:{dr:!0},dodge:{dr:!0},edef:{dr:!0},cdr:{dr:!0},rcr:{dr:!0},rcr_ap:{dr:!0},rcr_hatred:{dr:!0},rcr_disc:{dr:!0},rcr_mana:{dr:!0},rcr_fury:{dr:!0},rcr_wrath:{dr:!0},rcr_spirit:{dr:!0},colddef:{dr:!0},nonphys:{dr:!0},bleed:{args:2,argnames:["chance","amount"],dr:!0},resphy:{resist:!0},resfir:{resist:!0},rescol:{resist:!0},respsn:{resist:!0},resarc:{resist:!0},reslit:{resist:!0},hitfear:{dr:!0},hitstun:{dr:!0},hitblind:{dr:!0},hitfreeze:{dr:!0},hitchill:{dr:!0},hitslow:{dr:!0},hitimmobilize:{dr:!0},hitknockback:{dr:!0},rangedef:{dr:!0},meleedef:{dr:!0},ccr:{dr:!0},dura:{args:0},custom:{args:0},shift:{args:-1}};Stats.prototype.filterStatus=function(){for(var t=0;t<arguments.length;++t)if(this[arguments[t]])return Sim.target.count;var s=[];if(!this.status)return s;for(var i in this.status)for(var t=0;t<arguments.length;++t)if(this.status[i][arguments[t]]){s.push(i);break}return s},Stats.prototype.countStatus=function(){for(var t=0;t<arguments.length;++t)if(this[arguments[t]])return Sim.target.count;var s=0;if(!this.status)return s;for(var i in this.status)for(var t=0;t<arguments.length;++t)if(this.status[i][arguments[t]]){s+=1;break}return s},Stats.prototype.addAbsolute=function(t,s){if(this[s]){var i=statInfo[t];this[t]&&i&&i.dr?this[t]=100-.01*(100-this[t])*(100-this[s]):this[t]=(this[t]||0)+this[s]}},Stats.prototype.addPercent=function(t,s,i){var e;if("string"==typeof s){if(!this[s])return;e=this[s]}else{e=0;for(var a=0;a<s.length;++a)this[s[a]]&&(e+=this[s[a]]);if(!e)return}if(void 0===i){if(!this[t])return;i=this[t]}this[t]=(this[t]||0)+.01*i*e},Stats.prototype.add=function(t,s,i,e){addStat(this,t,s,i,e)},Stats.prototype.getValue=function(t){for(var s=this,i=t.split(".");"object"==typeof s&&i.length;)s=s[i.shift()];return s||0},Stats.prototype.execString=function(expr){var self=this;return expr=expr.replace(/[a-z_][a-z0-9_]*(?:\.[a-z_][a-z0-9_]*)*/g,function(t){var s=self.getValue(t);return"number"!=typeof s?"("+JSON.stringify(s)+")":s}),eval(expr)},Stats.prototype.getSpecial=function(t,s,i,e,a){var r=statInfo[t].mult?1:0;if(!this.special[t])return r;for(var n=0;n<this.special[t].length;++n){var h=this.special[t][n];a&&a.indexOf(src)>=0||h.elems&&h.elems.indexOf(s)<0||(void 0===h.pet||h.pet==(i||!1))&&(h.skills&&h.skills.indexOf(e)<0||(statInfo[t].mult?r*=1+.01*h.percent:r+=h.percent))}return r},Stats.prototype.finalize=function(){this.chc=Math.min(75,this.chc),this.addAbsolute("chc","extrachc"),this.chc=Math.min(100,this.chc),this.addAbsolute("str","caldesanns_str"),this.addAbsolute("dex","caldesanns_dex"),this.addAbsolute("int","caldesanns_int"),this.addAbsolute("vit","caldesanns_vit"),this.addPercent("str","str_percent"),this.addPercent("dex","dex_percent"),this.addPercent("int","int_percent"),this.thorns=(this.thorns||0)+(this.firethorns||0),this.addPercent("thorns","vit_to_thorns",this.vit),this.addPercent("thorns","thorns_multiply"),this.addPercent("thorns","thorns_percent"),this.block=Math.min(75,(this.baseblock||0)+(this.block||0)),this.addAbsolute("block","extra_block"),this.addPercent("block","block_percent"),this.block=Math.min(100,this.block),this.calcWeapon=function(t){t.speed+=this.weaponaps||0,t.speed*=1+.01*(this.weaponaps_percent||0);var s=1+.01*(t.damage||0);t.wpnphy.min*=s,t.wpnphy.max*=s,this.wpnphy&&(t.wpnphy.min+=this.wpnphy.min,t.wpnphy.max+=this.wpnphy.max),t.wpnbase=Sim.extend({},t.wpnphy),s=(1+.01*this[this.primary])*(1+.01*(this.damage||0)),t.wpnphy.min*=s,t.wpnphy.max*=s,t.damage=.5*(t.wpnphy.min+t.wpnphy.max),t.speed*=1+.01*this.ias,t.speed=Math.min(t.speed,5),t.dps=t.damage*this.info.critfactor*t.speed,t.dph=t.damage*this.info.critfactor},this.info.offhand&&this.add("ias",15,1,"dualwield"),this.info.critfactor=1+.01*this.chc*(.01*this.chd),this.calcWeapon(this.info.mainhand),this.info.offhand?(this.calcWeapon(this.info.offhand),this.info.aps=2/(1/this.info.mainhand.speed+1/this.info.offhand.speed),this.info.dps=(this.info.mainhand.dph+this.info.offhand.dph)*this.info.aps/2):(this.info.dps=this.info.mainhand.dps,this.info.aps=this.info.mainhand.speed),this.info.maxelem="arc",this.info.elemental=this.dmgarc||0;for(var t in elementList){var s=this["dmg"+t]||0;s>this.info.elemental&&(this.info.maxelem=t,this.info.elemental=s)}this.info.edps=this.info.dps*(1+.01*(this.edmg||0)),this.info.elementaldps=this.info.dps*(1+.01*this.info.elemental),this.info.dph=this.info.dps/this.info.aps,this.info.primary=this[this.primary];this.info.dmgmul=100*((this.dmgmul||1)-1),this["final"]={},this["final"].addbase=1+.01*(this.damage||0)+.01*(this.dmgtaken||0),this["final"].chc=this.chc+(this.chctaken||0);var i=(this.dmgmul||1)*this["final"].addbase/(1+.01*(this.damage||0));switch(i*=(1e4+this["final"].chc*this.chd)/(1e4+this.chc*this.chd),this["final"].dps=this.info.dps*i,this["final"].dph=this.info.dph*i,this["final"].elemdps=this["final"].dps*(1+.01*this.info.elemental),this["final"].elemdph=this["final"].dph*(1+.01*this.info.elemental),this["final"].elemedps=this["final"].elemdps*(1+.01*(this.edmg||0)),this["final"].elemedph=this["final"].elemdph*(1+.01*(this.edmg||0)),this.ms=Math.min(25,this.ms||0)+(this.extrams||0),this.charClass){case"wizard":this.addPercent("apregen","resourcegen"),this.addAbsolute("rcr_ap","rcr");break;case"demonhunter":this.addPercent("hatredregen","resourcegen"),this.addPercent("discregen","resourcegen"),this.addAbsolute("rcr_hatred","rcr"),this.addAbsolute("rcr_disc","rcr");break;case"witchdoctor":this.addPercent("maxmana","maxmana_percent"),this.addPercent("manaregen","manaregen_percent",this.maxmana),this.addPercent("manaregen","resourcegen"),this.addAbsolute("rcr_mana","rcr");break;case"barbarian":this.addPercent("furyregen","resourcegen"),this.addAbsolute("rcr_fury","rcr");break;case"monk":this.spiritregen>0&&this.addPercent("spiritregen","resourcegen"),this.addAbsolute("rcr_spirit","rcr");break;case"crusader":this.addPercent("wrathregen","resourcegen"),this.addAbsolute("rcr_wrath","rcr")}},Sim.addBaseStats=function(t){for(var s in t)addStat(this.baseStats,s,t[s]);Sim.buffsModified=!0},Sim.Stats=Stats}();!function(){function t(t,s,e){t=Math.ceil(t);var a={time:l.time+t,func:s,data:e,castInfo:l.castInfo()};return b.push(a),a}function s(t){b.remove(t)}function e(t,s){var e=l.buffs[t];if(e)return void 0!==s&&e.targets&&(e=e.targets[s]),e}function a(t){var s=l.getBuff(t),e=l.time-(x[t]||0);l.uptimes[t]=(l.uptimes[t]||0)+e*s,x[t]=l.time}function i(t,s){if(t===s)return!0;if(!(t instanceof Object&&s instanceof Object))return!1;for(var e in t){if(t.hasOwnProperty(e)!==s.hasOwnProperty(e))return!1;if(typeof t[e]!=typeof s[e])return!1}for(var e in s){if(t.hasOwnProperty(e)!==s.hasOwnProperty(e))return!1;if(typeof t[e]!=typeof s[e])return!1;if(t[e]instanceof Object){if(!i(t[e],s[e]))return!1}else if(t[e]!==s[e])return!1}return!0}function r(t,s){return t||s?i(t,s):!0}function f(t){return t=t||0,void 0!==I[t]&&(B[t]=Math.min(12*(l.target.maxdr||0),(B[t]||0)+2*(l.time-I[t])),I[t]=void 0),void 0!==C[t]&&(B[t]=Math.max(0,(B[t]||0)-(l.time-C[t])),C[t]=void 0),1-(B[t]||0)/1200}function n(t){I[t||0]=l.time}function u(t){C[t||0]=l.time}function o(t){a(t.id);var r=e(t.id,t.target);if(r){r.stats&&!i(r.stats,{})&&(l.buffsModified=!0),r.params.refresh&&r.params.onexpire&&(l.pushCastInfo(r.castInfo),r.params.onexpire(r.data),l.popCastInfo());for(var n in r.events)"expire"===n?s(r.events[n]):l.removeEvent(r.events[n]);r.params.status&&l.statusBuffs[r.params.status].dr&&(f(t.target),u(t.target)),r.expired=!0,l.buffs[t.id].targets&&t.target?delete l.buffs[t.id].targets[t.target]:delete l.buffs[t.id]}l.buffWatchTrigger(t.id)}function c(t){var e=t.stacklist[t.stackstart];t.params.onexpire&&(l.pushCastInfo(e.castInfo),t.params.onexpire(e.data),l.popCastInfo());for(var a in e.events)"expire"===a?s(e.events[a]):l.removeEvent(e.events[a]);return e.expired=!0,t.stacklist[t.stackstart]=void 0,t.stackstart=(t.stackstart+1)%t.params.maxstacks,e}function h(e,a,i){if(a.params.refresh)a.time-this.time<=i?(e.push({buff:a,duration:a.time-this.time}),o({id:a.id,target:a.target})):(e.push({buff:a,duration:i}),a.time-=i,a.events.expire&&s(a.events.expire),a.events.expire=t(a.time-this.time,o,{id:a.id,target:a.target}));else for(var r=0;r<a.stacks;++r){var f=a.stacklist[(a.stackstart+r)%a.stacklist.length];f.time-this.time<=i?(e.push({buff:f,duration:f.time-this.time}),c(a),--a.stacks,a.stacks?(a.params.multiply&&(l.buffsModified=!0),l.buffWatchTrigger(a.id)):o({id:a.id,target:a.target})):(e.push({buff:f,duration:i}),f.time-=i,f.events.expire&&s(f.events.expire),f.events.expire=t(f.time-this.time,d,{id:a.id,target:a.target}))}}function d(t){a(t.id);var s=e(t.id,t.target);if(s){for(;s.stacks&&s.stacklist[s.stackstart].time<=t.time;)c(s),--s.stacks;s.stacks?(s.params.multiply&&(l.buffsModified=!0),l.buffWatchTrigger(t.id)):o(t)}}function g(t){var s=t.stack||t.buff;++t.buff.ticks,delete s.events.tick,void 0!==s.time&&s.time<=t.time||(t.buff.params.ontick&&(s.data.stacks=t.buff.stacks,s.data.time=t.time,l.pushCastInfo(s.castInfo),"function"==typeof t.buff.params.ontick?t.buff.params.ontick(s.data):l.damage(l.extend({},t.buff.params.ontick)),l.popCastInfo()),s.expired||s.events.tick||(s.events.tick=l.after(t.buff.params.tickrate,g,t)))}function v(t,s,e){if(!t.params.refresh){for(var a=0,i=0;i<t.stacklist.length&&e>a;++i){var r=t.stacklist[i];r&&r.events.tick&&r.events.tick.time<this.time+s&&(this.removeEvent(r.events.tick),r.events.tick=this.after(s,g,{buff:t,stack:r}),++a)}return a}return t.events.tick&&t.events.tick.time<this.time+s?(this.removeEvent(t.events.tick),t.events.tick=this.after(s,g,{buff:t}),1):0}function m(e,a){e.params.refresh&&("infinite"===a||void 0!==e.time&&this.time+a>e.time)&&(e.events.expire&&(s(e.events.expire),delete e.events.expire),"infinite"!==a?(e.time=this.time+a,e.events.expire=t(a,o,{id:e.id,target:e.target})):delete e.time)}function p(e,a,i,r,u){if(e||r.stacks){if(r.status&&this.statusBuffs[r.status].dr){if(r.nodr)f(u);else if(r=this.extend({},r),r.duration=Math.floor((r.duration||60)*f(u)),l.target.mincc&&r.duration<60*l.target.mincc)return;n(u)}var h=!!e;if(e){var v=this.castInfo();if(v&&r.refresh){var m=48/this.stats.info.aps;this.time>=e.userStart+m&&(e.castInfo.user=v.user,e.userStart=this.time),e.castInfo.weapon=v.weapon,e.castInfo.castId=v.castId}}else e={params:r,stacks:0,ticks:0,events:{},start:this.time,userStart:this.time,castInfo:this.castInfo(),id:a,target:u},r.refresh||(e.stacklist=new Array(r.maxstacks),e.stackstart=0),e.data=this.extend({buff:e},r.data);var p=e.stacks;if(l.setBuffStats(e,i,e.stacks+r.stacks),r.refresh)r.duration&&(!h||void 0!==e.time&&e.time<this.time+r.duration)&&(e.time=this.time+r.duration,e.events.expire&&s(e.events.expire),e.events.expire=t(r.duration,o,{id:a,target:u})),r.tickrate&&!e.events.tick&&(e.events.tick=this.after(r.tickinitial||r.tickrate,g,{buff:e})),h?r.onrefresh?r.onrefresh(e.data,r.data):this.extend(e.data,r.data):r.onapply&&r.onapply(e.data);else for(var k=(e.stackstart+p)%e.params.maxstacks,b=0;b<r.stacks;++b){var x=void 0;if(e.stacklist[k]){var B=e.stacklist[k];r.tickrate&&r.tickkeep&&B.events.tick&&(x=B.events.tick.time-this.time),r.onrefresh&&(l.pushCastInfo(B.castInfo),r.onrefresh(B.data),l.popCastInfo()),c(e)}var B={events:{},castInfo:this.castInfo(),start:this.time};r.duration&&(B.time=this.time+r.duration,B.events.expire=t(r.duration,d,{id:a,target:u})),B.data=this.extend({buff:e,stack:B},r.data),r.onapply&&r.onapply(B.data),r.tickrate&&(void 0===x&&(x=void 0===r.tickinitial?r.tickrate:r.tickinitial),B.events.tick=this.after(x,g,{buff:e,stack:B})),e.stacklist[k]=B,k=(k+1)%e.params.maxstacks}return e}}function k(t,s){if(void 0===s||s>=t.stacks){var e;if(t.stacklist)for(;t.stacks;)e=c(t),--t.stacks;return o({id:t.id,target:t.target}),e}t.stacks;if(t.params.multiply?this.setBuffStats(t,t.stats,t.stacks-s):this.buff.stacks-=s,t.stacklist){for(var e,a=0;s>a;++a)e=c(t);return this.buffWatchTrigger(t.id),e}}var l=Simulator;l.statusBuffs={chilled:{},frozen:{dr:!0},blinded:{dr:!0},stunned:{dr:!0},slowed:{},knockback:{},charmed:{dr:!0},feared:{dr:!0},rooted:{dr:!0}};var b=new l.Heap(function(t){return t.time});l.buffWatchList={},l.buffWatchers={},l.statusWatchers={},l.buffs={},l.metaBuffs={},l.metaParents={},l.uptimes={},l.watchBuff=function(t,s){this.buffWatchers[t]||(this.buffWatchers[t]=[]);var e=this.newCastInfo();this.buffWatchers[t].push({func:s,castInfo:e}),this.pushCastInfo(e),s.call(this,{stacks:this.getBuff(t),duration:this.getBuffDuration(t)}),this.popCastInfo()},l.watchStatus=function(t,s){this.statusWatchers[t]||(this.statusWatchers[t]=[]),l.statusWatchers[t].push({func:s,castInfo:this.newCastInfo()})},l.buffWatchTrigger=function(t){this.buffWatchList[t]=!0;var s=this.metaParents[t];if(s)for(var e=0;e<s.length;++e)this.buffWatchTrigger(s[e])},l.buffsModified=!0,l.register("update",function(t){for(var s=t.time;!b.empty()&&b.top().time<=s;){var e=b.pop();this.time=e.time,this.pushCastInfo(e.castInfo),e.data=e.data||{},e.data.time=e.time,e.func(e.data),this.popCastInfo()}this.time=s;for(var a in this.buffWatchList){var i={stacks:this.getBuff(a),duration:this.getBuffDuration(a),targets:this.getBuffTargets(a)},r=this.buffWatchers[a];if(r)for(var f=0;f<r.length;++f){var n=this.extend({},r[f].castInfo);n.castId=this.getCastId(),this.pushCastInfo(n),r[f].func.call(this,i),this.popCastInfo()}}this.buffWatchList={},this.buffsModified&&(this.stats=new this.Stats(this.baseStats,this.buffs),this.buffsModified=!1)});var x={};l.register("finish",function(){for(var t in this.buffs)a(t);var s={};for(var t in this.uptimes)0!==t.indexOf("uniq_")&&(s[t]=this.uptimes[t]/this.time);this.uptimes=s}),l.setBuffStats=function(t,s,e){null===s&&(s=t.stats),e=Math.min(e,t.params.maxstacks),(!r(t.stats,s)||t.params.multiply&&e!=t.stacks&&!r(void 0,s))&&(this.buffsModified=!0),t.stats=s,t.stacks=e};var B=[],I=[],C=[];l.reduceBuffDuration=function(t,s,e){var i=this.buffs[t],r=[];if(!i)return r;if(a(t),i.targets){var f=e||this.target.count,n=f<=this.target.eliteCount?f:this.target.index+f-this.target.eliteCount;for(var u in i.targets)n>u&&h.call(this,r,i.targets[u],s)}else h.call(this,r,i,s);return r},l.delayBuff=function(t,s,e){var a=this.buffs[t];if(void 0===e&&(e=9999),!a){var i=this.metaBuffs[t];if(!i)return 0;for(var r=0,f=0;f<i.length&&e>r;++f)r+=l.delayBuff(i[f],s,e-r);return r}if(a.targets){var n=0;for(var u in a.targets)n+=v.call(this,a.targets[u],s,e);return n}return v.call(this,a,s,e)},l.refreshBuff=function(t,s,e){var a=this.buffs[t];if(a)if(a.targets)if(void 0!==e)a.targets[e]&&m.call(this,a.targets[e],s);else for(var i in a.targets)m.call(this,a.targets[i],s);else m.call(this,a,s)};var y=0;l.addBuff=function(t,s,e,i){if(t||(t="uniq_"+y++),a(t),"number"==typeof e&&(e={duration:e}),e&&e.stacks&&(e.stacks=Math.round(e.stacks)),e&&e.maxstacks&&(e.maxstacks=Math.round(e.maxstacks)),!e||!e.targets||e.targets instanceof Array||(e.targets=Math.min(l.random("buff_"+t,1,e.targets,!0),l.target.count)),e=this.extend({stacks:1,refresh:!0,multiply:!0},e),e.maxstacks||(e.maxstacks=e.stacks),this.statusBuffs[t]&&(e.status=t),e.status&&(e.targets=e.targets||1,s=s||{},s[e.status]=1,"stunned"===e.status&&this.stats.leg_dovuenergytrap&&e.duration&&(e.duration*=1+.01*this.stats.leg_dovuenergytrap)),e.stacks=Math.min(e.stacks,e.maxstacks),void 0!==e.targets){this.buffs[t]||(this.buffs[t]={targets:{}});var r=this.buffs[t].targets,f=e.targets;if(!(f instanceof Array)){var n=e.targets;if(f=[],"new"===e.firsttarget){var u=l.target.list();for(var o in u)!r[u[o]]&&n>0&&(f.push(u[o]),--n);delete e.firsttarget}if(n>0)for(var c=this.target.list({targets:n,firsttarget:e.firsttarget}),h=0;h<c.length;++h)f.push(c[h])}if(e.status){var d=this.statusWatchers[e.status];if(d)for(var h=0;h<d.length;++h)this.pushCastInfo(d[h].castInfo),d[h].func.call(this,e.duration,f),this.popCastInfo()}for(var h=0;h<f.length;++h){var o=f[h],g=p.call(this,r[o],t,s,e,o);g&&(r[o]=g)}}else{var g=p.call(this,this.buffs[t],t,s,e,i);g&&(this.buffs[t]=g)}return this.buffWatchTrigger(t),t},l.removeBuff=function(t,s,e){var i=this.buffs[t];if(i){if(a(t),i.targets){void 0===e&&(e=this.target.count);var r,f=e||this.target.count,n=f<=this.eliteCount?t0+f:this.index+f-this.eliteCount,u=[];for(var t in i.targets)n>t&&u.push(t);for(var o=0;o<u.length;++o){var c=k.call(this,i.targets[u[o]],s);r||(r=c)}return r}return k.call(this,i,s)}},l.setBuffStacks=function(t,s,e){if(t||e){if(!t)return l.addBuff(t,s,{maxstacks:999,stacks:e});a(t);var i=l.getBuff(t);return e>i?l.addBuff(t,s,{maxstacks:999,stacks:e-i}):i>e&&l.removeBuff(t,i-e),t}},l.metaBuff=function(t,s){l.metaBuffs[t]=s;for(var e=0;e<s.length;++e)l.metaParents[s[e]]=l.metaParents[s[e]]||[],l.metaParents[s[e]].push(t)},l.getBuff=function(t,s){if(this.statusBuffs[t])return this.stats[t]?1:0;var e=this.buffs[t];if(!e){var a=this.metaBuffs[t];if(!a)return 0;for(var i=0,r=0;r<a.length;++r)i+=l.getBuff(a[r],s);return i}return e.targets&&(e=e.targets[void 0===s?this.target.eliteCount?0:this.target.index:s]),e&&e.stacks||0},l.getBuffTargets=function(t){var s=this.buffs[t];if(!s){var e=this.metaBuffs[t];if(!e)return 0;for(var a=0,i=0;i<e.length;++i)a+=l.getBuffTargets(e[i]);return a}if(s.targets){var a=0;for(var r in s.targets)a+=1;return a}return 1},l.getBuffTargetList=function(t){var s=this.buffs[t],e=[];if(!s||!s.targets)return e;for(var a in s.targets)e.push(a);return e.sort(function(t,s){return t-s}),e},l.getBuffDuration=function(t,s){var e=this.buffs[t];if(!e){var a=this.metaBuffs[t];if(!a)return 0;for(var i=l.getBuffDuration(a[0]),r=1;r<a.length;++r)i=Math.max(i,l.getBuffDuration(a[r],s));return i}if(e.targets&&(e=e.targets[void 0===s?this.target.eliteCount?0:this.target.index:s]),!e)return 0;if(e.params.refresh)return e.time?e.time-this.time:1e10;if(!e.stacks)return 0;var f=e.stacklist[(e.stackstart+e.stacks-1)%e.params.maxstacks];return f.time?f.time-this.time:1e10},l.getBuffDurationLast=function(t,s){var e=this.buffs[t];if(!e){var a=this.metaBuffs[t];if(!a)return 0;for(var i=l.getBuffDuration(a[0]),r=1;r<a.length;++r)i=Math.min(i,l.getBuffDuration(a[r],s));return i}if(e.targets&&(e=e.targets[void 0===s?this.target.eliteCount?0:this.target.index:s]),!e)return 0;if(e.stacks<e.params.maxstacks)return 0;if(e.params.refresh)return e.time?e.time-this.time:1e10;if(!e.stacks)return 0;var f=e.stacklist[e.stackstart];return f.time?f.time-this.time:1e10},l.getBuffElapsed=function(t,s){var e=this.buffs[t];return e&&e.targets&&(e=e.targets[void 0===s?this.target.eliteCount?0:this.target.index:s]),e?l.time-e.start:0},l.getBuffTicks=function(t,s){var e=this.buffs[t];return e&&e.targets&&(e=e.targets[void 0===s?this.target.eliteCount?0:this.target.index:s]),e?e.ticks:0},l.getBuffData=function(t,s){var e=this.buffs[t];return e&&e.targets&&(e=e.targets[void 0===s?this.target.eliteCount?0:this.target.index:s]),e&&e.data},l.getBuffStack=function(t,s){var e=this.buffs[t];if(e&&e.targets&&(e=e.targets[void 0===s?this.target.eliteCount?0:this.target.index:s]),e&&e.stacklist&&e.stacks){var a=(e.stackstart+e.stacks-1)%e.params.maxstacks;return e.stacklist[a]}},l.getBuffCastInfo=function(t,s){var e=this.buffs[t];return e&&e.targets&&(e=e.targets[void 0===s?this.target.eliteCount?0:this.target.index:s]),e&&e.castInfo},l.rotateBuffs=function(){var t=l.target.index,s=l.target.index+l.target.count-l.target.eliteCount;for(var e in this.buffs){var a=this.buffs[e];a.targets&&t in a.targets&&(a.targets[t].params.aura?(a.targets[s]=a.targets[t],delete a.targets[t]):k.call(this,a.targets[t]))}}}();!function(){function a(){for(var a=0;a<arguments.length;++a)if(arguments[a]||0===arguments[a])return arguments[a]}function t(a){if(0!==a.count&&0!==a.targets){var t=o.calcDamage(a);a.onhit&&a.onhit(t),o.dealDamage(t)}}function e(r){var n=o.target.count+(r.cmod||0);if(n){var i=a(r.origin,o.target.distance),s=o.target.size+(r.radius||0);if(r.fan&&r.count&&r.count>1&&!r.merged){var c=o.extend({},r);c.count-=1,c.angle=.5*r.fan,delete c.fan,e(c),r.count=1}var g=r.fan?r.count||1:1,d=r.fan?1:r.count||1,f=o.math.lineArea(o.target.radius,s,i,r.range,r.angle,r.fan,g,r.skip);if(!(1e-9>f)){f=Math.min(f,o.target.area)/o.target.area;var l;if(r.pierce&&!r.speed||(l=o.math.lineDistance(n,o.target.radius,s,i,r.range,r.angle,r.fan,g,r.skip),void 0!==l)){var m;if(r.pierce){var h=n*f;r.pierce!==!0&&(h=o.math.limitedAverage(f,n,r.pierce+1)),r.count=d,r.targets=h;var u=Math.max(0,h-1)/Math.max(n*f-1,.01),p=void 0!==l?Math.min(o.target.radius,Math.abs(i-l)):0;p*=1-u,r.distance=i-p}else r.count=d,r.targets=1-Math.pow(1-f,n),r.distance=l+s;if(r.area&&n>1){var p=void 0!==l?Math.min(o.target.radius,Math.abs(i-l)):0,v=o.math.circleIntersection(p,r.area+o.target.size,o.target.radius);v=Math.min(v,o.target.area)/o.target.area;var I=(n-1)*v;r.areamax&&(I=o.math.limitedAverage(v,n-1,r.areamax)),r.areacoeff||r.areadelay?(m=o.extend({},r),m.count*=m.targets,m.targets=I,m.coeff=r.areacoeff||r.coeff,m.delay=r.areadelay,delete m.onhit):(r.count*=r.targets,r.targets=1+I)}if(r.speed){var M=l/r.speed;o.after(M,t,r),m&&o.after(M+(m.delay||0),t,m)}else t(r),m&&t(m)}}}}function r(e){var r=(e.radius||0)+o.target.size,n=a(e.origin,o.target.distance),i=e.range||o.target.radius+n+r,s=o.math.lineDistance(o.target.count,o.target.radius,r,n,i);if(void 0!==s){var c=s/e.speed;e.distance=n;var g=o.math.slowball(o.target.radius,r,-n,-n+i)/e.speed;e.count=(e.count||1)*o.target.density*g/e.rate,c?o.after(c,t,e):t(e)}}function n(e){var r;e.self&&(e.distance=e.range/2),e.front&&(e.origin=Math.abs(a(e.origin,o.target.distance)-e.range),e.distance=e.range),r=e.spread?o.math.circleArea(o.target.radius,o.target.size+e.range,e.spread,a(e.origin,e.self&&o.target.distance,0),e.inner):e.self||void 0!==e.origin?o.math.circleIntersection(a(e.origin,o.target.distance),o.target.size+e.range,o.target.radius):Math.PI*Math.pow(Math.min(o.target.radius,o.target.size+e.range),2);var n=o.target.count+(e.cmod||0),i=Math.min(r,o.target.area)/o.target.area;e.cap?e.targets=o.math.limitedAverage(i,n,e.cap):e.targets=n*i,e.targets&&t(e)}function i(e){e.distance=e.range/2;var r=o.math.coneArea(o.target.radius,o.target.size,a(e.origin,o.target.distance),e.width||90,e.range,e.angle),n=o.target.count+(e.cmod||0),i=Math.min(r,o.target.area)/o.target.area;e.cap?e.targets=o.math.limitedAverage(i,n,e.cap):e.targets=n*i,e.targets&&t(e)}function s(a){var e=o.math.waveOfLight(o.target.count,o.target.radius,(a.radius||0)+o.target.size,o.target.distance,a.range,a.expos,a.exrange);e&&(a.targets=Math.min(e.area,o.target.area)/o.target.area*o.target.count,a.distance=e.distance,o.after(e.distance/a.speed,t,a))}function c(a){var e=o.math.rollingThunder(o.target.count,o.target.radius,o.target.size,o.target.distance,a.range,a.angle,a.expos,a.exrange);e&&(a.targets=Math.min(e.area,o.target.area)/o.target.area*o.target.count,a.distance=e.distance,t(a))}function g(a){switch(a.type){case"line":e(a);break;case"ball":r(a);break;case"area":n(a);break;case"cone":i(a);break;case"waveoflight":s(a);break;case"rollingthunder":c(a);break;default:t(a)}}var o=Simulator;o.curweapon="mainhand",o.calcDamage=function(t){var e,r=o.stats,n=t.castInfo&&t.castInfo.triggered,i=r.info[t.weapon||"mainhand"].wpnbase;e=t.thorns?o.stats.thorns:t.castInfo&&"min"===t.castInfo.pet?i.min:.5*(i.min+i.max),e*=void 0===t.coeff?1:t.coeff,t.addthorns&&(e+=t.addthorns*o.stats.thorns);var s=1+.01*r.info.primary*("bad"===t.thorns?.25:1);t.fix&&t.fix.call(t),s*=t.factor||1;var c=t.dibs||0,g=r["final"].chc+(t.chc||0),d=r.chd+(t.chd||0),f=t.orphan;if(t.castInfo&&t.castInfo.buffs)for(var l=0;l<t.castInfo.buffs.length;++l){var m=t.castInfo.buffs[l];m.dibs&&(c+=m.dibs),m.factor&&(s*=m.factor),m.percent&&(s*=1+.01*m.percent),m.chc&&(g+=m.chc),m.chd&&(d+=m.chd)}t.castInfo&&t.castInfo.orphan&&(f=!0),g=Math.min(1,.01*g),d*=.01;var h=t.pet||t.castInfo&&t.castInfo.pet;if(!t.manald){var u="skill_"+o.stats.charClass+"_";h?(s*=1+.01*(r[u+t.skill]||0),n&&n!==t.skill&&(s*=1+.01*(r[u+n]||0))):"special"!==t.thorns&&(c+=r[u+(t.skill||n)]||0)}var p="max"===t.elem?r.info.maxelem:t.elem,v=("max"===t.srcelem?r.info.maxelem:t.srcelem)||t.elem;f||(c+=r.getSpecial("damage",p,h,t.skill,t.exclude));var I=r.getSpecial("dmgtaken",p,h,t.skill,t.exclude);"normal"===t.thorns||"bad"===t.thorns||"special"===t.thorns?(s*=1+.01*I,"special"!==t.thorns&&(s*=1+.01*(r.thorns_taken||0))):c+=I,s*=1+.01*c;var M=!t.manald&&v&&r["dmg"+v]||0;h&&!t.manald&&(M+=r.petdamage||0),s*=1+.01*M;var k=.01*(r.edmg||0);t.manald&&(k-=.01*(r.leg_thefurnace||0),r.gem_powerful_25&&(k-=.15));var b=.01*(r.bossdmg||0);s*=1+o.target.elite*k+o.target.boss*(1+k)*b,o.target.type&&(s*=1+.01*(r["damage_"+o.target.type]||0));var x=1;if(!f){if(x=r.getSpecial("dmgmul",p,h,t.skill,t.exclude),r.gems.zei){var w=a(t.castInfo&&t.castInfo.distance,t.distance,t.origin,o.target.distance);x*=1+.01*Math.min(50,w)*(4+.08*r.gems.zei)/10}if(r.leg_starfire&&"lit"===p){var w=a(t.castInfo&&t.castInfo.distance,t.distance,t.origin,o.target.distance);x*=1+.01*r.leg_starfire*Math.min(w,40)/10}}s*=x;var _=e*s;return f||t.thorns||t.addthorns||(_*=1+g*d),(t.nocrit||f||t.thorns||t.addthorns)&&(g=0),{tags:t.tags,targets:Math.min(t.targets||1,o.target.count),firsttarget:t.firsttarget,count:t.count||1,skill:t.skill,proc:h?0:t.proc,damage:_,elem:p,pet:h,castInfo:t.castInfo,triggered:n,thorns:t.thorns,chc:g,distance:t.distance,dmgmul:x,castId:t.castId,origdata:t}},o.dealDamage=function(a){if(a.proc&&!a.pet&&o.trigger("onhit_proc",a),o.trigger("onhit",a),a.proc||a.pet){if(void 0===o.target.area_coeff){var t=Math.PI*Math.pow(o.target.size+10,2);o.target.area_coeff=(o.target.count-1)*Math.min(1,t/o.target.area)}o.target.area_coeff&&o.stats.area&&o.trigger("onhit",{targets:a.targets*o.target.area_coeff,firsttarget:o.target.next(a),count:.2*a.count,skill:a.skill,damage:.01*a.damage*o.stats.area,elem:a.elem,triggered:"area",chc:0})}},o.getTargets=function(a,t){var e=o.math.circleIntersection(t||0,o.target.size+a,o.target.radius);return Math.min(e,o.target.area)*o.target.density},o.damage=function(a){if(a.castInfo=this.castInfo(),a.castInfo&&!a.skill&&(a.skill=a.castInfo.skill),a.castInfo&&a.castInfo.proc&&void 0===a.proc&&(a.proc=a.castInfo.proc,a.castInfo=this.extend({},a.castInfo),delete a.castInfo.proc),a.castInfo&&void 0===a.elem&&(a.elem=a.castInfo.elem),a.castId=this.getCastId(),a.weapon=a.castInfo&&a.castInfo.weapon||this.curweapon,this.pushCastInfo(a.castInfo),a.delay){var t=a.delay;delete a.delay,this.after(t,g,a)}else g(a);this.popCastInfo()},o.healing=function(a){o.trigger("healing",{amount:a.amount,castInfo:this.castInfo()})}}();!function(){function t(t,e){return e&&(e-=a.stats["skill_"+a.stats.charClass+"_"+t+"_cooldown"]||0,e-=a.stats.cdrint||0,e*=1-.01*(a.stats.cdr||0),e=Math.ceil(60*Math.max(e,.5))),e}function e(e){var s=a.skills[e.id],r=a.getProp(s,"cooldown",e.rune);r=t(e.id,r);var i=a.cooldowns[e.id];i||(i=a.cooldowns[e.id]={}),i.ends=a.time+r,delete i.grace,delete i.graceEvent}function s(e){var r=a.skills[e.id],i=a.getProp(r,"cooldown",e.rune);i=t(e.id,i);var n=a.cooldowns[e.id];n||(n=a.cooldowns[e.id]={});var o=a.getProp(r,"maxcharges",e.rune);void 0===o&&(o=a.getProp(r,"charges",e.rune)),n.charges<o&&++n.charges,n.charges<o?n.chargeEvent=a.after(i,s,e):delete n.chargeEvent,delete n.ends}function r(t){"function"==typeof t.func?t.func(t):a.damage(t.func);var e=a.castInfo();t.buff.params.tickrate=Math.floor(t.speed/e.speed)}function i(t){var e=t.tickrate;if(e instanceof Array&&(e=e[t.anim],t.anim=(t.anim+1)%t.tickrate.length),"function"==typeof t.ontick){var s=t.ontick(t);s&&(e=s)}else a.damage(t.ontick);e/=1+.01*((t.ias||0)+(a.stats.petias||0)),t.speed&&(e/=a.stats.info.mainhand.speed),t.buff.params.tickrate=6*Math.ceil(Math.floor(e)/6)}var a=Simulator;a.getProp=function(t,e,s){var r=t[e];return"function"==typeof r?r.apply(t,Array.prototype.slice.call(arguments,2)):"object"==typeof r?r[s]:r},a.getPropExtend=function(t,e,s,r){var i=t[e];return"function"==typeof i?i.apply(t,Array.prototype.slice.call(arguments,2)):"object"==typeof i?this.extend({},i[s]):i};var n={wizard:["ap"],demonhunter:["hatred","disc"],barbarian:["fury"],witchdoctor:["mana"],monk:["spirit"],crusader:["wrath"]},o=0;a.resources={},a.addResource=function(t,e){e||(e=n[this.stats.charClass][0]),this.resources[e]=this.resources[e]||0,t*=1+.01*(this.stats.resourcegen||0);var s=Math.min(this.stats["max"+e]-this.resources[e],t);s&&(this.resources[e]+=s,a.trigger("resourcegain",{type:e,amount:s,castInfo:a.castInfo()}))},a.getMaxResource=function(t){return t||(t=n[this.stats.charClass][0]),this.stats["max"+t]||0},a.getResource=function(t){return t||(t=n[this.stats.charClass][0]),void 0!==this.resources[t]?this.resources[t]:"max"===this.initresource||void 0===this.initresource?this.stats["max"+t]||0:Math.min(this.initresource,this.stats["max"+t]||0)},a.hasResource=function(t,e){return t?(e||(e=n[this.stats.charClass][0]),this.resources[e]&&this.resources[e]>=t):!0},a.spendResource=function(t,e){return t?(e||(e=n[this.stats.charClass][0]),this.resources[e]&&this.resources[e]>=t?(a.trigger("resourceloss",{type:e,amount:t,castInfo:a.castInfo()}),this.resources[e]-=t,!0):!1):!0},a.register("update",function(t){var e=n[this.stats.charClass],s=(t.time-o)/60;o=t.time;for(var r=0;r<e.length;++r){var i=e[r],a=this.stats["max"+i],c=this.stats[i+"regen"]||0;"fury"===i&&(c+=this.params.furyGen||0),c*=1+.01*(this.stats.resourcegen||0),void 0===this.resources[i]&&("max"===this.initresource||void 0===this.initresource?this.resources[i]=a:this.resources[i]=Math.min(this.initresource,a)),c&&(this.resources[i]=Math.min(a,this.resources[i]+c*s))}}),a.register("init",function(t){this.rcTypes=n[this.stats.charClass];for(var e in this.stats.skills){var s=this.skills[e],r=this.stats.skills[e];s&&r&&(this.pushCastInfo({skill:e,rune:r,buffs:[],elem:this.getProp(s,"elem",r),proc:this.getProp(s,"proctable",r)}),this.getProp(s,"oninit",r),this.popCastInfo())}for(var e in this.stats.passives){var i=this.passives[e];"function"==typeof i?(this.pushCastInfo({triggered:e}),i.call(e),this.popCastInfo()):i&&a.addBaseStats(i)}}),a.trigCost=function(t,e,s,r){var i=this.skills[t],e=e||this.stats.skills[t],n=r||this.getProp(i,"cost",e),o=this.getProp(i,"resource",e)||this.rcTypes[0],c=a.getProp(i,"initialcost",e);if(c&&!a.getBuff(t)?n=c:c=void 0,n){if(a.stats.leg_cindercoat&&"fir"===a.getProp(i,"elem",e)&&(n*=1-.01*a.stats.leg_cindercoat),n*=1-.01*(a.stats["rcr_"+o]||0),n-=a.stats.rcrint||0,!c){var h=a.getProp(i,"channeling",e);h&&(n*=h/60)}for(var f=a.trigger("clearcast",{skill:t,rune:e,cost:n,resource:o,dry:s}),u=0;f>u;++u)f[u]===!0?n=0:"number"==typeof f[u]&&(n*=f[u]);if(!n)return n;if(!this.hasResource(n,o))return!1;s||this.spendResource(n,o)}return n},a.cooldowns={},a.durationLock={},a.getCooldown=function(t){var e=this.cooldowns[t];return this.durationLock[t]&&this.durationLock[t]>this.time?0:!e||!e.ends||e.ends<=this.time?0:e.ends-this.time},a.getCharges=function(t){var e=this.skills[t],s=this.stats.skills[t];if(!e||!s)return 0;var r=this.cooldowns[t],i=a.getProp(e,"charges",s);return r&&void 0!==r.charges?r.charges:i};var c=!1;a.trigCooldown=function(r,i,a){var n=this.skills[r],i=i||this.stats.skills[r],o=this.getProp(n,"cooldown",i);if(o=t(r,o),this.durationLock[r]&&this.durationLock[r]>this.time)return!1;var h=this.getProp(n,"duration",i);h&&!a&&(this.durationLock[r]=this.time+h,o+=h);var f=this.getProp(n,"grace",i);"number"==typeof f&&(f=[f,1]);var u=this.getProp(n,"charges",i);if(a&&!this.cooldowns[r]&&0!==u)return o;var d=this.cooldowns[r];if(d||(d=this.cooldowns[r]={}),f){if(d.ends&&d.ends>this.time)return!1;a||(d.graceEvent?(--d.grace||(this.removeEvent(d.graceEvent),delete d.graceEvent,d.ends=this.time+o),c=!0):(d.grace=f[1],d.graceEvent=this.after(f[0],e,{id:r,rune:i})))}else if(void 0!==u){if(void 0===d.charges&&(d.charges=u),!d.charges)return!1;a||(--d.charges,!d.chargeEvent&&o&&(d.chargeEvent=this.after(o,s,{id:r,rune:i})),!d.charges&&d.chargeEvent&&(d.ends=d.chargeEvent.time))}else{if(d.ends&&d.ends>this.time)return!1;!a&&o&&(d.ends=this.time+o)}return o},a.reduceCooldown=function(e,r){var i=i||this.stats.skills[e],n=this.skills[e];if(!i||!n)return!1;if(this.durationLock[e]&&this.durationLock[e]>this.time)return!1;var o=this.cooldowns[e];if(!o)return!1;var c=this.getProp(n,"cooldown",i);c=t(e,c);var h=this.getProp(n,"grace",i);"number"==typeof h&&(h=[h,1]);var f=this.getProp(n,"maxcharges",i);if(void 0===f&&(f=this.getProp(n,"charges",i)),f){if(!o.chargeEvent)return o.charges>=f?!1:(++o.charges,!0);var u=o.chargeEvent.time;return this.removeEvent(o.chargeEvent),delete o.chargeEvent,void 0===r||u<=this.time+r?(o.charges<f&&++o.charges,o.charges<f&&(o.chargeEvent=a.after(c,s,{id:e,rune:i}))):o.chargeEvent=a.after(u-this.time-r,s,{id:e,rune:i}),!0}return!o.ends||o.ends<=this.time?!1:(void 0===r?delete o.ends:(o.ends-=r,o.ends<=this.time&&delete o.ends),!0)},a.canCast=function(t,e){var s=this.skills[t];if(!s)return!1;var e=e||this.stats.skills[t]||s.shift&&"x";if(!e)return!1;if(s.precast){var r=s.precast.call(s,e,!0);if(r===!1)return!1;if(r!==!0)return r||{}}if(s.shift!=this.stats.shift)return!1;c=!1;var r={};return r.cooldown=this.trigCooldown(t,e,!0),r.cooldown===!1?!1:c||(r.cost=this.trigCost(t,e,!0),r.cost!==!1)?r:!1},a.lastCastId=0,a.cast=function(t,e,s,r){var i=this.skills[t];if(!i)return!1;var e=e||this.stats.skills[t]||"x";if(!e)return!1;var o=this.castInfo(),h=!!s&&"soft"!==s,f="soft"===s;!o||s&&s!==!0&&"soft"!==s||(s=o.triggered||o.skill),(s===!0||"soft"===s)&&(s=void 0);var u={};if(!s&&(u=this.canCast(t,e),!u))return!1;var d=this.getProp(i,"elem",e),l={skill:t,rune:e,elem:d,pet:i.pet};switch(s?l.castId=this.getCastId():l.castId=++this.lastCastId,l.weapon=this.getProp(i,"weapon",e),l.weapon){case"mainhand":case"offhand":if(!this.stats.info[l.weapon])return!1;break;case"current":l.weapon=this.curweapon;break;default:l.weapon=this.curweapon,!s&&this.stats.info.offhand&&(this.curweapon="mainhand"===this.curweapon?"offhand":"mainhand")}if(s&&!f){l.triggered=s;var g=this.skills[s];if(g){g.pet&&(l.weapon="mainhand",l.pet=!0);var p=this.getProp(g,"distance",this.stats.skills[s]);p&&(l.distance=p)}else l.pet?l.triggered=s=t:r&&(l.weapon="mainhand",l.pet=!0);l.trigExplicit=h}else{l.triggered=s,l.trigExplicit=h,l.buffs=[],l.user={},l.globUser={},s||(l.generate=this.getProp(i,"generate",e),!l.generate&&i.signature&&(l.generate=0)),l.cost=u.cost,l.cooldown=u.cooldown;var v=this.getProp(i,"resource",e);l.resource=v||n[this.stats.charClass][0],l.proc=this.getProp(i,"proctable",e),l.offensive=this.getProp(i,"offensive",e),l.melee=this.getProp(i,"melee",e),l.frames=this.getProp(i,"frames",e),l.channeling=this.getProp(i,"channeling",e);var m=this.stats.info[l.weapon||"mainhand"].speed;l.speed=this.getProp(i,"speed",e,m),l.speed||(l.speed=m),l.pause=this.getProp(i,"pause",e),this.pushCastInfo(l);var k=a.trigger("oncast",l);this.popCastInfo();for(var w=0;w<k.length;++w)k[w]&&l.buffs.push(k[w])}if(this.pushCastInfo(l),!s){var P=!0;i.precast&&(P=i.precast.call(i,e,!1)),P===!0&&(c=!1,this.trigCooldown(t,e,!1),c||this.trigCost(t,e,!1))}l.generate&&a.addResource(l.generate,v);var y=this.getPropExtend(i,"oncast",e);return y instanceof Object&&(l.channeling?a.channeling(t,l.channeling,y):this.damage(y)),this.popCastInfo(),l},a.castDelay=function(t){return 1===t.speed?Math.ceil(t.frames)+(t.pause||0):Math.floor(t.frames/t.speed)+1+(t.pause||0)},a.channelDelay=function(t){return t.channeling?Math.floor(t.channeling/t.speed):void 0},a.channeling=function(t,e,s,i,n){var o=this.castInfo(),c=Math.floor(e/o.speed);t=a.addBuff(t,a.extend({channeling:1},n&&n.buffs),a.extend({duration:c+1,tickrate:c,tickinitial:1,ontick:r,data:a.extend({func:s,speed:e},i)},n));var h=a.getBuffCastInfo(t);h&&(h.speed=o.speed)},a.petattack=function(t,e,s){s.data=this.extend({tickrate:s.tickrate,ontick:s.ontick,ias:s.ias,speed:s.speed},s.data);var r=s.data.tickrate;r instanceof Array&&(r=r[0],s.data.anim=1%s.data.tickrate.length),r/=1+.01*((s.data.ias||0)+(a.stats.petias||0)),s.data.speed&&(r/=a.stats.info.mainhand.speed),s.tickrate=6*Math.ceil(Math.floor(r)/6),s.ontick=i,a.addBuff(t,e,s)},a.petdelay=function(t,e){if(void 0===e&&(e=9999),this.metaBuffs[t]){for(var s=0,r=0;r<this.metaBuffs[t].length&&e>s;++r)s+=this.petdelay(this.metaBuffs[t][r],e-s);return s}var i=a.getBuffData(t);if(i&&i.tickrate){var n=i.tickrate;return n instanceof Array&&(n=n[0]),n/=1+.01*((i.ias||0)+(a.stats.petias||0)),i.speed&&(n/=a.stats.info.mainhand.speed),this.delayBuff(t,6*Math.ceil(Math.floor(n)/6),e)}return 0},a.apply_effect=function(t,e,s,r){return s&&(1>s||r)?function(i){var n="ufx_"+(a.castInfo()&&a.castInfo().skill||"")+"_",o=a.target.random(n,s*(r?i.proc:1),i);"knockback"===t&&0===o[0]&&o.shift(),o.length&&a.addBuff(t,null,{duration:e,targets:o})}:"knockback"===t&&a.target.boss?function(s){var r=s.targets;s.firsttarget||--r,r>0&&a.addBuff(t,null,{duration:e,targets:r})}:function(s){a.addBuff(t,null,{duration:e,targets:s.targets,firsttarget:s.firsttarget})}},a.magic_icd=function(){var t=a.getCastInfo(!0,"speed");if(!t)return 59;var e=((t.channeling||t.frames||60)-1)/(t.speed||1);return t.channeling&&(e*=54/t.channeling,"whirlwind"===t.skill&&(e/=3)),Math.ceil(e)}}();!function(){var t=Simulator,e=t.affixes;e.set_bastionsofwill_2pc=function(){t.register("onhit",function(e){e.castInfo&&!e.castInfo.pet&&e.castInfo.user&&!e.castInfo.user.bastionsofwill&&(void 0!==e.castInfo.cost?(e.castInfo.user.bastionsofwill=!0,t.addBuff("restraint",{dmgmul:50},{duration:300})):(void 0!==e.castInfo.generate||("earthquake"===e.castInfo.skill||"avalanche"===e.castInfo.skill)&&this.stats.passives.earthenmight)&&(e.castInfo.user.bastionsofwill=!0,t.addBuff("focus",{dmgmul:50},{duration:300})))})},e.set_istvan_2pc=function(){t.register("oncast",function(e){e.cost&&"disc"!==e.resource&&t.addBuff("istvan",{ias:6,dmgmul:6,armor_percent:6},{duration:300,maxstacks:5})})},e.set_talrasha_2pc=function(){if("wizard"===t.stats.charClass){var e={fir:"tal_2pc_fire",col:"tal_2pc_cold",arc:"tal_2pc_arcane",lit:"tal_2pc_lightning"},s={fir:"a",col:"c",arc:"d",lit:"e"};t.register("onhit",function(a){a.elem&&e[a.elem]&&(t.getBuff(e[a.elem])||(t.addBuff(e[a.elem],void 0,{duration:480}),t.cast("meteor",s[a.elem])))})}},e.set_talrasha_4pc=function(){if("wizard"===t.stats.charClass){var e={fir:"tal_4pc_fire",col:"tal_4pc_cold",arc:"tal_4pc_arcane",lit:"tal_4pc_lightning"};t.metaBuff("tal_4pc",["tal_4pc_fire","tal_4pc_cold","tal_4pc_arcane","tal_4pc_lightning"]),t.register("oncast",function(s){s.offensive&&s.elem&&e[s.elem]&&t.addBuff(e[s.elem],{resist_percent:25},{duration:480})})}},e.set_talrasha_6pc=function(){if("wizard"===t.stats.charClass){var e={fir:"tal_6pc_fire",col:"tal_6pc_cold",arc:"tal_6pc_arcane",lit:"tal_6pc_lightning"},s={fir:"tal_6pc_fire2",col:"tal_6pc_cold2",arc:"tal_6pc_arcane2",lit:"tal_6pc_lightning2"};t.register("oncast",function(a){var n=a.elem;if("archon"===a.skill&&(n="fir"),a.offensive&&n&&e[n])if(t.getBuff(e[n])){if(4===t.getBuff("tal_6pc")&&!t.getBuff(s[n])){var r=t.getBuffDuration("tal_6pc")+120;for(var o in e)t.refreshBuff(e[o],r),t.removeBuff(s[o]);t.addBuff(s[n],void 0,{duration:r}),t.refreshBuff("tal_6pc",r)}}else{t.addBuff(e[n],void 0,{duration:480});for(var o in e)t.refreshBuff(e[o],480);t.addBuff("tal_6pc",{dmgmul:2e3},{maxstacks:4,duration:480})}})}},e.set_firebird_4pc=function(){function e(e){t.damage({elem:"fir",coeff:e.coeff/4,firsttarget:e.buff.target})}function s(t){t.skills={},t.skills[t.skill]=!0,t.coeff=10}function a(e,s){e.skills[s.skill]||(e.skills[s.skill]=!0,e.coeff<30&&(e.coeff+=10,30===e.coeff&&t.refreshBuff("firebird_4pc","infinite",e.buff.target)))}"wizard"===t.stats.charClass&&t.register("onhit",function(n){"fir"===n.elem&&"set_firebird_4pc"!==n.triggered&&n.castInfo&&n.castInfo.skill&&t.addBuff("firebird_4pc",void 0,{data:{skill:n.castInfo.skill},targets:n.targets,firsttarget:n.firsttarget,duration:180,tickrate:15,onapply:s,onrefresh:a,ontick:e})})},e.set_firebird_6pc=function(){t.watchBuff("firebird_4pc",function(e){var s=t.buffs.firebird_4pc,a=0;if(s&&s.targets)for(var n in s.targets)s.targets[n].data.coeff&&s.targets[n].data.coeff>=30&&(a+=n<t.target.eliteCount?20:1);t.setBuffStacks("firebird_6pc",{dmgmul:200,dmgred:3},Math.min(a,20))})},e.set_vyr_6pc=function(){t.register("onhit",function(e){var s=e.castInfo&&e.castInfo.skill&&t.skills[e.castInfo.skill];if(s&&"archon"===s.shift&&e.castInfo.user){var a=e.castInfo.user.vyr_6pc;if(!a||a<1){var n=Math.min(1-(a||0),Math.ceil(e.targets));t.addBuff("archon_stacks",void 0,{maxstacks:9999,stacks:n}),e.castInfo.user.vyr_6pc=(a||0)+n}}})},e.set_magnumopus_2pc=function(){var e=["arcaneorb","energytwister","explosiveblast","magicmissile","shockpulse","spectralblade","waveofforce"];t.register("oncast",function(s){e.indexOf(s.skill)>=0&&t.reduceCooldown("slowtime",180)})},e.set_magnumopus_6pc=function(){var e;t.watchBuff("slowtime",function(s){s.targets?e=t.addBuff(e,{dmgmul:{skills:["arcaneorb","energytwister","explosiveblast","magicmissile","shockpulse","spectralblade","waveofforce"],percent:8500}},{targets:s.targets}):e&&t.after(300,function(){t.getBuff("slowtime")||t.removeBuff(e)})})},e.set_chantodo_2pc=function(){t.addBuff("chantodo_2pc",void 0,{maxstacks:20}),t.register("oncast",function(e){if("archon"===e.skill){var s=t.getBuff("chantodo_2pc"),a=e.elem||"arc";t.removeBuff("chantodo_2pc"),t.addBuff("chantodo_2pc",void 0,{maxstacks:20});var n=t.addBuff(void 0,void 0,{duration:1200,tickinitial:1,tickrate:60,ontick:function(e){t.getBuff("archon")?t.damage({type:"area",range:30,self:!0,coeff:10*s,elem:"max",srcelem:a}):t.removeBuff(n)}})}});var e=0;t.register("onhit",function(s){if(s.castInfo&&s.castInfo.user){if(t.skills[s.castInfo.skill]&&t.skills[s.castInfo.skill].shift)return;var a=s.castInfo.user.chantodo_2pc;if(!a||a<1){n=Math.min(1-(a||0),Math.ceil(s.targets*s.count));t.addBuff("chantodo_2pc",void 0,{maxstacks:20,stacks:n}),s.castInfo.user.chantodo_2pc=(a||0)+n}var n=Math.min(3-e,Math.ceil(s.targets*s.count));t.addBuff("chantodo_2pc",void 0,{maxstacks:20,stacks:n}),e+=n}})},e.set_natalya_2pc=function(){t.register("onhit_proc",function(e){e.castInfo&&e.castInfo.user&&(e.castInfo.generate||e.castInfo.cost)&&"hatred"===e.castInfo.resource&&(e.castInfo.user.natalya_2pc||(t.reduceCooldown("rainofvengeance",240),e.castInfo.user.natalya_2pc=!0))})},e.set_natalya_4pc=function(){t.addBaseStats({dmgmul:{skills:["rainofvengeance"],percent:100}})},e.set_natalya_6pc=function(){t.register("oncast",function(e){"rainofvengeance"===e.skill&&t.addBuff("natalya_6pc",{dmgmul:14e3,dmgred:60},{duration:600})})},e.set_marauder_4pc=function(){t.addBaseStats({dmgmul:{skills:["sentry"],percent:400}});var e=["chakram","clusterarrow","elementalarrow","impale","multishot"];t.register("oncast",function(s){if(e.indexOf(s.skill)>=0){for(var a=t.getBuff("sentry"),n=0;n<a;++n)t.cast(s.skill,s.rune,"sentry");t.petdelay("sentry")}})},e.set_marauder_6pc=function(){var e=["chakram","clusterarrow","elementalarrow","impale","multishot"];t.register("oncast",function(s){if(s.generate||e.indexOf(s.skill)>=0){var a=t.getBuff("sentry");if(a)return{percent:12e3*a}}});var s=void 0;t.watchBuff("sentry",function(e){s=t.setBuffStacks(s,{dmgmul:{skills:["companion","vengeance"],percent:12e3}},e.stacks)})},e.set_unhallowed_2pc=function(){t.register("oncast",function(e){t.skills[e.skill]&&t.skills[e.skill].signature&&(t.addResource(2,"hatred"),t.addResource(1,"disc"))})},e.set_unhallowed_4pc=function(){t.after(6,function e(){t.getTargets(10,t.target.distance)<.1&&t.addBuff("unhallowed_4pc",{dmgmul:60,dmgred:60},{duration:480}),t.after(6,e)})},e.set_unhallowed_6pc=function(){t.register("oncast",function(e){if(e.generate||"multishot"===e.skill)return{percent:350*(t.resources.disc||0)}})},e.set_zunimassa_6pc=function(){"witchdoctor"===t.stats.charClass&&t.register("onhit",function(e){var s=e.castInfo&&e.castInfo.cost;!s&&e.castInfo&&e.castInfo.skill&&t.skills[e.castInfo.skill]&&(s=t.skills[e.castInfo.skill].cost)&&(s=s.x),e.castInfo&&s&&t.addBuff("zunimassa_6pc",{dmgmul:{pet:!0,percent:15e3}},{duration:480,targets:e.targets,firsttarget:e.firsttarget})})},e.set_helltooth_2pc=function(){var e=["poisondart","firebomb","corpsespiders","plagueoftoads","acidcloud","firebats","zombiecharger","summonzombiedogs","gargantuan","graspofthedead","piranhas","wallofdeath"];t.register("onhit",function(s){s.castInfo&&e.indexOf(s.castInfo.skill)>=0&&t.addBuff("helltooth_2pc",void 0,{status:"slowed",duration:601,tickrate:30,targets:s.targets,firsttarget:s.firsttarget,ontick:{elem:"max",coeff:15}})})},e.set_helltooth_4pc=function(){var e;t.watchBuff("helltooth_4pc",function(s){s.targets?e=t.addBuff(e,{dmgred:60}):t.removeBuff(e)})},e.set_helltooth_6pc=function(){t.register("oncast",function(e){"wallofdeath"===e.skill&&t.addBuff("helltooth_6pc",{dmgmul:{list:[{pet:!1,skills:["poisondart","firebomb","plagueoftoads","acidcloud","firebats","zombiecharger","graspofthedead","piranhas","wallofdeath"],percent:9e3},{skills:["corpsespiders","summonzombiedogs","gargantuan"],percent:9e3}]}},{duration:900})})},e.set_arachyr_2pc=function(){var e;t.after(48,function s(){e=t.addBuff(e,void 0,{status:"slowed",duration:300,tickrate:30,tickinitial:1,ontick:{type:"area",range:15,coeff:4,elem:"max",skill:"corpsespiders"}}),t.after(48,s)})},e.set_arachyr_4pc=function(){t.register("oncast",function(e){"hex"===e.skill&&t.addBuff("arachyr_4pc",{dmgred:50},{duration:900})})},e.set_arachyr_6pc=function(){t.addBaseStats({dmgmul:{skills:["corpsespiders","plagueoftoads","firebats","hex","locustswarm","piranhas"],percent:9e3}})},e.set_shenlong_2pc=function(){t.register("oncast",function(e){if(e.generate)return{percent:2*t.resources.spirit}}),t.register("updatestats",function(e){t.getBuff("shenlong_2pc")&&(e.stats.spiritregen=-65)}),t.after(12,function e(){t.resources.spirit>=t.stats.maxspirit-1?t.addBuff("shenlong_2pc",{dmgmul:200},{}):t.resources.spirit<=1&&t.removeBuff("shenlong_2pc"),t.after(12,e)})},e.set_inna_4pc=function(){for(var e=["mantraofsalvation","mantraofretribution","mantraofhealing","mantraofconviction"],s=0;s<e.length;++s){var a=e[s];!t.stats.skills[a]&&t.skills[a]&&(t.pushCastInfo({skill:a,rune:"x",elem:t.getProp(t.skills[a],"elem","x")}),t.skills[a].oninit("x"),t.popCastInfo())}},e.set_inna_6pc=function(){if(!t.stats.skills.mystically&&t.skills.mystically){var e=t.skills.mystically;t.pushCastInfo({skill:"mystically",rune:"x",buffs:[],elem:t.getProp(e,"elem","x"),proc:t.getProp(e,"proctable","x")}),t.getProp(e,"oninit","x"),t.popCastInfo()}var s;t.watchBuff("mystically",function(e){s=t.setBuffStacks(s,{dmgmul:750},e.stacks)})},e.set_sunwuko_2pc=function(){t.watchBuff("sweepingwind",function(e){e.stacks?t.addBuff("sunwuko_2pc",{dmgred:50}):t.removeBuff("sunwuko_2pc")})},e.set_sunwuko_4pc=function(){t.after(60,function e(){var s=t.getBuff("sweepingwind");s&&t.damage({type:"area",range:15,coeff:10*s,elem:"max"}),t.after(60,e)})},e.set_sunwuko_6pc=function(){t.register("oncast",function(e){if(["lashingtailkick","tempestrush","waveoflight"].indexOf(e.skill)>=0)return{percent:1500*t.getBuff("sweepingwind")}})},e.set_storms_2pc=function(){t.addBaseStats({dmgmul:{skills:["fistsofthunder","deadlyreach","cripplingwave","wayofthehundredfists"],percent:500}})},e.set_storms_6pc=function(){"monk"===t.stats.charClass&&t.register("oncast",function(e){e.generate?t.addBuff("storms_6pc_ds",void 0,{duration:360}):"dashingstrike"===e.skill&&t.addBuff("storms_6pc_gen",{dmgmul:{skills:["fistsofthunder","deadlyreach","cripplingwave","wayofthehundredfists"],percent:6e3}},{duration:360})})},e.set_uliana_2pc=function(){t.register("oncast",function(e){e.generate&&(e.user.sequence=t.getBuff(e.skill))}),t.register("onhit",function(e){e.castInfo&&e.castInfo.user&&2===e.castInfo.user.sequence&&t.apply_palm&&(t.apply_palm(e.targets,e.firsttarget),delete e.castInfo.user.sequence)})},e.set_uliana_6pc=function(){t.addBaseStats({dmgmul:{skills:["explodingpalm"],percent:9e3}}),t.register("onhit",function(e){e.castInfo&&e.castInfo.user&&"sevensidedstrike"===e.castInfo.skill&&t.getBuff("explodingpalm",e.firsttarget)&&t.explode_palm(e.firsttarget)})},e.set_roland_2pc=function(){var e=["lawsofvalor","lawsofjustice","lawsofhope","shieldglare","ironskin","consecration","judgment"];t.register("oncast",function(s){if("shieldbash"===s.skill||"sweepattack"===s.skill)for(var a=0;a<e.length;++a)t.reduceCooldown(e[a],60)})},e.set_roland_4pc=function(){t.addBaseStats({dmgmul:{skills:["shieldbash","sweepattack"],percent:13e3}})},e.set_roland_6pc=function(){t.register("onhit",function(e){!e.castInfo||"shieldbash"!==e.castInfo.skill&&"sweepattack"!==e.castInfo.skill||e.castInfo.user&&!e.castInfo.user.roland_6pc&&(t.addBuff("roland_6pc",{ias:75,dmgred:15},{duration:480,maxstacks:5}),e.castInfo.user.roland_6pc=!0)})},e.set_light_2pc=function(){t.register("onhit",function(e){e.castInfo&&"blessedhammer"===e.castInfo.skill&&e.castInfo.user&&!e.castInfo.user.light_2pc&&(t.reduceCooldown("fallingsword",60),t.reduceCooldown("provoke",60),e.castInfo.user.light_2pc=!0)})},e.set_light_4pc=function(){t.register("oncast",function(e){"fallingsword"===e.skill&&t.after(54,function(){t.addBuff("light_4pc",{dmgred:50},{duration:480})})})},e.set_light_6pc=function(){t.addBaseStats({dmgmul:{skills:["blessedhammer"],percent:12e3}}),t.addBaseStats({dmgmul:{skills:["fallingsword"],percent:1e3}})},e.set_immortalking_4pc=function(){t.register("resourceloss",function(e){if("fury"===e.type&&e.castInfo&&e.castInfo.offensive)for(var s=t.random("immortalking_4pc",1,e.amount/10,!0);s--;)t.reduceCooldown("wrathoftheberserker",180),t.reduceCooldown("calloftheancients",180)})},e.set_immortalking_6pc=function(){t.after(60,function e(){t.getBuff("wrathoftheberserker")&&t.getBuff("calloftheancients")&&t.addBuff("immortalking_6pc",{dmgmul:4e3},{duration:72}),t.after(60,e)})},e.set_earth_2pc=function(){t.register("resourceloss",function(e){if("fury"===e.type&&e.castInfo&&e.castInfo.offensive){var s=t.random("earth_2pc",1,e.amount/30,!0);s&&(t.reduceCooldown("earthquake",60*s),t.reduceCooldown("avalanche",60*s),t.reduceCooldown("leap",60*s),t.reduceCooldown("groundstomp",60*s))}})},e.set_earth_4pc=function(){t.register("oncast",function(e){"leap"!==e.skill||e.triggered||t.cast("earthquake",void 0,"soft")})},e.set_earth_6pc=function(){t.addBaseStats({dmgmul:{skills:["earthquake","avalanche","leap","groundstomp","ancientspear","seismicslam"],percent:2e4}})},e.set_wastes_2pc=function(){t.addBaseStats({dmgmul:{skills:["rend"],percent:500}})},e.set_wastes_6pc=function(){t.addBaseStats({dmgmul:{skills:["whirlwind"],percent:1e4}})},e.set_jadeharvester_4pc=function(){t.register("oncast",function(e){"haunt"!==e.skill&&"locustswarm"!==e.skill||e.triggered||t.reduceCooldown("soulharvest",60)})},e.set_raekor_4pc=function(){t.addBaseStats({dmgmul:{skills:["furiouscharge"],percent:1e3}})},e.set_raekor_6pc=function(){t.register("oncast",function(e){if("furiouscharge"===e.skill)t.addBuff("raekor_6pc",void 0,{maxstacks:100});else if(e.cost&&"fury"===e.resource){var s=Math.min(5,t.getBuff("raekor_6pc"));if(s)return t.removeBuff("raekor_6pc",s),{percent:5500*s}}})},e.set_danetta_2pc=function(){t.addBaseStats({dmgmul:{skills:["vault"],percent:800}})},e.set_endlesswalk_2pc=function(){var e=0;t.params.set_endlesswalk_2pc&&t.params.set_endlesswalk_2pc[0]&&(e=t.params.set_endlesswalk_2pc[0][0]||0),t.addBaseStats({dmgmul:20*(5-e),dmgred:10*e})},e.set_nightmares_2pc=function(){for(var e in t.stats)if(t.stats[e]&&0===e.indexOf("set_")&&"set_nightmares_2pc"!==e)return;t.addBaseStats({dmgmul:750*t.stats.info.ancients,dmgred:4*t.stats.info.ancients})},e.set_shadow_2pc=function(){var e=t.stats.info.mainhand.type;e&&"bow"!==e&&"crossbow"!==e&&"handcrossbow"!==e&&t.addBaseStats({dmgmul:6e3})},e.set_invoker_2pc=function(){t.register("onhit_proc",function(e){!e.castInfo||"punish"!==e.castInfo.skill&&"slash"!==e.castInfo.skill||!e.castInfo.user||e.castInfo.user.invoker_2pc||(t.addBuff("invoker_2pc",{thorns_percent:350},{maxstacks:25,duration:120,refresh:!1}),e.castInfo.user.invoker_2pc=!0)}),t.register("onblock",function(){t.addBuff("invoker_2pc",{thorns_percent:350},{maxstacks:25,duration:120,refresh:!1})})},e.set_invoker_4pc=function(){t.register("onhit",function(e){e.castInfo&&"bombardment"===e.castInfo.skill&&t.addBuff("invoker_4pc",{dmgred:50},{duration:1200})})},e.set_invoker_6pc=function(){t.register("onhit_proc",function(e){!e.castInfo||"punish"!==e.castInfo.skill&&"slash"!==e.castInfo.skill||!e.castInfo.user||e.castInfo.user.invoker_6pc||(t.damage({thorns:"special",coeff:150,elem:"phy",srcelem:"none"}),e.castInfo.user.invoker_6pc=!0)})}}();!function(){var e=Simulator,t=e.affixes,a=e.gems;e.register("init",function(){var t={hitfear:{status:"feared",duration:180},hitstun:{status:"stunned",duration:180},hitblind:{status:"blinded",duration:180},hitfreeze:{status:"frozen",duration:180},hitchill:{status:"chilled",duration:180},hitslow:{status:"slowed",duration:180},hitimmobilize:{status:"rooted",duration:180},hitknockback:{status:"knockback",duration:30}};for(var a in t)e.stats[a]&&(e.pushCastInfo({triggered:a}),e.register("onhit_proc",e.apply_effect(t[a].status,t[a].duration,.01*e.stats[a],!0)),e.popCastInfo());e.stats.bleed&&(e.pushCastInfo({triggered:"bleed"}),e.register("onhit_proc",function(t){var a=e.target.random("bleed",.01*e.stats.bleed.chance*t.proc,t);a.length&&e.addBuff("bleed",void 0,{duration:300,targets:a,tickrate:15,data:{amount:e.stats.bleed.amount},ontick:function(t){e.damage({elem:"phy",coeff:.01*t.amount/20,orphan:!0})}})}),e.popCastInfo()),e.pushCastInfo({triggered:"thorns"}),e.register("ongethit",function(){var t=1;e.stats.set_invoker_2pc&&(t=Math.max(t,e.getTargets(15,e.target.distance)));var a=1;e.stats.leg_votoyiasspiker&&e.getBuff("provoke")&&(a*=2),e.damage({thorns:"normal",coeff:a,targets:t,elem:"phy"})}),e.popCastInfo()}),a.powerful=function(t){t>=25&&e.addBaseStats({edmg:15,edef:15}),e.params.powerful&&e.params.powerful[0]&&e.addBuff("powerful",{dmgmul:20})},a.trapped=function(t){if(t>=25){var a=e.getTargets(15,e.target.distance);a&&e.addBuff(void 0,void 0,{status:"slowed",targets:a,aura:!0})}e.register("updatestats",function(a){var n=a.stats.countStatus("chilled","frozen","blinded","stunned","slowed","knockback","charmed","feared","rooted");n&&a.stats.add("dmgmul",(15+.3*t)*n/e.target.count)})},a.enforcer=function(t){e.addBaseStats({dmgmul:{pet:!0,percent:15+.3*t}})},a.toxin=function(t){var a=t>=25?{dmgtaken:10}:void 0;e.register("onhit",function(n){e.addBuff("toxin",a,{duration:600,targets:n.targets,firsttarget:n.firsttarget,tickrate:15,ontick:{elem:"psn",coeff:(20+.5*t)/40}})})},a.gogok=function(t){var a={ias:1,dodge:.5+.01*t};t>=25&&(a.cdr=1);var n=0;e.register("onhit_proc",function(t){e.time>=n&&(e.addBuff("gogok",a,{duration:240,maxstacks:15}),n=e.time+54)})},a.mirinae=function(t){var a=30+.6*t;e.register("onhit_proc",function(t){for(var n=e.random("mirinae",.15*t.proc,t.targets*t.count,!0);n--;)e.damage({elem:"hol",coeff:a})}),t>=25&&e.after(180,function t(){e.damage({elem:"hol",coeff:a}),e.after(180,t)})},a.pain=function(t){e.register("onhit",function(a){var n=e.target.random("pain",a.chc,a);n.length&&e.addBuff("pain",void 0,{duration:180,targets:n,tickrate:15,ontick:{elem:"phy",coeff:(25+.5*t)/12}})}),t>=25&&e.watchBuff("pain",function(t){var a=Math.min(t.targets,e.getTargets(20,e.target.distance));e.setBuffStacks("painias",{ias:3},Math.round(a))})},a.simplicity=function(t){var a=[];for(var n in e.skills)e.skills[n].signature&&a.push(n);e.addBaseStats({dmgmul:{skills:a,percent:25+.5*t}})},a.taeguk=function(t){var a={damage:2+.04*t};t>=25&&(a.armor_percent=2),e.register("oncast",function(t){t.cost&&t.channeling&&e.addBuff("taeguk",a,{maxstacks:10,duration:90})})},a.wreath=function(t){var a=(12.5+.25*t)/5;e.register("onhit_proc",function(t){e.random("wreath",.15*t.proc,t.targets*t.count)&&e.addBuff("wreath",void 0,{duration:180,tickrate:12,ontick:{targets:2,elem:"lit",coeff:a}})})},a.iceblink=function(t){e.register("onhit",function(t){"col"===t.elem&&e.addBuff("chilled",void 0,{duration:180,targets:t.targets,firsttarget:t.firsttarget})}),t>=25&&e.register("updatestats",function(t){var a=t.stats.countStatus("chilled");a&&t.stats.add("chctaken",10*a/e.target.count)})},a.stricken=function(t){var a=0;e.register("onhit_proc",function(n){e.time>=a&&(e.addBuff("stricken",{dmgmul:.8+.01*t},{maxstacks:9999,targets:1,firsttarget:n.firsttarget}),a=e.time+e.magic_icd())}),t>=25&&e.addBaseStats({bossdmg:25})},a.boyarsky=function(t){e.addBaseStats({thorns:16e3+800*t})},a.soulshard=function(t){e.after(1800,function a(){e.damage({type:"line",speed:.7,coeff:125+.5*t,range:80,count:8,fan:45,merged:!0,angle:22.5,elem:"fir"}),e.after(1800,a)})},t.leg_wandofwoh=function(t){function a(t){e.cast("explosiveblast",t.rune)}e.addBaseStats({dmgmul:{skills:["explosiveblast"],percent:100}}),e.register("oncast",function(t){"explosiveblast"===t.skill&&(e.after(30,a,{rune:t.rune}),e.after(60,a,{rune:t.rune}),e.after(90,a,{rune:t.rune}))})},t.leg_wandofwoh_p6=function(t){function a(t){e.cast("explosiveblast",t.rune)}e.addBaseStats({dmgmul:{skills:["explosiveblast"],percent:t}}),e.register("oncast",function(t){"explosiveblast"===t.skill&&(e.after(30,a,{rune:t.rune}),e.after(60,a,{rune:t.rune}),e.after(90,a,{rune:t.rune}))})},t.leg_thefurnace=function(t){e.addBaseStats({edmg:t})},t.leg_triumvirate=t.leg_triumvirate_p2=t.leg_triumvirate_p6=function(t){e.register("oncast",function(a){e.skills[a.skill]&&e.skills[a.skill].signature&&e.addBuff("triumvirate",{dmgmul:{skills:["arcaneorb"],percent:t}},{maxstacks:3,duration:360})})},t.leg_stormcrow=function(t){var a=0;e.register("onhit_proc",function(n){e.time>=a&&e.random("stormcrow",.01*t,n.targets*n.count)&&(e.damage({type:"line",elem:"fir",coeff:1.15,speed:.75,area:10}),a=e.time+240)})},t.leg_shimizushaori=function(t){e.params.leg_shimizushaori&&e.params.leg_shimizushaori[0]&&e.addBaseStats({extrachc:100})},t.leg_ingeom=function(t){e.params.leg_ingeom&&e.params.leg_ingeom[0]&&e.addBuff("ingeom",{cdrint:t})},t.leg_eunjangdo=function(t){e.register("onhit_proc",function(a){var n=e.listTargetsBelow(.01*t,a);n.length&&e.addBuff("frozen",void 0,{duration:180,targets:n})})},t.leg_frostburn=function(t){e.register("onhit_proc",function(a){if("col"===a.elem){var n=e.target.random("frostburn",.01*t*a.proc,a);n.length&&e.addBuff("frozen",void 0,{duration:36,targets:n})}})},t.leg_magefist=function(t){e.addBaseStats({dmgfir:t})},t.leg_frostburn_p2=function(t){e.addBaseStats({dmgcol:t}),e.register("onhit_proc",function(t){if("col"===t.elem){var a=e.target.random("frostburn",.5*t.proc,t);a.length&&e.addBuff("frozen",void 0,{duration:36,targets:a})}})},t.leg_conventionofelements=function(t){var a={wizard:["arc","col","fir","lit"],demonhunter:["col","fir","lit","phy"],witchdoctor:["col","fir","phy","psn"],monk:["col","fir","hol","lit","phy"],barbarian:["col","fir","lit","phy"],crusader:["fir","hol","lit","phy"]}[e.stats.charClass],n=0;!function r(){var s=a[n++];n>=a.length&&(n=0),e.addBuff("coe_"+s,{dmgmul:{elems:[s],percent:t}},{duration:240,onexpire:r})}()},t.leg_obsidianringofthezodiac=function(t){var a=[];for(var n in e.stats.skills)a.push(n);var r=0;e.register("onhit",function(t){if(t.castInfo&&t.castInfo.cost&&!t.castInfo.pet&&t.castInfo.user&&!t.castInfo.user.zodiac){t.castInfo.user.zodiac=!0;for(var n=0;n<6;++n){var s=a[r];if(r=(r+1)%a.length,e.getCooldown(s)>=10){e.reduceCooldown(s,60);break}}}})},t.leg_wyrdward=t.leg_wyrdward_p2=function(t){e.register("onhit_proc",function(a){if("lit"===a.elem){var n=e.target.random("wyrdward",.01*t*a.proc,a);n.length&&e.addBuff("stunned",void 0,{duration:90,targets:n})}})},t.leg_overwhelmingdesire=function(t){e.register("onhit_proc",function(t){var a=e.target.random("overwhelmingdesire",.05*t.proc,t);a.length&&e.addBuff("overwhelmingdesire",{dmgtaken:35},{duration:180,targets:a,status:"charmed"})})},t.leg_pridesfall=function(t){e.addBuff("pridesfall",{rcr:30});var a;e.register("ongethit",function(){e.removeBuff("pridesfall"),a&&e.removeEvent(a),a=e.after(300,function(){e.addBuff("pridesfall",{rcr:30})})})},t.leg_hexingpantsofmryan=function(t){e.params.leg_hexingpantsofmryan&&e.params.leg_hexingpantsofmryan[0]?e.addBaseStats({damage:25,resourcegen:25}):e.addBaseStats({damage:-t,resourcegen:-t})},t.leg_bloodbrother=function(t){e.addBaseStats({block:t}),e.register("onblock",function(){e.addBuff("bloodbrother")}),e.register("oncast",function(){if(e.getBuff("bloodbrother"))return e.removeBuff("bloodbrother"),{percent:30}})},t.leg_andarielsvisage=t.leg_andarielsvisage_p2=function(t){var a=0;e.register("onhit_proc",function(n){a<=n.time&&(e.damage({type:"area",range:10,self:!0,elem:"psn",coeff:.01*t}),a=n.time+Math.floor(54/e.stats.info.aps))})},t.leg_bandofhollowwhispers=function(t){e.addBuff("bandofhollowwhispers",void 0,{tickrate:90,ontick:{elem:"arc",coeff:1.5*e.stats.info.aps}})},t.leg_bulkathossweddingband=function(t){e.addBuff(void 0,void 0,{tickrate:12,ontick:{type:"area",range:8,self:!0,elem:"phy",coeff:4}})},t.leg_hellfirering=function(t){var a=0;e.register("onhit_proc",function(t){a<=e.time&&e.random("hellfirering",.5*t.proc,t.targets*t.count)&&(e.addBuff("hellfirering",void 0,{duration:360,tickrate:30,ontick:{type:"area",range:16,elem:"fir",coeff:1}}),a=e.time+2700)})},t.leg_nagelring=function(t){e.addBuff(void 0,void 0,{tickrate:60*t,ontick:{type:"area",range:10,type:"phy",coeff:100}})},t.leg_firewalkers=t.leg_firewalkers_p2=function(t){t=Math.max(t,100),e.addBuff(void 0,void 0,{tickrate:18,ontick:{type:"area",range:5,type:"fir",coeff:.003*t}})},t.leg_poxfaulds=t.leg_poxfaulds_p2=function(t){var a="leg_poxfaulds"==this?900:300,n="leg_poxfaulds"==this?600:300;!function r(){e.getTargets(12,e.target.distance)>=3&&e.addBuff("poxfaulds",void 0,{duration:n,tickdelay:30,ontick:{type:"area",range:15,elem:"psn",coeff:.005*t}}),e.after(a,r)}()},t.leg_moonlightward=function(t){e.register("onhit_proc",function(a){e.random("moonlightward",a.proc,a.targets*a.count)&&e.addBuff("moonlightward",void 0,{duration:7200,maxstacks:4,tickrate:30,ontick:function(){e.getTargets(15,e.target.distance)>=.5&&(e.damage({type:"area",range:15,self:!0,elem:"arc",coeff:.01*t}),e.removeBuff("moonlightward",1))}})})},t.leg_sashofknives=function(t){var a=0;e.register("onhit_proc",function(n){e.time>=a&&e.random("sashofknives",.25*n.proc,n.targets*n.count)&&(e.damage({type:"line",range:50,speed:2,elem:"phy",coeff:.01*t}),a=e.time+Math.floor(54/e.stats.info.aps))})},t.leg_sashofknives_p2=function(t){var a=0;e.register("onhit_proc",function(n){e.time>=a&&(e.damage({type:"line",range:50,speed:2,elem:"phy",coeff:.01*t}),a=e.time+Math.floor(54/e.stats.info.aps))})},t.leg_scourge=function(t){var a=0;e.register("oncast",function(n){e.time>=a&&n.offensive&&e.random("scourge",.01*t)&&(e.damage({type:"area",range:13,self:!0,elem:"fir",coeff:19}),a=e.time+150)})},t.leg_stalgardsdecimator=function(t){var a=0;e.register("oncast",function(n){e.time>=a&&n.melee&&(e.damage({type:"line",pierce:!0,speed:1,elem:"phy",coeff:.01*t}),a=e.time+Math.floor(54/e.stats.info.aps))})},t.leg_schaefershammer=function(t){e.register("ongethit",function(a){e.addBuff("schaefershammer",void 0,{duration:300,tickrate:60,ontick:function(a){e.damage({type:"area",range:20,self:!0,elem:"lit",coeff:.01*t})}})})},t.leg_schaefershammer_p2=function(t){e.register("oncast",function(a){"lit"===a.elem&&e.addBuff("schaefershammer",void 0,{duration:300,tickrate:60,ontick:function(a){e.damage({type:"area",range:20,self:!0,elem:"lit",coeff:.01*t})}})})},t.leg_cinderswitch=function(t){var a=0;e.register("oncast",function(n){e.time>=a&&e.random("cinderswitch",.01*t)&&(e.damage({type:"line",area:6,speed:1,elem:"fir",coeff:2.5}),a=e.time+60)})},t.leg_skysplitter=t.leg_skysplitter_p2=function(t){var a=0,n="leg_skysplitter"==this?1.65:6.75,r="leg_skysplitter"==this?210:12;e.register("onhit_proc",function(s){e.time>=a&&e.random("skysplitter",.01*t*s.proc,s.targets*s.count)&&(e.damage({elem:"lit",coeff:n}),e.addBuff("stunned",void 0,30),a=e.time+r)})},t.leg_hack=function(t){e.register("onhit_proc",function(a){if(a.castInfo&&a.castInfo.globUser&&!a.castInfo.globUser.hack){a.castInfo.globUser.hack=!0;var n=1;e.stats.set_invoker_2pc&&(n=Math.max(n,e.getTargets(15,e.target.distance)));var r=.01*t;e.stats.leg_votoyiasspiker&&e.getBuff("provoke")&&(r*=2),e.damage({thorns:"normal",coeff:r,count:n,elem:"phy"})}})},t.leg_wizardspike=function(t){var a=0;e.register("oncast",function(n){n.offensive&&e.time>=a&&e.random("wizardspike",.01*t)&&(e.damage({skill:"arcaneorb",elem:"col",type:"area",origin:e.target.distance-30,coeff:9.5,range:15,delay:50}),e.damage({skill:"arcaneorb",elem:"col",type:"line",coeff:6.35,pierce:!0,range:30,speed:.6,radius:15}),e.damage({skill:"arcaneorb",elem:"col",type:"line",coeff:3.15,pierce:!0,range:30,radius:15,delay:50.6,proc:.013}),a=e.time+120)})},t.leg_odynson=function(t){var a=0;e.register("onhit_proc",function(n){e.time>=a&&e.random("odynson",.01*t*n.proc,n.targets*n.count)&&(e.damage({elem:"lit",coeff:1.1,count:3}),a=e.time+60)})},t.leg_fulminator=t.leg_fulminator_p3=function(t){e.register("onhit_proc",function(a){e.target.random("fulminator",a.proc,a).length&&e.addBuff("fulminator",void 0,{duration:360,tickrate:30,ontick:{type:"area",range:10,cmod:-1,elem:"lit",coeff:.005*t}})})},t.leg_rimeheart=function(t){var a=0;e.register("onhit_proc",function(t){e.time>=a&&e.stats.frozen&&e.random("rimeheart",.2*t.proc,t.targets*t.count)&&(e.damage({elem:"col",coeff:100}),a=e.time+6)})},t.leg_thunderfury=function(t){var a=0;e.register("onhit_proc",function(n){e.time>=a&&e.random("thunderfury",.6*n.proc,n.targets*n.count)&&(e.damage({elem:"lit",coeff:.01*t,targets:6,onhit:e.apply_effect("slowed",180)}),a=e.time+Math.floor(54/e.stats.info.aps))})},t.leg_azurewrath=t.leg_azurewrath_p3=function(t){e.addBuff(void 0,void 0,{tickrate:30,ontick:function(a){("undead"===e.target.type||e.stats.leg_azurewrath_p3&&"demon"===e.target.type)&&e.damage({type:"area",range:25,self:!0,elem:"hol",coeff:.005*t})}})},t.leg_shardofhate=function(t){function a(a){if(("oncast"!==a.event||a.offensive)&&e.time>=n&&r[a.elem]){switch(a.elem){case"col":e.damage({type:"line",pierce:!0,speed:1.2,elem:"col",coeff:.01*t});break;case"lit":e.damage({type:"line",pierce:!0,speed:.65,fan:10,count:3,elem:"lit",coeff:.01*t});break;case"psn":e.damage({type:"area",range:12,self:!0,elem:"psn",coeff:.01*t})}n=e.time+Math.floor(24/e.stats.info.aps)}}var n=0,r={col:!0,psn:!0,lit:!0};e.register("oncast",a),e.register("onhit_proc",a)},t.leg_taskerandtheo=function(t){e.addBaseStats({petias:t})},t.leg_calamity=function(t){e.register("onhit",function(t){t.pet||e.cast("markedfordeath")})},t.leg_helltrapper=function(t){var a=["spiketrap","caltrops","sentry"],n=0,r=0;e.register("onhit_proc",function(s){e.time>=r&&e.random("helltrapper",.01*t*s.proc,s.targets*s.count)&&(e.cast(a[n]),n=(n+1)%a.length,r=e.time+6)})},t.leg_solanium=function(t){var a=0;e.register("onhit_proc",function(n){e.time>=a&&e.random("solanium",.01*t*n.proc*n.chc,n.targets*n.count)&&(e.trigger("onglobe"),a=e.time+480)})},t.leg_razorstrop=function(t){e.register("onglobe",function(a){e.damage({type:"area",range:20,self:!0,elem:"fir",coeff:.01*t})})},t.leg_reaperswraps=function(t){e.register("onglobe",function(a){var n=e.stats["max"+e.rcTypes[0]];n&&e.addResource(.01*t*n)})},t.leg_cluckeye=function(t){var a=0;e.register("oncast",function(n){n.offensive&&e.time>=a&&e.random("cluckeye",.01*t)&&(e.damage({type:"line",speed:.5,elem:"phy",coeff:5,onhit:e.apply_effect("blinded",120)}),a=e.time+18)})},t.leg_demonmachine=function(t){var a=0;e.register("oncast",function(n){n.offensive&&e.time>=a&&e.random("demonmachine",.01*t)&&(e.damage({type:"line",speed:1,elem:"fir",coeff:1.15}),a=e.time+18)})},t.leg_pusspitter=function(t){var a=0;e.register("oncast",function(n){n.offensive&&e.time>=a&&e.random("pusspitter",.01*t)&&(e.addBuff("pusspitter",void 0,{duration:300,tickrate:30,tickinitial:1,ontick:{type:"area",range:6,elem:"psn",coeff:.5}}),a=e.time+18)})},t.leg_hellrack=function(t){var a=0;e.register("onhit_proc",function(t){if(e.time>=a){var n=e.target.random("hellrack",t.proc,t);n.length&&(e.addBuff("rooted",void 0,{duration:120,targets:n}),a=e.time+6)}})},t.leg_strongarmbracers=function(t){e.register("updatestats",function(a){a.stats.countStatus("knockback")&&e.addBuff("strongarmbracers",{dmgtaken:t/e.target.count},{duration:360})})},t.leg_rechelsringoflarceny=function(t){e.register("updatestats",function(a){a.stats.feared&&e.addBuff("rechelsringoflarceny",{extrams:t},{duration:240})})},t.leg_starmetalkukri=function(t){var a=["fetisharmy","fetishsycophants","thegidbinn"];e.register("onhit",function(t){(a.indexOf(t.skill)>=0||t.castInfo&&t.castInfo.triggered&&a.indexOf(t.triggered)>=0)&&(e.reduceCooldown("fetisharmy",60),e.reduceCooldown("bigbadvoodoo",60))})},t.leg_homunculus=t.leg_homunculus_p2=t.leg_homunculus_p3=function(t){"leg_homunculus_p2"!=this&&"leg_homunculus_p3"!=this||(t=2),e.after(60*t,function a(){e.cast("summonzombiedogs"),e.after(60*t,a)})},t.leg_theshortmansfinger=function(t){e.addBaseStats({dmgmul:{skills:["gargantuan"],percent:200}})},t.leg_theshortmansfinger_p6=function(t){e.addBaseStats({dmgmul:{skills:["gargantuan"],percent:t}})},t.leg_wormwood=function(t){e.after(30,function t(){e.getTargets(16,e.target.distance)&&e.cast("locustswarm"),e.after(30,t)})},t.leg_carnevil=function(t){e.register("oncast",function(t){if("poisondart"===t.skill)for(var a=!!e.stats.leg_thedaggerofdarts||void 0,n=["fetisharmy","fetishsycophants","thegidbinn"],r=5,s=0;s<n.length&&r;++s){var i=e.petdelay(n[s],r);if(i){e.pushCastInfo({triggered:n[s],castId:t.castId});var a=!!e.stats.leg_thedaggerofdarts,o=1.3*e.stats.info.aps*3.5;"fetishsycophants"===n[s]&&(o*=1+.01*(e.stats.skill_witchdoctor_fetisharmy||0)),e.damage({type:"line",pierce:a,speed:1.5,skill:"poisondart",pet:!0,elem:"psn",coeff:o,count:i}),e.popCastInfo(),r-=i}}})},t.leg_beltoftranscendence=function(t){e.register("onhit_proc",function(t){t.castInfo&&t.castInfo.cost&&e.summon_sycophant&&e.summon_sycophant()})},t.leg_thegidbinn=function(t){var a=0;e.register("onhit_proc",function(t){e.time>=a&&e.random("thegidbinn",.25*t.proc,t.targets*t.count)&&(e.petattack("thegidbinn",void 0,{duration:1200,tickrate:48,refresh:!1,maxstacks:5,ontick:function(){e.damage({pet:!0,distance:5,coeff:1.8*e.stats.info.aps})}}),a=e.time+300)})},t.leg_kekegisunbreakablespirit=function(t){var a=0;e.register("onhit_proc",function(n){e.time>=a&&e.random("kekegisunbreakablespirit",.2*n.proc,n.targets*n.count)&&(e.addBuff("kekegisunbreakablespirit",{rcr_spirit:100},{duration:60*t}),a=e.time+1800)})},t.leg_thelawsofseph=function(t){e.register("oncast",function(a){"blindingflash"===a.skill&&e.addResource(t)})},t.leg_flyingdragon=function(t){if("monk"===e.stats.charClass){var a=0;e.register("oncast",function(t){e.time>=a&&t.offensive&&e.random("flyingdragon",.04)&&(e.addBuff("flyingdragon",{weaponaps_percent:100},{duration:420}),a=e.time+300)})}},t.leg_spiritguards=t.leg_spiritguards_p6=function(t){"monk"===e.stats.charClass&&e.register("oncast",function(a){a.generate&&e.addBuff("spiritguards",{dmgred:t},{duration:180})})},t.leg_hunterswrath=function(t){e.addBaseStats({dmgmul:{skills:["hungeringarrow","entanglingshot","bolas","evasivefire","grenade"],percent:t}})},t.leg_bindingofthelost=t.leg_bindingofthelost_p6=function(t){e.register("onhit",function(t){t.castInfo&&"sevensidedstrike"===t.castInfo.skill&&e.addBuff("bindingofthelost",void 0,{duration:420,maxstacks:50,refresh:!1})})},t.leg_wrapsofclarity=t.leg_wrapsofclarity_p6=function(t){"demonhunter"===e.stats.charClass&&e.register("oncast",function(a){a.generate&&e.addBuff("wrapsofclarity",{dmgred:t},{duration:300})})},t.leg_jeramsbracers=function(t){e.addBaseStats({dmgmul:{skills:["wallofdeath"],percent:t}})},t.leg_hellskull=function(t){"twohand"==e.stats.info.mainhand.slot&&e.addBaseStats({damage:10})},t.leg_sacredharness=function(t){e.register("oncast",function(t){"fallingsword"===t.skill&&e.after(54,function(){e.cast("judgment")})})},t.leg_blessedofhaull=function(t){e.register("onhit",function(t){t.castInfo&&"justice"===t.castInfo.skill&&t.castInfo.user&&!t.castInfo.user.blessedofhaull&&(e.cast_hammer(!1),t.castInfo.user.blessedofhaull=!0)})},t.leg_beltofthetrove=function(t){e.after(60*t,function a(){e.cast("bombardment",void 0,"soft"),e.after(60*t,a)})},t.leg_brokenpromises=function(t){var a=new Float32Array(96);a[90]=1;var n=0,r=0,s=0;e.register("onhit_proc",function(t){if(!e.getBuff("brokenpromises")){for(var i=Math.pow(1-t.chc,t.count||1),o=new Float32Array(96),f=e.time-n,l=0;l<16;++l)for(var c=0;c<5;++c){var d=a[6*l+c],u=4===c?1-t.chc:i;l+f>=15?o[c+1]+=d*u:o[6*(l+f)+c]+=d*u,o[6*Math.min(l+f,15)]+=d*(1-u)}++s;var g=1-a[5],m=1-(o[5]+a[5]),p=o[5];if(o[5]+=a[5],r+=(m+g)/2,p>1e-6){a[5]<1e-6&&(p/=s);var h=m*m/p;r+h<s&&(e.addBuff("brokenpromises",{chc:100},{duration:180}),r=0,(o=new Float32Array(96))[90]=1,s=s-r-h)}a=o,n=e.time}})},t.leg_bracersofthefirstmen=t.leg_bracersofthefirstmen_p6=function(t){e.addBaseStats({dmgmul:{skills:["hammeroftheancients"],percent:t}})},t.leg_maskofjeram=t.leg_maskofjeram_p6=function(t){e.addBaseStats({petdamage:t})},t.leg_depthdiggers=function(t){e.register("oncast",function(a){if(e.skills[a.skill]&&e.skills[a.skill].signature&&a.generate)return{percent:t}})},t.leg_chainofshadows=function(t){e.register("oncast",function(t){"impale"===t.skill&&e.addBuff("chainofshadows",void 0,{duration:120})})},t.leg_stringofears=function(t){e.addBaseStats({meleedef:t})},t.leg_zoeyssecret=function(t){var a;e.watchBuff("companion",function(n){a=e.setBuffStacks(a,{dmgred:t},n.stacks)})},t.leg_kyoshirossoul=function(t){e.after(120,function t(){e.getBuff("sweepingwind")&&!e.getTargets(10,e.target.distance)&&e.addBuff("sweepingwind",void 0,{stacks:2}),e.after(120,t)})},t.leg_riveradancers=function(t){e.addBaseStats({dmgmul:{skills:["lashingtailkick"],percent:t}})},t.leg_pintospride=function(t){e.register("oncast",function(a){if("waveoflight"===a.skill)return e.addBuff("slowed",void 0,180),{percent:t}})},t.leg_cesarsmemento=t.leg_cesarsmemento_p6=function(t){function a(a,n){e.addBuff("cesarsmemento",{dmgmul:{skills:["tempestrush"],percent:t}},{duration:300,targets:n})}e.watchStatus("blinded",a),e.watchStatus("frozen",a),e.watchStatus("stunned",a)},t.leg_bindingsofthelessergods=function(t){e.register("onhit_proc",function(a){a.castInfo&&"cyclonestrike"===a.castInfo.skill&&e.addBuff("bindingsofthelessergods",{dmgmul:{skills:["mystically"],percent:t}},{duration:300,targets:a.targets,firsttarget:a.firsttarget})})},t.leg_lastbreath=function(t){e.addBaseStats({skill_witchdoctor_massconfusion_cooldown:t})},t.leg_aquilacuirass=function(t){!function a(){e.getResource()/e.getMaxResource()>.01*t?e.addBuff("aquilacuirass",{dmgred:50}):e.removeBuff("aquilacuirass"),e.after(15,a)}()},t.leg_heartofiron=function(t){e.addBaseStats({vit_to_thorns:t})},t.leg_liannaswings=function(t){e.register("oncast",function(t){"shadowpower"===t.skill&&e.cast("smokescreen")})},t.leg_warhelmofkassar=function(t){e.addBaseStats({dmgmul:{skills:["phalanx"],percent:t}})},t.leg_bladeofthewarlord=function(t){e.register("oncast",function(e){if("bash"===e.skill&&e.cost)return{percent:t*e.cost/40}})},t.leg_oathkeeper=function(t){e.addBaseStats({dmgmul:{skills:["bash","cleave","frenzy","weaponthrow"],percent:t}})},t.leg_bladeofthetribes=function(t){e.register("oncast",function(t){"warcry"!==t.skill&&"threateningshout"!==t.skill||(e.cast("avalanche",void 0,"soft"),e.cast("earthquake",void 0,"soft"))})},t.leg_vilehive=function(t){e.addBaseStats({dmgmul:{skills:["locustswarm"],percent:t}})},t.leg_thingofthedeep=function(t){e.addBaseStats({pickup:20})},t.leg_etchedsigil=t.leg_etchedsigil_p6=function(t){var a=[],n=0;for(var r in e.stats.skills)["arcaneorb","waveofforce","energytwister","hydra","meteor","blizzard","explosiveblast","blackhole"].indexOf(r)>=0&&a.push(r);var s={explosiveblast:360,blackhole:720};"a"===e.stats.skills.meteor&&(s.meteor=900),"c"===e.stats.skills.explosiveblast&&(s.explosiveblast=180),"a"===e.stats.skills.waveofforce&&(s.waveofforce=300);var i={};if(a.length){var o=e.stats.leg_serpentssparker?2:1,f=0;e.register("oncast",function(t){function r(){e.cast("explosiveblast")}if("rayoffrost"===t.skill||"arcanetorrent"===t.skill||"disintegrate"===t.skill){if(e.time<f)return;f=e.time+60;for(var l=0;l<a.length;++l){n=(n+1)%a.length;var c=a[n];if(!("hydra"===c&&e.getBuff("hydra")>=o)&&e.time>=(i[c]||0)){e.cast(c),"explosiveblast"===c&&(e.stats.leg_wandofwoh||e.stats.leg_wandofwoh_p6)&&(e.after(30,r),e.after(60,r),e.after(90,r)),s[c]&&(i[c]=e.time+(s[c]-60*(e.stats.cdrint||0))*(1-.01*(e.stats.cdr||0)));break}}}}),e.stats.leg_etchedsigil_p6&&e.register("updatestats",function(e){e.stats.channeling&&e.stats.add("dmgmul",{skills:a,percent:t})})}},t.leg_hammerjammers=function(t){function a(a,n){e.addBuff("hammerjammers",{dmgmul:{skills:["blessedhammer"],percent:t}},{duration:600,targets:n})}e.watchStatus("blinded",a),e.watchStatus("rooted",a),e.watchStatus("frozen",a),e.watchStatus("stunned",a)},t.leg_standoff=t.leg_standoff_p6=function(t){e.register("oncast",function(a){if("furiouscharge"===a.skill)return{percent:e.stats.ms*t*.01}})},t.leg_ringofemptiness=t.leg_ringofemptiness_p2=function(t){function a(){e.getBuff("haunt")&&e.getBuff("locustswarm")?n=e.addBuff(n,{dmgmul:{percent:t,pet:!1}}):n&&e.removeBuff(n)}var n;e.watchBuff("haunt",a),e.watchBuff("locustswarm",a)},t.leg_elusivering=function(t){e.register("oncast",function(a){"shadowpower"!==a.skill&&"smokescreen"!==a.skill&&"vault"!==a.skill||e.addBuff("elusivering",{dmgred:t},{duration:480})})},t.leg_justicelantern=function(t){var a;e.after(15,function n(){a&&e.removeBuff(a),a=e.addBuff(a,{dmgred:t*e.stats.block*.01}),e.after(15,n)})},t.leg_bandofmight=t.leg_bandofmight_p6=function(t){e.register("oncast",function(a){"furiouscharge"!==a.skill&&"groundstomp"!==a.skill&&"leap"!==a.skill||e.addBuff("bandofmight",{dmgred:t},{duration:480})})},t.leg_lefebvressoliloquy=function(t){e.register("oncast",function(a){"cyclonestrike"===a.skill&&e.addBuff("lefebvressoliloquy",{dmgred:t},{duration:300})})},t.leg_mantleofchanneling=function(t){e.register("updatestats",function(e){e.stats.channeling&&(e.stats.add("dmgmul",t),e.stats.add("dmgred",25))})},t.leg_thethreehundredthspear=function(t){e.addBaseStats({dmgmul:{skills:["weaponthrow","ancientspear"],percent:t}})},t.leg_swordofillwill=function(t){e.register("oncast",function(a){if("chakram"===a.skill)return{percent:e.getResource("hatred")*t}})},t.leg_akkhansleniency=function(t){e.register("onhit_proc",function(a){a.castInfo&&"blessedshield"===a.castInfo.skill&&e.addBuff("akkhansleniency",{dmgmul:{skills:["blessedshield"],percent:t}},{maxstacks:99,stacks:e.random("akkhansleniency",1,a.targets*a.count,!0),duration:180,refresh:!1})})},t.leg_karleispoint=function(t){var a;e.register("onhit_proc",function(n){if(n.castInfo&&"impale"===n.castInfo.skill&&n.castInfo.user&&!n.castInfo.user.karleispoint){for(var r=n.count||1;r>0;--r)a&&e.getBuff(a)&&e.addResource(t),a=e.addBuff(a,void 0,{targets:1,firsttarget:n.firsttarget});n.castInfo.user.karleispoint=!0}})},t.leg_karleispoint_p6=function(t){e.addBaseStats({dmgmul:{skills:["impale"],percent:t}});var a;e.register("onhit_proc",function(t){if(t.castInfo&&"impale"===t.castInfo.skill&&t.castInfo.user&&!t.castInfo.user.karleispoint){for(var n=t.count||1;n>0;--n)a&&e.getBuff(a)&&e.addResource(15),a=e.addBuff(a,void 0,{targets:1,firsttarget:t.firsttarget});t.castInfo.user.karleispoint=!0}})},t.leg_lordgreenstonesfan=t.leg_lordgreenstonesfan_p2=t.leg_lordgreenstonesfan_p6=function(t){e.after(60,function t(){e.addBuff("lordgreenstonesfan",void 0,{maxstacks:30}),e.after(60,t)}),e.register("oncast",function(a){if("fanofknives"===a.skill){var n=e.getBuff("lordgreenstonesfan");if(n)return e.removeBuff("lordgreenstonesfan"),{percent:t*n}}})},t.leg_shieldoffury=t.leg_shieldoffury_p6=function(t){var a;e.register("onhit_proc",function(n){n.castInfo&&"heavensfury"===n.castInfo.skill&&!n.castInfo.triggered&&(a=e.addBuff(a,{dmgmul:{skills:["heavensfury"],percent:t}},{maxstacks:999,stacks:n.count,targets:n.targets,firsttarget:n.firsttarget}))})},t.leg_thetwistedsword=function(t){function a(){var a=Math.min(5,e.getBuff("energytwister")+2*e.getBuff("ragingstorm"));n=e.setBuffStacks(n,{dmgmul:{skills:["energytwister"],percent:t}},a)}var n;e.watchBuff("energytwister",a),e.watchBuff("ragingstorm",a)},t.leg_deathwish=t.leg_deathwish_p6=function(t){e.register("updatestats",function(e){e.stats.channeling&&e.stats.add("dmgmul",t)})},t.leg_orbofinfinitedepth=function(t){e.register("onhit",function(a){a.castInfo&&"explosiveblast"===a.castInfo.skill&&e.addBuff("orbofinfinitedepth",{dmgmul:t,dmgred:15},{maxstacks:4,duration:360})})},t.leg_orbofinfinitedepth_p6=function(t){e.register("onhit",function(a){a.castInfo&&"explosiveblast"===a.castInfo.skill&&e.addBuff("orbofinfinitedepth",{dmgmul:t,dmgred:20},{maxstacks:4,duration:360})})},t.leg_fragmentofdestiny=function(t){e.addBaseStats({dmgmul:{skills:["spectralblade"],percent:t}})},t.leg_remorseless=function(t){function a(t){t.user&&(!t.user.ability||t.user.ability<=e.time)?(e.damage({type:"area",range:8,coeff:2.7,pet:!0,elem:"phy"}),t.user.ability=e.time+240):e.damage({coeff:2.7,pet:!0,elem:"phy"})}e.register("oncast",function(n){"hammeroftheancients"===n.skill&&e.random("remorseless",.01*t)&&e.petattack("remorseless",void 0,{maxstacks:3,stacks:1,duration:1200,refresh:!1,tickrate:57.142834,speed:!0,ontick:a})})},t.leg_haloofarlyse=function(t){e.register("ongethit",function(){e.cast("frostnova")})},t.leg_deathseerscowl=function(t){"undead"===e.target.type&&e.register("ongethit",function(){e.random("deathseerscowl",.01*t/e.target.count)&&e.addBuff("charmed",void 0,{duration:120})})},t.leg_defenderofwestmarch=function(t){e.register("onblock",function(){e.damage({type:"line",pierce:!0,radius:5,speed:.5,range:40,coeff:t,elem:e.stats.info.mhelement||"phy"})})},t.leg_defenderofwestmarch_p2=function(t){e.register("onblock",function(){e.damage({type:"line",pierce:!0,radius:5,speed:.5,range:50,coeff:t,elem:e.stats.info.mhelement||"phy"})})},t.leg_sanguinaryvambraces=function(t){e.register("ongethit",function(){e.random("sanguinaryvambraces",.1)&&e.damage({type:"area",range:15,self:!0,coeff:10,thorns:"bad"})})},t.leg_freezeofdeflection=function(t){e.register("onblock",function(){e.random("freezeofdeflection",1/e.target.count)&&e.addBuff("frozen",void 0,{duration:Math.round(60*t)})})},t.leg_ivorytower=function(t){"crusader"===e.stats.charClass&&e.register("onblock",function(){e.cast("heavensfury","e")})},t.leg_wallofman=function(t){var a=0;e.register("ongethit",function(){e.time>=a&&e.random("wallofman",.01*t)&&(e.addBuff("wallofman",{dmgred:25},{duration:480}),a=e.time+1200)})},t.leg_akaratsawakening=function(t){e.register("onblock",function(){if(e.random("akaratsawakening",.01*t))for(var a in e.stats.skills)e.reduceCooldown(a,60)})},t.leg_sublimeconviction=function(t){e.register("onblock",function(){e.random("sublimeconviction",.01*t*e.getResource("wrath")/(e.stats.maxwrath||1)/e.target.count)&&e.addBuff("stunned",void 0,{duration:90})})},t.leg_theoculus=function(t){e.register("ongethit",function(){e.random("theoculus",.01*t)&&e.reduceCooldown("teleport")})},t.leg_theburningaxeofsankis=function(t){var a=0;e.register("ongethit",function(){e.time>=a&&e.random("theburningaxeofsankis",.15)&&(e.addBuff("theburningaxeofsankis",{dmgred:35},{duration:240}),a=e.time+240)})},t.leg_deathwatchmantle=function(t){var a=0;e.register("ongethit",function(){e.time>=a&&e.random("deathwatchmantle",.01*t)&&(e.damage({type:"area",range:10,self:!0,coeff:2,elem:"phy"}),a=e.time+120)})},t.leg_deathwatchmantle_p2=function(t){var a=0;e.register("ongethit",function(){e.time>=a&&e.random("deathwatchmantle",.01*t)&&(e.damage({type:"area",range:10,self:!0,coeff:8.5,elem:"phy"}),a=e.time+120)})},t.leg_thecapeofthedarknight=function(t){var a=0;"demonhunter"===e.stats.charClass&&e.register("ongethit",function(){e.time>=a&&(e.cast("caltrops"),a=e.time+360)})},t.leg_vigilance=function(t){var a=0;e.register("ongethit",function(){e.time>=a&&("monk"===e.stats.charClass?e.cast("innersanctuary"):e.addBuff(void 0,{dmgred:55},{duration:360}),a=e.time+600)})},t.leg_thundergodsvigor=function(t){var a=0;e.register("ongethit",function(){e.time>=a&&(e.damage({coeff:.01*t}),a=e.time+30)})},t.leg_skullgrasp_p2=t.leg_skullgrasp_p6=function(t){e.addBaseStats({dmgmul:{skills:["whirlwind"],percent:t}})},t.leg_bakulijunglewraps=t.leg_bakulijunglewraps_p6=function(t){function a(){var a=e.listUnion(e.getBuffTargetList("locustswarm"),e.getBuffTargetList("piranhas"));n=e.setBuffStacks(n,{dmgmul:{skills:["firebats"],percent:t/e.target.count}},a.length)}var n;e.watchBuff("locustswarm",a),e.watchBuff("piranhas",a)},t.leg_swamplandwaders=function(t){function a(){var a=e.listUnion(e.getBuffTargetList("locustswarm"),e.getBuffTargetList("graspofthedead"));n=e.setBuffStacks(n,{dmgmul:{skills:["sacrifice"],percent:t/e.target.count}},a.length)}var n;e.watchBuff("locustswarm",a),e.watchBuff("graspofthedead",a)},t.leg_johannasargument=function(t){e.addBaseStats({dmgmul:{skills:["blessedhammer"],percent:100}})},t.leg_theflowofeternity_p2=function(t){e.addBaseStats({dmgmul:{skills:["sevensidedstrike"],percent:100}})},t.leg_fleshrake=function(t){e.register("oncast",function(a){if("dashingstrike"===a.skill)return e.addBuff("fleshrake",void 0,{maxstacks:5,duration:60}),{percent:e.getBuff("fleshrake")*t}})},t.leg_crystalfist=function(t){e.register("oncast",function(a){"dashingstrike"===a.skill&&e.addBuff("crystalfist",{dmgred:t},{duration:360})})},t.leg_haloofkarini=function(t){e.register("onhit",function(a){a.castInfo&&"stormarmor"===a.castInfo.skill&&a.distance>30&&e.addBuff("haloofkarini",{dmgred:t},{duration:180})})},t.leg_haloofkarini_p6=function(t){e.register("onhit",function(a){a.castInfo&&"stormarmor"===a.castInfo.skill&&a.distance>15&&e.addBuff("haloofkarini",{dmgred:t},{duration:300})})},t.leg_flailoftheascended=function(t){e.register("onhit_proc",function(t){t.castInfo&&"shieldbash"===t.castInfo.skill&&t.castInfo.user&&!t.castInfo.user.foa&&t.origdata&&(t.castInfo.user.foa=!0,e.addBuff("flailoftheascended",void 0,{maxstacks:5,refresh:!1,data:{factor:t.origdata.factor||1}}))})},t.leg_bootsofdisregard=function(t){e.after(60,function t(){e.addBuff("bootsofdisregard",{regen:1e4},{maxstacks:4}),e.after(60,t)})},t.leg_denial=t.leg_denial_p6=function(t){e.register("onhit_proc",function(t){t.castInfo&&"sweepattack"===t.castInfo.skill&&t.castInfo.user&&!t.castInfo.user.denial&&(t.castInfo.user.denial=!0,e.setBuffStacks("denial",void 0,Math.min(5,e.random("denial",1,t.targets,!0))))}),e.register("oncast",function(a){if("sweepattack"===a.skill){var n=e.getBuff("denial");if(n)return e.removeBuff("denial"),{percent:t*n}}})},t.leg_goldenflense=t.leg_goldenflense_p2=function(t){e.addBaseStats({dmgmul:{skills:["sweepattack"],percent:200}}),e.register("onhit_proc",function(a){a.castInfo&&"sweepattack"===a.castInfo.skill&&e.addResource(a.targets*a.count*t)})},t.leg_goldenflense_p6=function(t){e.addBaseStats({dmgmul:{skills:["sweepattack"],percent:t}}),e.register("onhit_proc",function(t){t.castInfo&&"sweepattack"===t.castInfo.skill&&e.addResource(t.targets*t.count*6)})},t.leg_madmonarchsscepter=function(t){e.register("onkill",function(a){9===e.getBuff("madmonarchsscepter")?(e.removeBuff("madmonarchsscepter"),e.damage({type:"area",range:30,self:!0,coeff:.01*t,elem:"psn"})):e.addBuff("madmonarchsscepter",void 0,{maxstacks:10})})},t.leg_burstofwrath=function(t){e.register("onkill",function(t){if(e.random("burstofwrath",.1)){var a=e.stats["max"+e.rcTypes[0]];a&&e.addResource(.2*a)}})},t.leg_pandemoniumloop=function(t){var a=0;e.register("onkill",function(t){e.time>=a&&e.stats.status[t.target]&&e.stats.status[t.target].feared&&(e.damage({type:"area",range:15,coeff:2,onhit:e.apply_effect("feared",120)}),a=e.time+30)})},t.leg_soulsmasher=function(t){e.register("onkill",function(e){})},t.leg_oculusring=function(t){var a=0;e.register("onkill",function(n){e.time>=a&&(e.addBuff("oculusring",{damage:t},{duration:420}),a=e.time+420)})},t.leg_oculusring_p2=function(t){var a=0;e.register("onkill",function(n){e.time>=a&&(e.addBuff("oculusring",{dmgmul:t},{duration:420}),a=e.time+420)})},t.leg_winterflurry=function(t){e.register("onkill",function(a){a.hit&&"col"===a.hit.elem&&e.random("winterflurry",.01*t)&&e.damage({type:"area",range:19,coeff:0,elem:"col",onhit:e.apply_effect("frozen",120)})})},t.leg_cordoftherighteous=function(t){e.addBaseStats({dmgmul:{skills:["fistoftheheavens"],percent:t}})},t.leg_girdleofgiants=t.leg_girdleofgiants_p6=function(t){e.register("oncast",function(a){"seismicslam"===a.skill&&e.addBuff("girdleofgiants",{dmgmul:{skills:["earthquake"],percent:t}},{duration:180})})},t.leg_saffronwrap=function(t){e.register("onhit_proc",function(t){t.castInfo&&"overpower"===t.castInfo.skill&&t.castInfo.user&&!t.castInfo.user.saffronwrap&&(t.castInfo.user.saffronwrap=!0,e.setBuffStacks("saffronwrap",void 0,Math.min(20,e.random("saffronwrap",1,t.targets,!0))))}),e.register("oncast",function(a){if("overpower"===a.skill){var n=e.getBuff("saffronwrap");if(n)return e.removeBuff("saffronwrap"),{percent:t*n}}})},t.leg_faithfulmemory=t.leg_faithfulmemory_p6=function(t){e.register("onhit_proc",function(a){a.castInfo&&"fallingsword"===a.castInfo.skill&&a.castInfo.user&&!a.castInfo.user.faithfulmemory&&(a.castInfo.user.faithfulmemory=!0,e.removeBuff("faithfulmemory"),e.addBuff("faithfulmemory",{dmgmul:{skills:["blessedhammer"],percent:t}},{duration:600,stacks:Math.min(10,e.random("faithfulmemory",1,a.targets,!0))}))})},t.leg_hellcatwaistguard=function(t){var a={};e.register("onhit",function(n){if(n.tags&&n.tags.indexOf("grenade")>=0&&n.origdata){var r=0;void 0!==n.origdata.origin?r=n.origdata.origin:"area"===n.origdata.type&&void 0!==n.origdata.radius?r=2/3*(n.origdata.radius-(n.origdata.inner||0)):"line"===n.origdata.type&&void 0!==n.origdata.distance&&(r=Math.min(e.target.radius,Math.abs(e.target.distance-n.origdata.distance)));var s=function(t,n,r){var s={};s.radius=e.target.radius,s.size=e.target.size+t,s.origin=n,s.jumps=r,s.targets=e.target.count;var i=JSON.stringify(s);return i in a||(a[i]=function(t){for(var a=new Math.seedrandom("hellcatwaistguard"),n=Math.PI*t.radius*t.radius,r=[],s=0;s<t.jumps;++s)r.push(0);for(s=0;s<1e3;++s)for(var i=t.origin,o=0;o<t.jumps;++o){var f=e.math.circleIntersection(i,t.size,t.radius);r[o]+=.001*Math.min(f,n)/n*t.targets;var l,c;do{l=10*(2*a()-1),c=10*(2*a()-1)}while(l*l+c*c>100);l+=i,i=Math.sqrt(l*l+c*c)}return r}(s)),a[i]}(n.origdata.area||n.origdata.range||0,r,t);e.pushCastInfo(n.castInfo);for(var i=1;i<=t;++i)e.damage({coeff:n.origdata.coeff*(i==t?8:.5*i),targets:s[i-1],count:.5*n.count,proc:0});e.popCastInfo()}})},t.leg_rabidstrike=function(t){var a=["waveoflight","lashingtailkick","cyclonestrike","explodingpalm","sevensidedstrike"];e.register("oncast",function(t){a.indexOf(t.skill)>=0&&e.after(6,function(){e.cast(t.skill,t.rune,!0,!0)})})},t.leg_omrynschain=function(t){e.register("oncast",function(t){"vault"===t.skill&&e.cast("caltrops")})},t.leg_balance=function(t){e.addBaseStats({dmgmul:{skills:["tempestrush"],percent:200}})},t.leg_balance_p6=function(t){e.addBaseStats({dmgmul:{skills:["tempestrush"],percent:t}})},t.leg_bladeofprophecy=function(t){e.addBaseStats({dmgmul:{skills:["condemn"],percent:100}})},t.leg_bladeofprophecy_p6=function(t){e.addBaseStats({dmgmul:{skills:["condemn"],percent:t}})},t.leg_deadmanslegacy=function(t){e.addBaseStats({dmgmul:{skills:["multishot"],percent:100}})},t.leg_deadmanslegacy_p6=function(t){e.addBaseStats({dmgmul:{skills:["multishot"],percent:t}})},t.leg_fateofthefell_p6=function(t){e.addBaseStats({dmgmul:{skills:["heavensfury"],percent:t}})},t.leg_frydehrswrath=function(t){e.addBaseStats({dmgmul:{skills:["condemn"],percent:200}})},t.leg_frydehrswrath_p6=function(t){e.addBaseStats({dmgmul:{skills:["condemn"],percent:t}})},t.leg_furyofthevanishedpeak=t.leg_furyofthevanishedpeak_p2=function(t){e.addBaseStats({dmgmul:{skills:["seismicslam"],percent:125}})},t.leg_furyofthevanishedpeak_p6=function(t){e.addBaseStats({dmgmul:{skills:["seismicslam"],percent:t}})},t.leg_gavelofjudgment=function(t){e.addBaseStats({dmgmul:{skills:["hammeroftheancients"],percent:100}})},t.leg_gavelofjudgment_p6=function(t){e.addBaseStats({dmgmul:{skills:["hammeroftheancients"],percent:t}})},t.leg_gyrfalconsfoote_p6=function(t){e.addBaseStats({dmgmul:{skills:["blessedshield"],percent:t}})},t.leg_incensetorchofthegrandtemple=function(t){e.addBaseStats({dmgmul:{skills:["waveoflight"],percent:30}})},t.leg_incensetorchofthegrandtemple_p6=function(t){e.addBaseStats({dmgmul:{skills:["waveoflight"],percent:t}})},t.leg_jekangbord=function(t){e.addBaseStats({dmgmul:{skills:["blessedshield"],percent:200}})},t.leg_jekangbord_p6=function(t){e.addBaseStats({dmgmul:{skills:["blessedshield"],percent:t}})},t.leg_manticore=function(t){e.addBaseStats({dmgmul:{skills:["clusterarrow"],percent:80}})},t.leg_manticore_p6=function(t){e.addBaseStats({dmgmul:{skills:["clusterarrow"],percent:t}})},t.leg_ranslorsfolly_p6=function(t){e.addBaseStats({dmgmul:{skills:["energytwister"],percent:t}})},t.leg_staffofchiroptera=function(t){e.addBaseStats({dmgmul:{skills:["firebats"],percent:60}})},t.leg_staffofchiroptera_p6=function(t){e.addBaseStats({dmgmul:{skills:["firebats"],percent:t}})},t.leg_unstablescepter=function(t){e.addBaseStats({dmgmul:{skills:["arcaneorb"],percent:65}})},t.leg_unstablescepter_p6=function(t){e.addBaseStats({dmgmul:{skills:["arcaneorb"],percent:t}})},t.leg_yangsrecurve_p6=function(t){e.addBaseStats({dmgmul:{skills:["multishot"],percent:t}})},t.leg_thegrandvizier=function(t){e.addBaseStats({dmgmul:{skills:["meteor"],percent:30}})},t.leg_thegrandvizier_p6=function(t){e.addBaseStats({dmgmul:{skills:["meteor"],percent:t}})}}();!function(){function n(n,e){return function(t){var i=n.call(f,t.lhs);return s[t.op](i,t.rhs*(e||1))}}function e(n){return f.resources[n]}function t(n){return 100*f.resources[n]/f.stats["max"+n]}function i(n){return 100*f.getTargetHealth(0)}function r(n){return void 0===g[n]?1e10:f.time-g[n]}function a(n){return h[n.type]?h[n.type](n):!1}function c(n){for(var e=0,t=0;t<n.length;++t)a(n[t])&&++e;return e}function u(n){for(var e=[],t=[e],i=0;i<n.length;++i){var r=n[i].skill;r&&f.skills[r]&&(f.getProp(f.skills[r],"secondary",f.stats.skills[r]||"x")?t.push([n[i]]):e.push(n[i]))}return t}function l(n,e){for(var t=0;t<n.priority.length;++t){var i=n.priority[t];if((!e||i.skill===e)&&f.canCast(i.skill)&&(!i.conditions||c(i.conditions)>=i.conditions.length))return i.skill}}function o(n){if(n.channelingLock&&f.time<n.channelingLock){var e=l(n,n.channelingId);if(e===n.channelingId){var t=f.cast(n.channelingId);g[e]=f.time;var i=f.channelDelay(t);n.channelingNextTick=f.time+i;var r=Math.min(n.channelingLock,n.channelingNextTick);f.after(r-f.time,o,n)}else delete n.channelingId,f.after(n.channelingLock-f.time,o,n)}else{var e=l(n);if(!e)return void f.after(5,o,n);if(e===n.channelingId){if(f.time>=n.channelingNextTick){var t=f.cast(e);g[e]=f.time;var i=f.channelDelay(t);n.channelingNextTick=f.time+i}f.after(Math.min(5,n.channelingNextTick-f.time),o,n)}else{var t=f.cast(e);g[e]=f.time;var i=f.castDelay(t),a=f.channelDelay(t);a?(n.channelingLock=f.time+i,n.channelingId=e,n.channelingNextTick=f.time+a,f.after(Math.min(i,a),o,n)):(delete n.channelingId,f.after(i,o,n))}}}var f=Simulator,s={eq:function(n,e){return n==e},ne:function(n,e){return n!=e},lt:function(n,e){return e>n},le:function(n,e){return e>=n},gt:function(n,e){return n>e},ge:function(n,e){return n>=e}},g={},h={buff:n(f.getBuff),buffmin:n(f.getBuffDurationLast,60),buffmax:n(f.getBuffDuration,60),bufftgt:n(f.getBuffTargets),resource:n(e),resourcepct:n(t),cooldown:n(f.getCooldown),health:n(i),charges:n(f.getCharges),ticks:n(f.getBuffTicks),channeled:n(f.getBuffElapsed,60),interval:n(r,60),any:function(n){return c(n.sub)>=1},all:function(n){return c(n.sub)>=n.sub.length},count:function(n){return s[n.op](c(n.sub),n.rhs)}};f.register("init",function(){for(var n=u(f.priority),e=0;e<n.length;++e)this.after(0,o,{priority:n[e]})})}();!function(){function t(t){return t=Math.abs(t),.5>t?.75-t*t:1.5>t?.5*(1.5-t)*(1.5-t):0}function e(t){if(!I[i.target.index]){I[i.target.index]=!0,i.trigger("onkill",{target:i.target.index,hit:t.hit}),i.random("healthglobe",.15+.01*(i.stats.leg_rakoffsglassoflife||0))&&i.trigger("onglobe"),i.rotateBuffs();var a=i.target.index+i.target.count-i.target.eliteCount;if(i.target.index in i.targetDeath?delete i.targetDeath[i.target.index]:delete i.targetHealth[i.target.index],++i.target.index,i.params.deathRate>0){var r=Math.ceil(3600/i.params.deathRate);i.targetDeath[a]=i.after((i.target.count-i.target.eliteCount)*r,e,{index:a})}else i.params.deathRate<0&&(i.targetHealth[a]=v*p)}}function a(){i.postMessage({type:"chart",time:g,damage:h.shift(),healing:l.shift(),health:Math.max(0,i.targetHealth)}),h.push(0),l.push(0),g+=n}function r(t){return d[t]||(d[t]={}),d[t]}for(var i=Simulator,n=180,g=n/2,s=1.5,o=240,h=[],l=[];h.length<Math.ceil((2*o*s-1)/n)+1;)h.push(0),l.push(0);var f=0,u=0,c=0,d={},m=[];i._sample=m,i.targetHealth={},i.targetDeath={};var v=void 0,p=.2,I={};i.register("init",function(){this.after(g+o*s,function c(){a(),i.after(n,c)});var t=this.target.count-this.target.eliteCount;if(this.params.deathRate>0)for(var r=Math.ceil(3600/this.params.deathRate),h=0;t>h;++h)this.targetDeath[this.target.index+h]=this.after((h+1)*r,e,{index:this.target.index+h});if(this.target.health>0){v=this.target.health;for(var h=0;h<this.target.eliteCount;++h)this.targetHealth[h]=v;if(this.params.deathRate<0)for(var h=0;t>h;++h)this.targetHealth[this.target.index+h]=(h+1)/t*v*p}else this.after(3600,function(){v=10*u;for(var e=0;e<i.target.eliteCount;++e)i.targetHealth[e]=v;if(i.params.deathRate<0)for(var e=0;t>e;++e)i.targetHealth[i.target.index+e]=e/t*v*p});if(this.params.globeRate){var l=3600/i.params.globeRate;this.after(i.random("globedelay",l),function d(){i.trigger("onglobe"),i.after(i.random("globedelay",l),d)})}if(this.params.hitRate){var f=3600/i.params.hitRate;this.after(i.random("gethitdelay",f),function m(){i.trigger("ongethit"),i.random("block",.01*i.stats.block)&&i.trigger("onblock"),i.after(i.random("gethitdelay",f),m)})}});var H={};i.register("onhit",function(a){var s=a.skill||a.triggered||"unknown";(a.pet||a.castInfo&&(a.castInfo.pet||a.castInfo.trigExplicit))&&(s=a.triggered||a.skill||"unknown");var l=a.damage*a.targets*a.count,c=r(s);c.damage=(c.damage||0)+l;for(var d=0,m=0;m<h.length;++m)d+=t((g+n*m-i.time)/o);if(d)for(var m=0;m<h.length;++m)h[m]+=l*t((g+n*m-i.time)/o)/d;f+=l;var v=i.target.list(a),p=a.damage*a.count;0===v[0]&&(u+=p);for(var m=0;m<v.length;++m)v[m]in i.targetHealth&&(i.targetHealth[v[m]]-=p,v[m]===i.target.index&&i.targetHealth[v[m]]<=0&&e({index:v[m],hit:a}));var I=a.castId||a.castInfo&&a.castInfo.castId;if(I&&H[I]){var x=H[I];a.triggered&&a.triggered!==x[1]||!a.castInfo||a.castInfo.castId!==I?x[4][s]=(x[4][s]||0)+l:x[3]+=l}}),i.register("healing",function(e){var a=e.castInfo&&(e.castInfo.skill||e.castInfo.triggered)||"unknown";e.castInfo&&(e.castInfo.pet||e.castInfo.trigExplicit)&&(a=e.castInfo.triggered||e.castInfo.skill||"unknown");var s=r(a);s.healing=(s.healing||0)+e.amount;for(var h=0,f=0;f<l.length;++f)h+=t((g+n*f-i.time)/o);if(h)for(var f=0;f<l.length;++f)l[f]+=e.amount*t((g+n*f-i.time)/o)/h;c+=e.amount;var u=e.castId||e.castInfo&&e.castInfo.castId;if(u&&H[u]){var d=H[u];d[6]=(d[6]||0)+e.amount}}),i.register("oncast",function(t){if(!t.triggered){var e=r(t.skill);if(e.count=(e.count||0)+1,m){var a={};for(var n in this.buffs)if(0!==n.indexOf("uniq_")){var g=Math.max(i.getBuff(n),i.getBuffTargets(n));g&&(a[n]=g)}var s=[t.time,t.skill,i.resources[i.rcTypes[0]],0,{},a];t.castId&&(H[t.castId]=s),m.push(s)}}}),i.register("resourcegain",function(t){if(t.castInfo){var e=t.castInfo.triggered||t.castInfo.skill||"unknown",a=r(e);a.rc||(a.rc={}),a.rc[t.type]=(a.rc[t.type]||0)+t.amount}}),i.postResults=function(){i.postMessage({type:"report",time:i.time,counters:d,damage:f,healing:c,uptimes:i.uptimes,sample:m})},i.targetDead=function(){return i.target.eliteCount?0 in i.targetHealth&&i.targetHealth[0]<=0:i.time>=36e3},i.getTargetHealth=function(t){if(t<i.target.eliteCount)return t in i.targetHealth?i.targetHealth[t]/v:1;if(t in i.targetHealth)return i.targetHealth[t]/(v*p);if(t in i.targetDeath&&this.params.deathRate>0){var e=Math.ceil(3600/this.params.deathRate),a=(i.targetDeath[t].time-i.time)/(e*(i.target.count-i.target.eliteCount));return Math.min(a,1)}return 1},i.countTargetsAbove=function(t,e){for(var a=i.target.list(e),r=0,n=0;n<a.length;++n)i.getTargetHealth(a[n])>t&&++r;return r},i.countTargetsBelow=function(t,e){for(var a=i.target.list(e),r=0,n=0;n<a.length;++n)i.getTargetHealth(a[n])<t&&++r;return r},i.listTargetsAbove=function(t,e){for(var a=i.target.list(e),r=[],n=0;n<a.length;++n)i.getTargetHealth(a[n])>t&&r.push(a[n]);return r},i.listTargetsBelow=function(t,e){for(var a=i.target.list(e),r=[],n=0;n<a.length;++n)i.getTargetHealth(a[n])<t&&r.push(a[n]);return r}}();