!function(){var t=DiabloCalc;t.popupMenu=function(t,s,e){if(!$.isEmptyObject(s)){var i=$('<ul class="popup-menu"></ul>').css("position","absolute");i.css("left",t.pageX+15),i.css("top",t.pageY-20),i.attr("tabIndex",-1),$("body").append(i);for(var a in s){var n=$("<li>"+a+"</li>");n.click(function(t){return function(s){i.remove(),t(s)}}(s[a])),i.append(n)}i.menu(),i.focus(),i.focusout(function(){e&&e(),i.remove()})}},t.addTip=function(s,e){var i=s;return"SELECT"!==s[0].tagName||s.is(":visible")||(s=s.next()),s.hover(function(){var s=e;if("function"==typeof e&&(s=e.call(i)),s){var a='<div xmlns="http://www.w3.org/1999/xhtml" class="profile-tooltip"><p><span class="d3-color-gold">'+s+"</span></p></div>";t.tooltip&&t.tooltip.showHtml(this,a)}},function(){t.tooltip&&t.tooltip.hide()}),s},t.chosenTips=function(s,e){var i=s.data("chosen");i&&i.search_results.on("mouseover","li",s.data("chosen"),function(s){var i=s.data,a=this.getAttribute("data-option-array-index");a&&i&&i.results_data&&i.results_data[a]&&t.tooltip&&e.call(this,i.results_data[a].value,this)}).on("mouseleave","li",function(s){t.tooltip&&t.tooltip.hide()})},$.widget("ui.custommouse",$.ui.mouse,{options:{},widgetEventPrefix:"custommouse",_init:function(){return this._mouseInit()},_create:function(){return this.element.addClass("ui-custommouse")},_destroy:function(){return this._mouseDestroy(),this.element.removeClass("ui-custommouse")},_mouseStart:function(){return!1}}),t.enableTouch=function(t){var s=void 0;t.draggable("instance")||t.custommouse(),t.on("touchstart",function(t){s=t.originalEvent.touches[0],setTimeout(function(){s=void 0},750)}),t.on("touchcancel",function(t){s=void 0,t.preventDefault()}),t.on("touchend",function(e){s&&((e=$.extend({},e)).type="click",s&&(e.pageX=s.pageX,e.pageY=s.pageY),s=void 0,setTimeout(function(){t.triggerHandler(e)},0)),e.preventDefault()})},t.simpleDialog=function(t){var s=$("<div><p>"+t.text+"</p></div>"),e=[];(t.buttons||[_L("Ok")]).forEach(function(s,i){e.push({text:s,click:function(){t.callback&&!1===t.callback(i)||$(this).dialog("close")}})}),s.dialog({resizable:!1,title:t.title,height:"auto",width:400,modal:!0,buttons:e,close:function(){s.remove()}})};var s,e;t.showPopup=function(t,i){s&&s!==t&&s.hide(),s=t,e=i},t.hidePopup=function(t){s===t&&(s=void 0)},t.shiftKey=!1,$(document).mouseup(function(t){s&&t.target&&$.contains(document.documentElement,t.target)&&!s.contains(t.target)&&!$(t.target).closest(".popup-menu").length&&s.hide()}).keydown(function(i){s&&e&&27===i.which&&s.hide(),16===i.which&&(t.shiftKey=!0)}).keyup(function(s){16===s.which&&(t.shiftKey=!1)}),t.formatNumber=function(t,s,e){if(void 0===e)return t.toFixed(s||0);var i=t.toFixed(s||0).split(".");return parseFloat(t)>=e&&(i[0]=i[0].replace(/\B(?=(\d{3})+(?!\d))/g,",")),i.join(".")},t.formatDamage=function(s){return s>1e13?t.formatNumber(s/1e12,3,1e4)+" T":s>1e10?t.formatNumber(s/1e9,3,1e4)+" B":s>1e7?t.formatNumber(s/1e6,3,1e4)+" M":t.formatNumber(s,0,1e4)},t.validateNumber=function(){var t=parseFloat($(this).val());isNaN(t)&&(t=0);var s=parseFloat($(this).attr("step"));$(this).attr("min")&&(t=Math.max(t,$(this).attr("min"))),$(this).attr("max")&&(t=Math.min(t,$(this).attr("max"))),isNaN(s)||(t=Math.round(t/s)*s,t=parseFloat(t.toFixed(2))),$(this).val(t),$(this).trigger("input")},t.SearchResults=function(t,s,e){this.action=t,this.emptytip=e||_L("No results."),this.div=$("<div></div>"),this.message=$("<span></span>").hide(),this.results=$('<ul class="search-results"></ul>').hide(),this.navbar=$('<div class="search-navbar"></div>').hide(),this.navtip=$("<span></span>"),this.navfirst=$('<span class="search-navlink">&lt;&lt;</span>'),this.navprev=$('<span class="search-navlink">&lt;</span>'),this.navnext=$('<span class="search-navlink">&gt;</span>'),this.navlast=$('<span class="search-navlink">&gt;&gt;</span>'),this.navbox=$("<select></select>"),this.navbar.append(this.navtip).append($('<span class="search-navbuttons"></span>').append(this.navfirst).append(this.navprev).append(this.navbox).append(this.navnext).append(this.navlast)),this.div.append(this.message).append(this.results).append(this.navbar),this.makeResults=s;var i=this;this.navfirst.click(function(){i.query&&i.query.start>0&&i.search(i.query.term,0)}),this.navprev.click(function(){i.query&&i.query.start>0&&i.search(i.query.term,Math.max(0,i.query.start-10))}),this.navnext.click(function(){i.query&&i.query.start+10<i.query.count&&i.search(i.query.term,i.query.start+10)}),this.navlast.click(function(){i.query&&i.query.start+10<i.query.count&&i.search(i.query.term,10*Math.floor((i.query.count-1)/10))}),this.navbox.change(function(){i.query&&i.search(i.query.term,i.navbox.val())}),this.setError=function(t){this.query=void 0,this.message.text(t).show(),this.results.hide(),this.navbar.hide()},this.onSuccess=function(t){if(t.errors&&t.errors.length)this.setError(t.errors);else if(t.results&&(t.count||t.results.length)){this.message.hide(),this.results.empty();var s=this;$.each(t.results,function(e,i){var a=s.makeResults(t,i);s.results.append(a)}),this.query.start=t.start||0,this.query.count=t.count||t.results.length,this.navtip.text(_L("Showing {0} to {1} of {2}").format(this.query.start+1,this.query.start+t.results.length,this.query.count)),this.navfirst.toggleClass("disabled",this.query.start<=0),this.navprev.toggleClass("disabled",this.query.start<=0),this.navnext.toggleClass("disabled",this.query.start+t.results.length>=this.query.count),this.navlast.toggleClass("disabled",this.query.start+t.results.length>=this.query.count),this.navbox.prop("disabled",this.query.count<=10),this.navbox.empty();for(var e=0;10*e<this.query.count;++e)this.navbox.append('<option value="'+10*e+'">'+(e+1)+"</option>");this.navbox.val(this.query.start),this.navbar.find(".navbuttons").toggle(this.query.count>10),this.results.show(),this.navbar.show()}else 0===t.count?this.setError(this.emptytip):this.setError(_L("Query failed."))},this.onError=function(t){this.setError(_L("Query failed."))},this.search=function(t,s){this.query={term:t};var e=this;$.ajax({url:this.action,data:$.extend({start:s},t),type:"GET",dataType:"json",success:function(t){e.onSuccess(t)},error:function(t){e.onError(t)}})}}}();