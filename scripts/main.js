String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(e,t){return void 0!==a[t]?a[t]:e})},Object.defineProperty(String.prototype,"format",{enumerable:!1})),DiabloCalc={relPath:"/",options:{},optionPerProfile:{},addOption:function(a,e,t,o){Object.defineProperty(this.options,a,{get:e,set:t,enumerable:!0}),o&&(this.optionPerProfile[a]=!0)},localeTable:{},locale:function(){for(var a=[],e=0;e<arguments.length;++e){var t=DiabloCalc.localeTable[arguments[e]];t&&a.push(t)}a.push(DiabloCalc.localeTable);var o=function(e){for(var t=0;t<a.length;++t)if(a[t][e])return a[t][e];return e};return o.fixkey=_L.fixkey,o.fixval=_L.fixval,o},patch:{},session:{uid:MD5(""+Date.now()+Math.random()),start:Math.floor(Date.now()/1e3),activity:{}},activity:function(a){this.session.activity[a]=(this.session.activity[a]||0)+1},report:function(){this.session.duration=Math.floor(Date.now()/1e3)-this.session.start,$.ajax({url:"activity",type:"POST",data:JSON.stringify(this.session),global:!1,processData:!1,contentType:"application/json",dataType:"json"})}},function(){var a=location.pathname.match(/^(\/.*\/)[^/]*$/);a&&(DiabloCalc.relPath=a[1])}(),_L=function(a){return DiabloCalc.localeTable[a]?DiabloCalc.localeTable[a]:a},_L.fixkey=function(a){for(var e=Object.keys(a),t=0;t<e.length;++t){var o=this(e[t]);o!==e[t]&&(a[o]=a[e[t]],delete a[e[t]])}return a},_L.fixval=function(a){for(var e=Object.keys(a),t=0;t<e.length;++t)a[e[t]]=this(a[e[t]]);return a},_L.add=function(a){$.extend(!0,DiabloCalc.localeTable,a)},_L.patch=DiabloCalc.patch,_L.patch.add=function(a){$.extend(!0,_L.patch,a)},_L.patch.apply=function(a){function e(a,t){for(var o in t)"object"==typeof t[o]&&"object"==typeof a[o]?e(a[o],t[o]):a[o]=t[o]}e(a,this)},Object.defineProperty(_L,"fixkey",{enumerable:!1}),Object.defineProperty(_L,"fixval",{enumerable:!1}),Object.defineProperty(_L,"add",{enumerable:!1}),Object.defineProperty(_L,"patch",{enumerable:!1}),Object.defineProperty(_L.patch,"add",{enumerable:!1}),Object.defineProperty(_L.patch,"apply",{enumerable:!1}),DiabloCalc.translateMainPage=function(){var a=DiabloCalc.locale("title");document.title=a("Diablo III Character Planner");var e=$("#char-info label"),t=e.find("input").detach();if(e.text(a("Level")+" ").append(t),document.styleSheets){var o=document.styleSheets[0],i=$('<div style="position: absolute; visibility: hidden; white-space: nowrap"></div>');i.text(a("Equipment")+a("Paragon")+a("Skills/Effects")+a("Import/Save")+a("Simulate")),$("body").append(i);var l=16;do{--l,i.css("font-size",l+"px")}while(l>12&&i.width()>420);l="font-size: "+l+"px !important",o.addRule?o.addRule(".main-tab",l,0):o.insertRule(".main-tab {"+l+";}",0),i.remove()}$('a[href="#tab-equipment"]').text(a("Equipment")),$('a[href="#tab-paragon"]').text(a("Paragon")),$('a[href="#tab-skills"]').text(a("Skills/Effects")),$('a[href="#tab-import"]').text(a("Import/Save")),$('a[href="#tab-simulator"]').text(a("Simulate")),$('.theme-select option[value="light"]').text(a("Light Theme")),$('.theme-select option[value="dark"]').text(a("Dark Theme"))},$(function(){$(".editframe").tabs({heightStyle:"fill"}),$(window).resize(function(){$(".editframe").tabs("refresh")}),$.cookie.json=!0;var a=location.hostname.match(/([^.]*\.)?[^.]*$/);a&&($.cookie.defaults.domain=a[0]);var e=new Spinner({lines:13,length:20,width:10,radius:30,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"50%",left:"50%"}),t=0;DiabloCalc.spinStart=function(){t++<=0&&e.spin($(".page")[0])},DiabloCalc.spinStop=function(){--t<=0&&(e.stop(),t=0)},$(document).ajaxStart(function(){DiabloCalc.spinStart()}),$(document).ajaxStop(function(){DiabloCalc.spinStop()});var o,i=$(".theme-select"),l=$.cookie("theme")||"dark";e.opts.color="light"===l?"#000":"#ccc",$("body").removeClass().addClass("theme-"+l),i.val(l).css("margin-left",12),i.change(function(){var a=$(this).val();$("body").removeClass().addClass("theme-"+a),$.cookie("theme",a,{expires:365}),e.opts.color="light"===a?"#000":"#ccc",o&&(o.remove(),o=void 0),DiabloCalc.trigger&&DiabloCalc.trigger("changeTheme")});var c=$(".locale-select"),n=$.cookie("locale")||"enUS";c.val(n).css("margin-left",12),c.change(function(){$.cookie("locale",$(this).val(),{expires:365}),location.reload()}),DiabloCalc.spinStart(),DC_getScript("scripts/data.js",function(){DiabloCalc.loadData(function(){var a=$("<optgroup></optgroup>").attr("label",_L("Characters")),e=$("<optgroup></optgroup>").attr("label",_L("Followers"));$(".char-class").append(a);for(var t in DiabloCalc.classes){var c=$("<option></option>").val(t).text(DiabloCalc.classes[t].name).addClass("class-"+t).addClass("class-icon");DiabloCalc.classes[t].follower?e.append(c):a.append(c)}var n;DiabloCalc.updateClassIcon=function(){var a=$(".char-class").next().find("span").first();n&&a.removeClass(n),n="class-"+$(".char-class").val()+" "+(DiabloCalc.gender||"female"),a.addClass(n),$("#char-info").removeClass().addClass(DiabloCalc.gender||"female")},$(".char-class").chosen({disable_search:!0,inherit_select_classes:!0}).change(function(){DiabloCalc.updateClassIcon(),DiabloCalc.importStart(),DiabloCalc.triggerNow("changeClass"),DiabloCalc.importEnd("class")}),DiabloCalc.updateClassIcon(),$(".char-class").data("chosen")||(DiabloCalc.noChosen=!0),DiabloCalc.charClass=$(".char-class").val(),$(".char-class").next().find("span").first().addClass("class-icon"),$(".char-level").blur(DiabloCalc.validateNumber);var s=$('<input type="checkbox" checked="checked"></input>').change(function(){DiabloCalc.trigger("updateSkills")}),r=$('<label class="option-box"></label>').append(s).append(_L("Seasonal"));$("#char-info").append($('<div class="seasonal-box"></div>').append(r)),DiabloCalc.addOption("seasonal",function(){return s.prop("checked")},function(a){s.prop("checked",a),DiabloCalc.trigger("updateSkills")}),DiabloCalc.onLoaded=function(){DiabloCalc.addTip(s,_L("Seasonal characters always have Legacy of Nightmares set bonus.")),DiabloCalc.spinStop(),DiabloCalc.importEnd("init");var a=location.pathname.match(/\/e?([0-9]+)$/);if(a)DiabloCalc.loadProfile(void 0,a[1],"e"===location.pathname[1]);else if(window.localStorage){var e;try{e=localStorage.getItem("profile"),e=JSON.parse(e)}catch(a){e=void 0}if(e){var t=$('<div class="restore-profile signin-line">'+_L("Restore last session?")+" </div>");t.append($("<span>"+_L("Yes")+"</span>").click(function(){try{localStorage.removeItem("profile","")}catch(a){}DiabloCalc.setAllProfiles(e,"load"),setTimeout(function(){t.remove()},0)})," / ",$("<span>"+_L("No")+"</span>").click(function(){try{localStorage.removeItem("profile","")}catch(a){}setTimeout(function(){t.remove()},0)})),$(".dollframe").prepend(t)}}if((a=location.pathname.match(/\/reset=([0-9a-f]{32})$/))&&DiabloCalc.account){DiabloCalc.account.reset(a[1]);var c=location.protocol+"//"+location.hostname+DiabloCalc.relPath;window.history&&window.history.replaceState&&window.history.replaceState({},"",c)}if($.cookie("theme"))$.ajax({url:"changes",dataType:"json",success:function(a){if(a instanceof Array&&a.length){for(var e=$('<div class="changelog"><h3>'+_L("What's new?")+'</h3><p class="small"><i>'+_L("Click to dismiss")+"</i></p></div>").css("visibility","hidden"),t=0;t<a.length;++t)e.append("<p><i>"+new Date(1e3*a[t].date).toLocaleString()+"</i>:<br/>"+a[t].text+"</p>");$("body").append(e);var o=$(".page"),i=o.offset().left+o.outerWidth();e.css("max-width",Math.max(250,$(window).width()-i-32)),e.css("left",Math.min(i+24,$(window).width()-e.outerWidth()-8)).css("top",16),e.css("visibility","");var l=a[0].date;e.click(function(){$.cookie.json=!1,$.cookie("lastchange",l+1),$.cookie.json=!0,e.remove()})}}});else{o=$('<div class="themetip"><p>'+_L("Select your theme:")+'</p><p class="small">('+_L("Click to dismiss")+")</p></div>").css("visibility","hidden"),$("body").append(o);var n=i.offset();o.css("left",n.left+i.outerWidth()/2-o.outerWidth()/2).css("top",n.top-o.outerHeight()-20),o.css("visibility",""),o.click(function(){$.cookie("theme",l),o.remove(),o=void 0})}},DC_getScript("core")})})});