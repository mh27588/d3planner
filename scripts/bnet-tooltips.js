!function(){var a=DiabloCalc.locale("bnet-tooltips.js");DiabloCalc.itemPerfection=function(a){var t;if("string"==typeof a)t=a,a=DiabloCalc.getSlot(t);else if(a){var s=[];for(var e in DiabloCalc.itemSlots){if(DiabloCalc.itemSlots[e].item&&DiabloCalc.itemSlots[e].item.id===a.id){s=[e];break}DiabloCalc.isItemAllowed(e,a.id)&&s.push(e)}if(!s.length)return;t=s[0]}if(a){var l=DiabloCalc.getItemAffixesById(a.id,a.ancient,!1),i=DiabloCalc.getItemAffixesById(a.id,a.ancient,"only"),o={stats:{},total:0},n=$.extend(!0,{},a),c=$.extend(!0,{},a),r=0;for(var p in a.stats){var d=i[p];if(d||(d=l[p]),d&&void 0!==d.max&&d.min!==d.max){d.noblock&&l[p]&&a.stats[p][0]>d.max&&(d=$.extend({},d),DiabloCalc.stats[p]&&DiabloCalc.stats[p].dr?(d.min=100-.01*(100-d.min)*(100-l[p].min),d.max=100-.01*(100-d.max)*(100-l[p].max)):(d.min+=l[p].min,d.max+=l[p].max));var m=(a.stats[p][0]-d.min)/(d.max-d.min);"min"===d.best?(m=1-m,n.stats[p][0]=d.max,c.stats[p][0]=d.min):(n.stats[p][0]=d.min,c.stats[p][0]=d.max),void 0!==d.max2&&d.min2!==d.max2&&(m=.5*(m+((a.stats[p][1]||0)-d.min2)/(d.max2-d.min2)),n.stats[p][1]=d.min2,c.stats[p][2]=d.max2),o.stats[p]=m;var f=DiabloCalc.stats[p];f&&(f.base||f.secondary)&&"custom"!==p||(o.total+=m,++r)}}r?o.total/=r:o.total=1;var u=DiabloCalc.computeStats(function(s){return s===t?a:DiabloCalc.getSlot(s)}),b=DiabloCalc.computeStats(function(a){return a===t?n:DiabloCalc.getSlot(a)}),v=DiabloCalc.computeStats(function(a){return a===t?c:DiabloCalc.getSlot(a)});return o.dps=v.info.dps>b.info.dps+1?(u.info.dps-b.info.dps)/(v.info.dps-b.info.dps):1,o.dpsDelta=Math.max(0,v.info.dps-u.info.dps),o.toughness=v.info.toughness>b.info.toughness+1?(u.info.toughness-b.info.toughness)/(v.info.toughness-b.info.toughness):1,o.toughnessDelta=Math.max(0,v.info.toughness-u.info.toughness),o}},DiabloCalc.tooltip=new function(){function t(){m||(m=$('<div class="tooltip-body"></div>'),$("body").append(m)),p=$("<div></div>").addClass("d3-tooltip-wrapper").hide(),d=$("<div></div>"),$(m).append(p.append(d))}function s(){m||(m=$('<div class="tooltip-body"></div>'),$("body").append(m)),f=$("<div></div>").addClass("d3-tooltip-wrapper").hide(),u=$("<div></div>"),$(m).append(f.append(u))}function e(a){function t(a,t,s){return a<t&&(a=t,o=!0),a>s&&(a=s,o=!0),a}if(h&&D){var s=$(window),e={left:5,top:5,right:s.width()-5,bottom:s.height()-5},l=(h.left,h.top,h.right-h.left),i=h.bottom-h.top,o=!1;l>e.right-e.left&&(h.left=t(h.left+a.deltaX*a.deltaFactor,e.right-l,e.left),h.right=h.left+l),i>e.bottom-e.top&&(h.top=t(h.top+a.deltaY*a.deltaFactor,e.bottom-i,e.top),h.bottom=h.top+i),p.css({left:h.left,top:h.top,visibility:"visible"}),o||(a.preventDefault(),a.stopPropagation())}}function l(a,s,l,o){o||i(),b&&$(b).unmousewheel(e),b=a,clearTimeout(C),null==p&&t(),p.css({left:0,top:0,visibility:"hidden"}).show(),a=$(a);var n=$(window),c=a.offset(),r={left:c.left-n.scrollLeft(),top:c.top-n.scrollTop()};r.right=r.left+a.outerWidth(),r.bottom=r.top+a.outerHeight();var d={left:50,top:5,right:n.width()-50,bottom:n.height()-5},m=["right","left","top","bottom"];if("string"==typeof s){var f=m.indexOf(s);f>0&&(m[f]=m[0],m[0]=s),s=void 0}void 0!==s&&(r.left=r.right=r.left+s),void 0!==l&&(r.top=r.bottom=r.top+l),void 0===s&&void 0===l&&window.touchEvent&&window.touchEvent.touches.length&&(r.left=window.touchEvent.touches[0].pageX-n.scrollLeft()-30,r.top=window.touchEvent.touches[0].pageY-n.scrollTop()-20,r.right=r.left+60,r.bottom=r.top+40);var u=Math.max(5,20-(r.right-r.left)),v=p.outerWidth(),y=p.outerHeight();o&&(d.left+=v-40,d.right-=v-40);var w=Math.max(d.top,r.top-y),x=(r.left+r.right-v)/2;x=Math.min(x,d.right-v),x=Math.max(x,d.left);for(var k,S;0<m.length;++m)if("right"===m[0]){if(r.right+u+v<=d.right){k=r.right+u,S=w,g="right";break}}else if("left"===m[0]){if(r.left-u-v>=d.left){k=r.left-u-v,S=w,g="left";break}}else if("top"===m[0]){if(r.top-25-y>=d.top){k=x,S=r.top-25-y,g="top";break}}else if("bottom"===m[0]&&r.bottom+25+y<=d.bottom){k=x,S=r.bottom+25,g="bottom";break}void 0===k&&(d.right-r.right>r.left-d.left?(k=r.right+u,S=w,g="right"):(k=r.left-u-v,S=w,g="left")),h={left:k,top:S,right:k+v,bottom:S+y},function(a,t){if(D){$(window);p.css({left:a,top:t,visibility:"visible"})}}(k,S),y>d.bottom-d.top&&a.mousewheel(e)}function i(){f&&f.hide()}function o(){i(),b&&$(b).unmousewheel(e),b=void 0,v=void 0,h=void 0,clearTimeout(C),p&&p.hide()}function n(t,s,e,l){function i(a,t){if("number"==typeof a)return DiabloCalc.formatNumber(a,t,1e4);if(a&&a.min&&a.max){var s=DiabloCalc.formatNumber(a.min||0,t,1e4)+"&#x2013;"+DiabloCalc.formatNumber(a.max||0,t,1e4);return o&&(s="("+s+")"),s}return"0"}s instanceof Array||(tmp=s,s=[],tmp.min&&tmp.max&&s.push({min:tmp.min,max:tmp.max}),tmp.min2&&tmp.max2&&s.push({min:tmp.min2,max:tmp.max2})),s.length<=1&&(t=t.replace(/%d-%d/g,"%d"));var o=t.indexOf("%d-%d")>=0;e&&(t=(t=(t=(t=t.replace(/%d-%d/g,"%d&#x2013;%d")).replace(/\+?(?:%(?:\{[0-9]+\})?(?:d|\.[0-9]f))(?:%%)?/g,e>1?'<span class="d3-color-blue"><span class="value">$&</span></span>':'<span class="value">$&</span>')).replace(/[0-9]+(?:\.[0-9]+)?(?:-[0-9]+)?%%/g,'<span class="value">$&</span>')).replace(/\n\*|\r\n/g,'<br/><span class="tooltip-icon-bullet"/>'));var n=0;if(t=t.replace(/%(?:\{([0-9]+)\})?(d|p|\.[0-9]f|%)/g,function(a,t,e){if("%"==e)return"%";var l=(t=t?parseInt(t):n++)>=s.length?0:s[t];if("d"===e)return i(l,0);if("p"===e){var o=DiabloCalc.allPassives[l];return o&&o.name||"unknown"}return i(l,e[1])}).replace(/([0-9])-([0-9])/g,"$1&#x2013;$2"),e){var c;l&&DiabloCalc.stats[l]&&DiabloCalc.stats[l].class?c=DiabloCalc.stats[l].class:l&&DiabloCalc.itemPowerClasses[l]&&(c=DiabloCalc.itemPowerClasses[l]),c&&DiabloCalc.charClass!==c?t+=' <span class="d3-color-red">'+a("({0} Only)").format(DiabloCalc.classes[c].name)+"</span>":c&&DiabloCalc.stats[l]&&(t+=" "+a("({0} Only)").format(DiabloCalc.classes[c].name)),l&&DiabloCalc.stats[l]&&DiabloCalc.stats[l].caldesanns&&(t+=' <span class="d3-color-orange">'+a("(Caldesann's Despair Rank {0})").format((s[0]/5).toFixed(0))+"</span>")}return t}function c(a,t){var s=Math.round(255*(a>.5?2-2*a:1)),e=Math.round(255*(a>.5?1:2*a));s=Math.max(0,Math.min(255,s)),e=Math.max(0,Math.min(255,e));var l='<span style="color: '+("#"+("0"+s.toString(16)).slice(-2)+("0"+e.toString(16)).slice(-2)+"00")+'"';return(l+=t?' class="'+t+'"> (':">")+parseFloat((100*a).toFixed(1))+"%"+(t?")":"")+"</span>"}function r(e,i,o){var m,b,C=!1;if("string"==typeof i){if(DiabloCalc.itemSlots[i]){m=DiabloCalc.getSlot(i);N=DiabloCalc.getOffhandTypes&&"offhand"===i?DiabloCalc.getOffhandTypes():DiabloCalc.itemSlots[i].types;for(var k in N)if(!(N[k].classes&&N[k].classes.indexOf(DiabloCalc.charClass)<0)){x.custom=x.customwpn=x[DiabloCalc.itemTypes[k].slot];break}b=DiabloCalc.itemPerfection(i)}else if(DiabloCalc.itemById[i]){if(m={id:i,template:!0},i=void 0,"string"==typeof o){i=o;N=DiabloCalc.getOffhandTypes&&"offhand"===i?DiabloCalc.getOffhandTypes():DiabloCalc.itemSlots[i].types;for(var k in N)if(!(N[k].classes&&N[k].classes.indexOf(DiabloCalc.charClass)<0)){x.custom=x.customwpn=x[DiabloCalc.itemTypes[k].slot];break}}else m.custom=o,x.custom=x.customwpn="square";o=void 0}}else C=!o,m=i,i=void 0,x.custom=x.customwpn="square",b=DiabloCalc.itemPerfection(m);if(m&&DiabloCalc.itemById[m.id]){var S;if(C&&DiabloCalc.tipStatList){v=m;var q=[];for(var I in DiabloCalc.itemSlots){if(DiabloCalc.itemSlots[I].item&&DiabloCalc.itemSlots[I].item.id===m.id){q=[I];break}DiabloCalc.itemSlots[I].item&&DiabloCalc.isItemAllowed(I,m.id)&&q.push(I)}q.length?(S=q[0],q.length>1&&w&&(S=q[1])):C=void 0}else C=void 0;o&&!f&&s(),o||p||t();var A=o?u:d,T=o?f:p;A.empty(),T.css("max-width",""),A.removeClass().addClass("d3-tooltip-wrapper-inner");$(".char-class").val();var F=DiabloCalc.itemById[m.id],M=DiabloCalc.qualities[F.quality].color,O=DiabloCalc.getItemAffixesById(m.id,m.ancient,!0);if(m.template){m.stats={},m.varies=[];var P=DiabloCalc.getItemAffixesById(m.id,m.ancient,"only"),B=DiabloCalc.getStatCount(m.id);B=B[0]+B[1];for(var L in P)m.stats[L]=P[L],DiabloCalc.stats[L].base||--B;for(var E=DiabloCalc.getItemPreset(m.id),G=0;G<E.length;++G){1===(ba=DiabloCalc.smartListStats(E[G],O)).length?(m.stats[ba[0]]=O[ba[0]],--B):ba.length>1&&(m.varies.push(ba),--B)}m.stats.custom&&m.custom&&(m.stats.custom=m.custom),m.random=B}if(("custom"==($a=m.id)||"customwpn"==$a)&&i){var N=DiabloCalc.getOffhandTypes&&"offhand"===i?DiabloCalc.getOffhandTypes():DiabloCalc.itemSlots[i].types;for(var k in N)if(!(N[k].classes&&N[k].classes.indexOf(DiabloCalc.charClass)<0)&&("customwpn"===$a||!DiabloCalc.itemTypes[k].weapon)&&("customwpn"!==$a||DiabloCalc.itemTypes[k].weapon)){$a=DiabloCalc.itemTypes[k].generic;break}}$a=DiabloCalc.getItemIcon($a);var R=DiabloCalc.itemTypes[F.type],j=null;for(var L in m.stats)if(DiabloCalc.stats[L].elemental){j=DiabloCalc.stats[L].elemental;break}var H="";j&&"square"!=x[R.slot]?H=" effect-bg effect-bg-"+j:m.stats.basearmor&&(H=" effect-bg effect-bg-armor","default"!=x[R.slot]&&(H+=" effect-bg-armor-"+x[R.slot]));var U=$('<div class="d3-tooltip d3-tooltip-item"></div>');A.append(U);var W="d3-tooltip-item-wrapper";"primal"===m.ancient?W+=" d3-tooltip-item-wrapper-PrimalAncientLegendary":m.ancient&&(W+=" d3-tooltip-item-wrapper-AncientLegendary");var Y=$('<div class="'+W+'"></div>');U.append(Y),(U=Y).append('<div class="d3-tooltip-item-border d3-tooltip-item-border-left"></div>'),U.append('<div class="d3-tooltip-item-border d3-tooltip-item-border-right"></div>'),U.append('<div class="d3-tooltip-item-border d3-tooltip-item-border-top"></div>'),U.append('<div class="d3-tooltip-item-border d3-tooltip-item-border-bottom"></div>'),U.append('<div class="d3-tooltip-item-border d3-tooltip-item-border-top-left"></div>'),U.append('<div class="d3-tooltip-item-border d3-tooltip-item-border-top-right"></div>'),U.append('<div class="d3-tooltip-item-border d3-tooltip-item-border-bottom-left"></div>'),U.append('<div class="d3-tooltip-item-border d3-tooltip-item-border-bottom-right"></div>'),U.append('<div class="tooltip-head tooltip-head-'+M+'"><h3 class="d3-color-'+M+'">'+F.name+"</h3></div>");var V=$('<div class="tooltip-body'+H+'"></div>');U.append(V),V.append('<span class="d3-icon d3-icon-item d3-icon-item-large d3-icon-item-'+M+'"><span class="icon-item-gradient"><span class="icon-item-inner icon-item-'+x[R.slot]+(m.ancient?" ancient":"")+'" style="background-image: url('+$a+');"></span></span></span>');var X=$('<div class="d3-item-properties"></div>');V.append(X);var _=DiabloCalc.metaSlots[R.slot]||DiabloCalc.itemSlots[R.slot],z="";(F.class||R.class)&&(z='<li class="item-class-specific d3-color-white">'+DiabloCalc.classes[F.class||R.class].name+"</li>"),X.append('<ul class="item-type-right"><li class="item-slot">'+_.name+"</li>"+z+"</ul>");var J=DiabloCalc.qualities[F.quality];if(X.append('<ul class="item-type"><li class="d3-color-'+M+'">'+DiabloCalc.GenderPair("primal"===m.ancient&&J.primal||m.ancient&&J.ancient||J.prefix,R.name)+"</li></ul>"),m.stats.basearmor){var K,Q;m.stats.basearmor instanceof Array?K=m.stats.basearmor[0]:(K=m.stats.basearmor.min||0,Q=m.stats.basearmor.max||0),m.stats.armor&&(m.stats.armor instanceof Array?K+=m.stats.armor[0]:(Q=(Q||K)+(m.stats.armor.max||0),K+=m.stats.armor.min||0)),Q&&(K+="&#x2013;"+Q),X.append('<ul class="item-armor-weapon item-armor-armor"><li class="big"><p><span class="value">'+K+"</span></p></li><li>"+a("Armor")+"</li></ul>")}if(R.weapon){var Z=R.weapon;F.weapon&&(Z=$.extend({},Z,F.weapon));var aa,ta,sa,ea=Z.speed,la=Z.min,ia=Z.max;if(m.gems)for(G=0;G<m.gems.length;++G)"ruby"===m.gems[G][1]&&(la+=DiabloCalc.gemColors.ruby.weapon.amount[m.gems[G][0]],ia+=DiabloCalc.gemColors.ruby.weapon.amount[m.gems[G][0]]);for(var L in m.stats)DiabloCalc.stats[L].damage&&(m.stats[L]instanceof Array?(la+=m.stats[L][0],ia+=m.stats[L][1]):(aa=(aa||la)+(m.stats[L].max||0),la+=m.stats[L].min||0,ta=(ta||ia)+(m.stats[L].max2||0),ia+=m.stats[L].min2||0));m.stats.damage&&(m.stats.damage instanceof Array?(la*=1+.01*m.stats.damage[0],ia*=1+.01*m.stats.damage[0]):(aa=(aa||la)*(1+.01*(m.stats.damage.max||0)),la*=1+.01*(m.stats.damage.min||0),ta=(ta||ia)*(1+.01*(m.stats.damage.max2||0)),ia*=1+.01*(m.stats.damage.min2||0))),m.stats.weaponias&&(m.stats.weaponias instanceof Array?ea*=1+.01*m.stats.weaponias[0]:(sa=(sa||ea)*(1+.01*(m.stats.weaponias.max||0)),ea*=1+.01*(m.stats.weaponias.min||0)));var oa=((la+ia)*ea/2).toFixed(1),na="big";(aa||ta||sa)&&(oa+="&#x2013;"+(((aa||la)+(ta||ia))*(sa||ea)/2).toFixed(1),na="med"),la=Math.round(la),ia=Math.round(ia),ea=ea.toFixed(2),aa&&(la="("+la+"&#x2013;"+Math.round(aa)+")"),ta&&(ia="("+ia+"&#x2013;"+Math.round(ta)+")"),sa&&(ea+="&#x2013;"+sa.toFixed(2)),X.append('<ul class="item-armor-weapon item-weapon-dps"><li class="'+na+'"><span class="value">'+oa+"</span></li><li>"+a("Damage Per Second")+"</li></ul>"),X.append('<ul class="item-armor-weapon item-weapon-damage"><li><p><span class="value">'+la+'</span>&#x2013;<span class="value">'+ia+'</span> <span class="d3-color-FF888888">'+a("Damage")+'</span></p></li><li><p><span class="value">'+ea+'</span> <span class="d3-color-FF888888">'+a("Attacks per Second")+"</span></p></li></ul>")}if(m.stats.baseblock&&m.stats.blockamount){var ca,ra;m.stats.baseblock instanceof Array?ca=m.stats.baseblock[0]:(ca=m.stats.baseblock.min||0,ra=m.stats.baseblock.max||0),m.stats.block&&(m.stats.block instanceof Array?ca+=m.stats.block[0]:(ra=(ra||ca)+(m.stats.block.max||0),ca+=m.stats.block.min||0)),ca=ca.toFixed(1),ra&&(ca+="&#x2013;"+ra.toFixed(1));var pa;m.stats.blockamount instanceof Array?pa=m.stats.blockamount[0].toFixed(0)+'</span>&#x2013;<span class="value">'+m.stats.blockamount[1].toFixed(0):(pa="("+(m.stats.blockamount.min||0).toFixed(0)+"&#x2013;"+(m.stats.blockamount.max||0).toFixed(0)+")",pa+='</span>&#x2013;<span class="value">',pa+="("+(m.stats.blockamount.min2||0).toFixed(0)+"&#x2013;"+(m.stats.blockamount.max2||0).toFixed(0)+")"),X.append('<ul class="item-armor-weapon item-armor-shield"><li><p><span class="value">+'+ca+'%</span> <span class="d3-color-FF888888">'+a("Chance to Block")+'</span></p></li><li><p><span class="value">'+pa+'</span> <span class="d3-color-FF888888">'+a("Block Amount")+"</span></p></li></ul>")}X.append('<div class="item-before-effects"></div>');var da=$('<ul class="item-effects"></ul>');X.append(da);for(var ma=0;ma<2;++ma){var fa=null,ua=Object.keys(m.stats).filter(function(a){return"sockets"!==a&&!DiabloCalc.stats[a].base&&((0!=ma||!DiabloCalc.stats[a].secondary)&&!(1==ma&&!DiabloCalc.stats[a].secondary))});ua.sort(function(a,t){return DiabloCalc.stats[a].prio-DiabloCalc.stats[t].prio}),ua.forEach(function(t){fa||(fa=$('<p class="item-property-category">'+a(0==ma?"Primary":"Secondary")+"</p>"),da.append(fa));var s="default";DiabloCalc.stats[t].utility&&(s="utility"),m.enchant===t&&(s="enchant");var e="custom"==t?"orange":"blue",l=DiabloCalc.stats[t].format;"custom"==t&&F.required&&F.required.custom&&(l=F.required.custom.format);var i="";if(!m.template&&O[t]&&O[t].min&&O[t].max){var o=O[t].min,r=O[t].max;O[t].max2&&DiabloCalc.stats[t].damage&&(r=O[t].max2);for(var p=o,d=r,f=0;f<2&&(Math.floor(p-1e-6)==Math.floor(p+1e-6)||Math.floor(d-1e-6)==Math.floor(d+1e-6));)p*=10,d*=10,f+=1;i='<span class="d3-color-gray d3-tooltip-range"> ['+DiabloCalc.formatNumber(o,f,1e4)+" - "+DiabloCalc.formatNumber(r,f,1e4)+"]"+(l.match(/%(d|\.[0-9]f)%%/g)?"%":"")+"</span>"}!C&&b&&void 0!==b.stats[t]&&(i+=c(b.stats[t],"d3-perfection-value")),l=n(l,m.stats[t],"custom"==t?2:1,"custom"==t?F.required&&F.required.custom&&F.required.custom.id:t),da.append('<li class="d3-color-'+e+" d3-item-property-"+s+'"><p>'+l+i+"</p></li>")})}if(m.varies||m.random){if(da.append("<br/>"),m.varies)for(G=0;G<m.varies.length;++G){var ba=m.varies[G],va=$('<li class="item-effects-choice"></li>');va.append('<span class="d3-color-blue">'+a("One of {0} Magic Properties (varies)").format('<span class="value">'+ba.length+"</span>")+"</span>");for(var ha=$("<ul></ul>"),ga=0;ga<ba.length;++ga){var Ca=n(DiabloCalc.stats[ba[ga]].format,O[ba[ga]],1,ba[ga]);ha.append('<li><span class="d3-color-blue"><p>'+Ca+"</p></span></li>")}va.append(ha),da.append(va)}m.random&&da.append('<li class="d3-color-blue"><span class="value">+'+m.random+"</span> "+a("Random Magic Properties")+"</li>")}if(m.transmog&&DiabloCalc.itemById[m.transmog]&&"rare"!==DiabloCalc.itemById[m.transmog].quality){da.append('<p class="item-property-category d3-color-blue">'+a("Transmogrification")+":</p>");Da=DiabloCalc.itemById[m.transmog];da.append('<li class="value d3-color-'+("set"===Da.quality?"green":"orange")+'">'+Da.name+"</li>")}else if(m.transmog&&DiabloCalc.webglItems[m.transmog]){da.append('<p class="item-property-category d3-color-blue">'+a("Transmogrification")+":</p>");var Da=DiabloCalc.webglItems[m.transmog];da.append('<li class="value d3-color-'+(Da.promo?"orange":"white")+'">'+(Da.name||m.transmog)+"</li>")}if(m.dye&&DiabloCalc.webglDyes&&DiabloCalc.webglDyes[m.dye]&&da.append('<p class="item-property-category">'+DiabloCalc.webglDyes[m.dye].name+"</p>"),m.stats.sockets){var ya=_.socketType;"weapon"!=ya&&"head"!=ya&&(ya="other");for(var wa=m.stats.sockets.max||m.stats.sockets[0],xa=0;xa<wa;++xa)if(m.gems&&xa<m.gems.length){var ka=m.gems[xa];if(DiabloCalc.legendaryGems[ka[0]]&&DiabloCalc.legendaryGems[ka[0]].effects){for(var Sa=DiabloCalc.legendaryGems[ka[0]],$a=DiabloCalc.getItemIcon(ka[0],"small"),qa=Sa.effects[0].value.slice(),G=0;G<qa.length;++G)qa[G]+=ka[1]*Sa.effects[0].delta[G];var Ia=n(Sa.effects[0].format||DiabloCalc.stats[Sa.effects[0].stat].format,qa,2,Sa.effects[0].stat),Aa=n(Sa.effects[1].format||DiabloCalc.stats[Sa.effects[1].stat].format,Sa.effects[1].value||[],ka[1]<25?1:2,Sa.effects[1].stat);ka[1]<25&&(Aa+=' <span class="d3-color-red">'+a("(Requires Rank {0})").format(25)+"</span>");var Ta=$('<li class="full-socket"></li>');Ta.append('<img class="gem" src="'+$a+'" />'),Ta.append('<span class="d3-color-orange">'+Sa.name+"</span>"),ka[1]&&Ta.append(' <span class="item-jewel-rank">&#x2013; '+a("Rank {0}").format(ka[1])+"</span>");(Ma=$("<ul></ul>")).append('<li class="jewel-effect d3-color-orange"><p>'+Ia+"</p></li>"),Ma.append('<li class="jewel-effect d3-color-'+(ka[1]<25?"gray":"orange")+'"><p>'+Aa+"</p></li>"),da.append(Ta.append(Ma))}else if(DiabloCalc.gemColors[ka[1]]){var Sa=DiabloCalc.gemColors[ka[1]],$a=DiabloCalc.getItemIcon(ka,"small"),Fa=n(DiabloCalc.stats[Sa[ya].stat].format,[Sa[ya].amount[ka[0]]],Sa[ya].stat);da.append('<li class="d3-color-white full-socket"><img class="gem" src="'+$a+'" /><span class="socket-effect">'+Fa+"</span></li>")}}else da.append('<li class="empty-socket d3-color-blue">'+a("Empty Socket")+"</li>")}if(F.set){var Ma=$('<ul class="item-itemset"></ul>');X.append(Ma);for(var Oa=DiabloCalc.itemSets[F.set],Pa={},Ba=[],La=0,G=0;G<Oa.items.length;++G)Pa[Oa.items[G].id]=G,Ba.push("gray");for(var Ea in DiabloCalc.itemSlots){var Ga=DiabloCalc.getSlotId(Ea);Ga&&void 0!==Pa[Ga]&&(Ba[Pa[Ga]]="white",La++)}La>1&&!!DiabloCalc.getStats().leg_ringofroyalgrandeur&&La++,Ma.append('<li class="item-itemset-name"><span class="d3-color-green">'+Oa.name+"</span></li>");for(G=0;G<Oa.items.length;++G){var k=DiabloCalc.itemTypes[Oa.items[G].type],i=DiabloCalc.itemSlots[k.slot]||DiabloCalc.metaSlots[k.slot];Ma.append('<li class="item-itemset-piece indent"><span class="d3-color-'+Ba[G]+'">'+Oa.items[G].name+" ("+i.name+")</span></li>")}for(var Na in Oa.bonuses){var Ra=parseInt(Na)<=La?"green":"gray";Ma.append('<li class="d3-color-'+Ra+' item-itemset-bonus-amount">'+a("({0}) Set:").format('<span class="value">'+Na+"</span>")+"</li>");for(G=0;G<Oa.bonuses[Na].length;++G){var ja=Oa.bonuses[Na][G],Fa=n(ja.stat?DiabloCalc.stats[ja.stat].format:ja.format,ja.value||[],1,ja.stat);Ma.append('<li class="d3-color-'+Ra+' item-itemset-bonus-desc indent">'+Fa+"</li>")}}}var Ha='<span class="item-unique-equipped">'+a("Unique Equipped")+"</span>";if(b&&void 0!==b.total&&(Ha='<span class="item-unique-equipped">'+a("Perfection: ")+c(b.total),C||o||(y||(Ha+=' <span class="d3-perfection-tip">'+a("(hold shift for details)")+"</span>"),Ha+='</span><span class="d3-perfection-section item-unique-equipped">',Ha+=a(b.dpsDelta?"Damage: {0} (max {1})":"Damage: {0}").format(c(b.dps),'<span class="d3-color-white">+'+DiabloCalc.formatNumber(b.dpsDelta,0,1e4)+"</span>"),Ha+='</span><span class="d3-perfection-section item-unique-equipped">',Ha+=a(b.toughnessDelta?"Toughness: {0} (max {1})":"Toughness: {0}").format(c(b.toughness),'<span class="d3-color-white">+'+DiabloCalc.formatNumber(b.toughnessDelta,0,1e4)+"</span>"),Ha+="</span>")),X.append('<ul class="item-extras"><li class="item-reqlevel"><span class="d3-color-gold">'+a("Required Level: ")+'</span><span class="value">70</span></li><li>'+a("Account Bound")+"</li></ul>"+Ha+'<span class="clear">\x3c!--   --\x3e</span>'),C&&S){var Ua=DiabloCalc.getStats();y&&DiabloCalc.itemSlots[S].item&&DiabloCalc.itemSlots[S].item.gems&&(Ua=DiabloCalc.computeStats(function(a){if(a===S){var t=$.extend({},DiabloCalc.itemSlots[S].item);return t.gems=[],t}return DiabloCalc.getSlot(a)}));var Wa=DiabloCalc.computeStats(function(a){if(a===S){if(y){var t=$.extend({},m);return t.gems=[],t}return m}return DiabloCalc.getSlot(a)}),Ya=[];for(var Va in DiabloCalc.tipStatList)if(DiabloCalc.tipStatList[Va].stat){var qa=Ua.getValue(DiabloCalc.tipStatList[Va].stat),Xa=Wa.getValue(DiabloCalc.tipStatList[Va].stat),_a=Xa-qa,za=qa<.01?1e5:100*_a/qa;Ya.push([za,'<li><span class="tooltip-icon-bullet"></span> <span class="d3-color-white">'+(DiabloCalc.tipStatList[Va].shortName||DiabloCalc.tipStatList[Va].name)+'</span>: <span class="d3-color-'+(0===_a?"gray":_a>0?"green":"red")+'">'+(qa>.01?DiabloCalc.formatNumber(za,2)+"%":"+&#8734;")+"</span></li>"])}Ya.sort(function(a,t){return t[0]-a[0]+.001*a[1].localeCompare(t[1])});for(var Ja='<div class="tooltip-extension"><ul class="item-type"><li><span class="d3-color-gold">'+a("Stat Changes if Equipped:")+"</span></li>",G=0;G<Ya.length;++G)Ja+=Ya[G][1];U.append(Ja+"</ul></div>")}F.flavor&&!C&&U.append('<div class="tooltip-extension"><div class="flavor">'+F.flavor+"</div></div>"),o?function(){null==f&&s(),f.css({left:0,top:0,visibility:"hidden"}).show();var a,t,e=$(window),l={left:50,top:5,right:e.width()-50,bottom:e.height()-5},i=f.outerWidth(),o=f.outerHeight(),n=Math.max(Math.min(h.top,l.bottom-o),l.top),c=l.right-h.right>h.left-l.left?h.right+2:h.left-i-2;"right"===g?(a=h.right+2,t=n):"left"===g?(a=h.left-i-2,t=n):"top"===g?(a=c,t=Math.max(h.bottom-o,l.top)):(a=c,t=vertY),D&&f.css({left:a,top:t,visibility:"visible"})}():(l(e,void 0,void 0,C),C&&r(e,S,!0))}}var p,d,m,f,u,b,v,h,g,C,D=!0,y=!1,w=!1,x={head:"default",shoulders:"default",neck:"square",torso:"big",waist:"square",hands:"default",wrists:"default",legs:"default",feet:"default",finger:"square",onehand:"default",twohand:"default",offhand:"default",follower:"square",custom:"square",customwpn:"square"};$(document).keydown(function(a){if(17==a.which&&p&&p.addClass("d3-tooltip-showrange"),16==a.which&&p&&p.addClass("d3-tooltip-perfection"),(16===a.which||18===a.which)&&(16===a.which&&(y=!0),18===a.which&&(w=!0),b&&v))return r(b,v),!1}).keyup(function(a){if(17==a.which&&p&&p.removeClass("d3-tooltip-showrange"),16==a.which&&p&&p.removeClass("d3-tooltip-perfection"),(16===a.which||18===a.which)&&(16===a.which&&(y=!1),18===a.which&&(w=!1),b&&v))return r(b,v),!1}),this.show=l,this.hide=o,this.showItem=r,this.showHtml=function(a,s,e,i){null==p&&t(),p.css("max-width","none"),d.removeClass().addClass("tooltip-content"),d.html(s),l(a,e,i)},this.showSkill=function(a,s,e,i,o){null==p&&t(),p.css("max-width",""),d.removeClass().addClass("d3-tooltip-wrapper-inner");var n,c=DiabloCalc.skilltips[s][e];if(c){i&&"x"!=i||(o=!1);var r=c.elements?c.elements[i||"x"]:"phy";if(n='<div class="d3-tooltip d3-tooltip-'+(o?"rune":"skill")+'">',n+='<div class="tooltip-skill-effect effect-'+r+'"><div class="tooltip-head"><h3>',o){n+=DiabloCalc.skills[s][e].runes[i]+"</h3></div></div>",n+='<div class="tooltip-body"><span class="d3-icon d3-icon-rune d3-icon-rune-medium"><span class="rune-'+i+'"></span></span>',n+='<div class="description">';var m=c[i],f=m.indexOf('<p class="subtle">');f>=0&&(m=m.slice(0,f)+'<p class="special">'+DiabloCalc.skills[s][e].name+"</p>"+m.slice(f)),n+=m,n+='</div><span class="clear">\x3c!--   --\x3e</span></div>'}else n+=DiabloCalc.skills[s][e].name+"</h3></div></div>",n+=c.x,i&&"x"!=i&&(n+='<div class="tooltip-extension rune-extension"><span class="d3-icon d3-icon-rune d3-icon-rune-large"><span class="rune-'+i+'"></span></span>',n+='<h3 class="header-3">'+DiabloCalc.skills[s][e].runes[i]+"</h3>",n+=c[i],n+="</div>");n+="</div>"}else DiabloCalc.passives[s][e]?(n='<div class="d3-tooltip d3-tooltip-trait"><div class="tooltip-head"><h3>'+DiabloCalc.passives[s][e].name+"</h3></div>",n+=DiabloCalc.passivetips[s][e],n+="</div>"):DiabloCalc.extraskills&&DiabloCalc.extraskills[s][e]&&(n='<div class="d3-tooltip d3-tooltip-skill">',n+='<div class="tooltip-head"><h3>'+(c=DiabloCalc.extraskills[s][e]).name+"</h3></div>"+c.tip+"</div>");d.html(n),l(a)},this.showCustomSkill=function(s,e){null==p&&t(),p.css("max-width",""),d.removeClass().addClass("d3-tooltip-wrapper-inner");var i='<div class="d3-tooltip d3-tooltip-skill">';if(i+='<div class="tooltip-head"><h3>'+e.name+"</h3></div>",i+='<div class="tooltip-body">',i+='<span class="d3-icon d3-icon-skill d3-icon-skill-64 miscbuffs-icon" style="background-position: -'+64*e.icon+'px 0; width: 64px; height: 64px"><span class="frame"></span></span>',i+='<div class="description">',e.desc instanceof Array)for(var o=0;o<e.desc.length;++o)i+="<p>"+e.desc[o].replace(/\+?[0-9]+(?:\.[0-9]+)?%?/g,'<span class="d3-color-green">$&</span>')+"</p>";else i+="<p>"+e.desc+"</p>";e.level&&(i+='<p class="subtle">'+a("Unlocked at level {0}.").format("<em>"+e.level+"</em>")+"</p>"),i+="</div></div></div>",d.html(i),l(s)},this.showGem=function(s,e,i,o){function c(a,t){var s=n(DiabloCalc.stats[a.stat].format,[a.amount[e[0]]]);return t||(s='<span class="d3-color-gray">'+s+"</span>"),s}var r=e instanceof Array?void 0:DiabloCalc.legendaryGems[e],m=e instanceof Array?DiabloCalc.gemColors[e[1]]:void 0;if(r||m){i=i||0,null==p&&t(),d.empty(),p.css("max-width",""),d.removeClass().addClass("d3-tooltip-wrapper-inner"),$(".char-class").val();var f=DiabloCalc.getItemIcon(e),u=$('<div class="d3-tooltip d3-tooltip-item"></div>');d.append(u);var b=r?"orange":"blue";u.append('<div class="tooltip-head tooltip-head-'+b+'"><h3 class="d3-color-'+b+'">'+(r?r.name:m.names[e[0]])+"</h3></div>");var v=$('<div class="tooltip-body"></div>');u.append(v),v.append('<span class="d3-icon d3-icon-item d3-icon-item-large d3-icon-item-'+b+'"><span class="icon-item-gradient"><span class="icon-item-inner icon-item-square" style="background-image: url('+f+');"></span></span></span>');var h=$('<div class="d3-item-properties"></div>');v.append(h),r?(i&&h.append('<ul class="item-type-right"><li class="item-jewel-rank">'+a("Rank {0}").format(i)+"</li></ul>"),h.append('<ul class="item-type"><li><span class="d3-color-orange">'+DiabloCalc.GenderPair(DiabloCalc.qualities.legendary.prefix,a("Gem"))+"</span></li></ul>"),h.append('<div class="item-description d3-color-white"><p></p></div>')):h.append('<ul class="item-type"><li><span class="d3-color-default">'+DiabloCalc.GenderString(a("Gem"))+"</span></li></ul>"),h.append('<div class="item-before-effects"></div>');var g=$('<ul class="item-effects"></ul>');if(h.append(g),r){for(var C=r.effects[0].value.slice(),D=0;D<C.length;++D)C[D]+=i*r.effects[0].delta[D];var y=n(r.effects[0].format||DiabloCalc.stats[r.effects[0].stat].format,C,2,r.effects[0].stat),w=n(r.effects[1].format||DiabloCalc.stats[r.effects[1].stat].format,r.effects[1].value||[],i<25?1:2,r.effects[1].stat);i<25&&(w+=' <span class="d3-color-red">'+a("(Requires Rank {0})").format(25)+"</span>"),g.append('<li class="d3-color-orange d3-item-property-default"><p>'+y+"</p></li>"),g.append('<li class="d3-color-'+(i<25?"gray":"orange")+' d3-item-property-default"><p>'+w+"</p></li>"),h.append('<ul class="item-extras"><li>'+a("Account Bound")+'</li></ul><span class="item-unique-equipped">'+a("Unique Equipped")+'</span><span class="clear">\x3c!--   --\x3e</span>')}else g.append('<li class="d3-color-white">'+a("Can be inserted into equipment with sockets.")+"</li>"),g.append('<li class="gem-effect"><span class="d3-color-gray">'+a("Helm:")+"</span> "+c(m.head,!o||"head"===o)+"</li>"),g.append('<li class="gem-effect"><span class="d3-color-gray">'+a("Weapon:")+"</span> "+c(m.weapon,!o||"weapon"===o)+"</li>"),g.append('<li class="gem-effect"><span class="d3-color-gray">'+a("Other:")+"</span> "+c(m.other,"head"!==o&&"weapon"!==o)+"</li>"),h.append('<ul class="item-extras"><li>'+a("Account Bound")+'</li></ul><span class="clear">\x3c!--   --\x3e</span>');r&&r.flavor&&u.append('<div class="tooltip-extension"><div class="flavor">'+r.flavor+"</div></div>"),l(s)}},this.showAttack=function(a,s){null==p&&t(),p.css("max-width",""),d.removeClass().addClass("d3-tooltip-wrapper-inner");var e='<div class="d3-tooltip d3-tooltip-skill">';e+='<div class="tooltip-skill-effect effect-phy"><div class="tooltip-head"><h3>'+s.name+"</h3></div></div>",e+='<div class="tooltip-body"><span class="d3-icon d3-icon-skill d3-icon-skill-64 skill-icon-attack '+s.id+'">',e+='<span class="frame"></span></span> <div class="description"><p>'+s.tip+"</p></div></div></div>",d.html(e),l(a)},this.showExtraItem=function(s,e){null==p&&t();var i=DiabloCalc.webglItems[e];if(i||(i=DiabloCalc.webglDyes[e]),i){p.css("max-width",""),d.removeClass().addClass("d3-tooltip-wrapper-inner");var o='<div class="d3-tooltip d3-tooltip-item"><div class="d3-tooltip-item-wrapper">';o+='<div class="tooltip-head tooltip-head-white"><h3 class="d3-color-white">'+(i.name||"Unknown item")+"</h3></div>";var n="square";if(i.type&&DiabloCalc.itemTypes[i.type]&&(n=x[DiabloCalc.itemTypes[i.type].slot]||"square"),o+='<div class="tooltip-body">',o+='<span class="d3-icon d3-icon-item d3-icon-item-large d3-icon-item-white">',o+='<span class="icon-item-gradient">',o+='<span class="icon-item-inner icon-item-'+n+'" style="background-image: url('+DiabloCalc.getItemIcon(e)+');"></span>',o+="</span>",o+="</span>",o+='<div class="d3-item-properties">',DiabloCalc.webglDyes[e])o+='<ul class="item-type"><li><span class="d3-color-default">'+a("Dye")+"</span></li></ul>",o+='<div class="item-description d3-color-white"><p>'+a("Changes the color of a single piece of armor. ")+"</p></div>",o+='<div class="item-before-effects"></div>';else if(i.type&&DiabloCalc.itemTypes[i.type]){var c=DiabloCalc.itemTypes[i.type],r=DiabloCalc.itemSlots[c.slot]||DiabloCalc.metaSlots[c.slot],m="";(i.class||c.class)&&(m='<li class="item-class-specific d3-color-white">'+DiabloCalc.classes[i.class||c.class].name+"</li>"),o+='<ul class="item-type-right"><li class="item-slot">'+r.name+"</li>"+m+"</ul>",o+='<ul class="item-type"><li class="d3-color-white">'+c.name+"</li></ul>"}o+='<span class="clear">\x3c!-- --\x3e</span>',o+="</div>",o+="</div>",i.flavor&&(o+='<div class="tooltip-extension"><div class="flavor">'+i.flavor+"</div></div>"),o+="</div></div>",d.html(o),l(s)}},this.getNode=function(){return b},this.enable=function(){D=!0},this.disable=function(){D=!1,o()}}}();