!function(){function a(a,l,e){var s=e.getValue(l.stat);return a=a.replace(/{([^};]*)(?:;(\+)?([0-9])?(\%)?(x)?)?}/g,function(a,l,t,i,o,n){return l=l.replace(/\$([1-9])/g,function(a,l){return"number"==typeof s?s:s[["min","max"][parseInt(l)-1]]}),l=e.execString(l),l="number"==typeof l?DiabloCalc.formatNumber(l,i,1e3):DiabloCalc.formatNumber(l.min,i,1e3)+"-"+DiabloCalc.formatNumber(l.max,i,1e3),'<span class="d3-color-green">'+(t||"")+l+(o||"")+(n||"")+"</span>"}),(a=a.replace(/\$([1-9])/g,function(a,e){return'<span class="d3-color-green">'+(l.plus?"+":"")+DiabloCalc.formatNumber("number"==typeof s?s:s[["min","max"][parseInt(e)-1]],l.decimal,1e3)+(l.percent?"%":"")+"</span>"})).replace(/<\/span>-<span class="d3-color-green">/g,"-")}function l(l,e){function s(a){return DiabloCalc.formatNumber(a,d,1e3)+f}function t(a){return'<span class="d3-color-'+(a>=0?"green":"red")+'">'+s(a)+"</span>"}var o=a(l.tooltip,l,e),n="</span>";o=o.replace(/\n( ?\* )?/g,function(a,l){var e=n+'<br/><span class="tooltip-icon-'+(l?"bullet":"nobullet")+'"></span>';return n="",e}),l.suffix&&(o+=n+'<br/><span class="tooltip-icon-bullet"></span>'+a(l.suffix,l,e),n="");var c=l.sourcestat||l.stat;if(DiabloCalc.stats[c]){var r={},p={};if("damage"!=c&&(!DiabloCalc.stats[c].classes||DiabloCalc.stats[c].classes.indexOf(DiabloCalc.charClass)>=0)&&DiabloCalc.getItemAffixes)for(var u in DiabloCalc.itemSlots){(m=DiabloCalc.getItemAffixes(u,!0))&&m[c]&&m[c].min&&m[c].max&&(r[u]=0,p[u]=m[c])}if(DiabloCalc.stats[c]&&DiabloCalc.stats[c].resist&&e.sources.resall){r=$.extend(r,e.sources.resall);for(var u in e.sources.resall)if(DiabloCalc.itemSlots[u]&&DiabloCalc.getItemAffixes){var m=DiabloCalc.getItemAffixes(u,!0);m&&m.resall&&m.resall.min&&m.resall.max&&(p[u]=m.resall)}}e.sources[c]&&(r=$.extend(r,e.sources[c]));var b=[];if(DiabloCalc.stats[c]&&DiabloCalc.stats[c].special&&(b=e.getSpecial(c,null,!1,null)),!$.isEmptyObject(r)||!$.isEmptyObject(b)){o+=n,o+='<br/><span class="tooltip-icon-bullet"></span>'+(l.sourcename||i("Increased by"))+":",n="";var d=void 0===l.sourcedecimal?l.decimal:l.sourcedecimal,f=(void 0===l.sourcepercent?l.percent:l.sourcepercent)?"%":"";for(var C in r)DiabloCalc.sourceNames[C]&&(o+='<br/><span class="tooltip-icon-nobullet"></span><span class="d3-color-'+(r[C]?"gold":"gray")+'">'+DiabloCalc.sourceNames[C]+"</span>: ",r[C]?(o+=t(r[C]),p[C]&&(o+=' <span class="d3-color-gray">('+s(p[C].min)+"-"+s(p[C].max)+")</span>")):p[C]&&(o+='<span class="d3-color-gray">'+s(p[C].min)+"-"+s(p[C].max)+"</span>"));for(var h=0;h<b.length;++h)o+='<br/><span class="tooltip-icon-nobullet"></span><span class="d3-color-gold">'+b[h][0]+"</span>: ",o+=t(b[h][1])}}return'<div xmlns="http://www.w3.org/1999/xhtml" class="profile-tooltip"><p><span class="d3-color-gold">'+o+n+"</p></div>"}function e(a,l){var e=l.sources[a]||{};DiabloCalc.onHighlight&&DiabloCalc.onHighlight(!0),DiabloCalc.stats[a]&&DiabloCalc.stats[a].resist&&l.sources.resall&&(e=$.extend(e,l.sources.resall));for(var s in DiabloCalc.itemSlots)(e[s]||DiabloCalc.itemSlots[s].item&&e[DiabloCalc.itemSlots[s].item.id])&&DiabloCalc.itemSlots[s].dollFrame.addClass("highlight")}function s(){DiabloCalc.onHighlight&&DiabloCalc.onHighlight(!1);for(var a in DiabloCalc.itemSlots)DiabloCalc.itemSlots[a].dollFrame&&DiabloCalc.itemSlots[a].dollFrame.removeClass("highlight")}function t(){for(var a=r.find("input").val().toLowerCase(),l=DiabloCalc.getStats(),e=$(".char-class").val(),s=0;s<o.length;++s)for(var t=0;t<o[s].stats.length;++t){var i=o[s].stats[t];if(i.line&&!i.separator)if(i.classes&&i.classes.indexOf(e)<0)i.line.hide();else if(a&&i.name.toLowerCase().indexOf(a)<0)i.line.hide();else{var n=l.getValue(i.stat);!i.collapse||n?("number"==typeof n?(i.line.toggleClass("zero",!n),n=DiabloCalc.formatNumber(n,i.decimal,1e3)):(i.line.toggleClass("zero",!n.min&&!n.max),n=DiabloCalc.formatNumber(n.min,i.decimal,1e3)+"-"+DiabloCalc.formatNumber(n.max,i.decimal,1e3)),i.value.text((i.plus?"+":"")+n+(i.percent?"%":"")),i.line.show()):i.line.hide()}}}var i=DiabloCalc.locale("ui-stats.js"),o=DiabloCalc.localeTable.uiStats,n=$(".col.statsframe .statsframe-list"),c=$(".col.statsframe");n=DiabloCalc.addScroll(n,"y");var r=$('<div class="statsframe-search empty"><input placeholder="'+i("Search")+'"></input><span class="clear"></span></div>');c.prepend(DiabloCalc.account.makeLine(),r),r.find("input").focus(function(){$(this).attr("placeholder","")}).blur(function(){$(this).attr("placeholder",i("Search"))}).on("input",function(){t(),n.toggleClass("search",$(this).val().length>0),r.toggleClass("empty",0===$(this).val().length)}),r.find(".clear").click(function(){r.find("input").val("").trigger("input")});for(var p=o[1].stats,u=0;u<p.length&&!p[u].separator;)u++;for(var m in DiabloCalc.stats)DiabloCalc.stats[m].skill&&p.splice(u,0,{name:i("{0} Damage Increase").format(DiabloCalc.stats[m].skill),stat:m,decimal:2,percent:!0,classes:DiabloCalc.stats[m].classes,collapse:!0,tooltip:i("{0} Damage Increase: $1\n* Increases Damage dealt by this skill.").format(DiabloCalc.stats[m].skill)});var b=$('<div class="col-container"></div>');n.append(b);var d=$('<div class="column"></div>');b.append(d);for(var f={},C=0;C<o.length;++C){var h=$('<div class="stat-section"></div>');d.append(h),h.append("<h3>"+o[C].name+"</h3>");var g=$('<ul class="flex"></ul>');h.append(g);for(var v=0;v<o[C].stats.length;++v){var D=o[C].stats[v];(!D.stat||D.name||DiabloCalc.stats[D.stat])&&(D.line=$("<li></li>"),f[D.stat]=D,g.append(D.line),D.separator?D.line.addClass("stat-separator"):(D.name||(D.name=DiabloCalc.stats[D.stat].name),D.line.append("<span>"+D.name+"</span>"),D.value=$("<span></span>"),D.line.append(D.value),D.line.hover(function(a){return function(){if(DiabloCalc.getStats&&DiabloCalc.tooltip){var s=DiabloCalc.getStats();DiabloCalc.tooltip.showHtml(this,l(a,s),"left");e(a.sourcestat||a.stat,s)}}}(D),function(){DiabloCalc.tooltip&&(DiabloCalc.tooltip.hide(),s())})))}}var x=$('<div class="stat-section export"><h3>'+i("Export")+"</h3><ul></ul></div>");d.append(x);var S=document.createElement("a");x.find("ul").append($('<li><span class="link-like">'+i("Export CSV")+"</span></li>").on("click","span",function(){for(var a=DiabloCalc.getProfile(),l=[],e=[DiabloCalc.classes[a.class].name],s=[i("LMB"),i("RMB"),"1","2","3","4"],t=DiabloCalc.locale("ui-skills.js")("No rune"),o=0;o<a.skills.length;++o){c=(n=a.skills[o])&&DiabloCalc.skills[a.class][n[0]];n&&c&&l.push(s[o]+","+c.name+","+("x"===n[1]?t:c.runes[n[1]]))}l.length&&(e.push(l.join("\n")),l.length=0);for(o=0;o<a.passives.length;++o){var n=a.passives[o],c=n&&DiabloCalc.passives[DiabloCalc.charClass][n];n&&c&&l.push(c.name)}l.length&&(e.push(l.join("\n")),l.length=0);var r=DiabloCalc.locale("ui-equipment.js");for(var o in a.items){var p=[DiabloCalc.itemSlots[o].name],c=(g=a.items[o])&&DiabloCalc.itemById[g.id];if(g&&c){p.push(c.name),p.push(g.ancient?r("Ancient"):"");for(var u in g.stats){var m="custom"===u&&c.required&&c.required.custom&&c.required.custom.name||DiabloCalc.stats[u]&&DiabloCalc.stats[u].name;m&&p.push(g.stats[u].join("-")+" "+m)}}else p.push(r("Empty slot"));if(l.push(p.join(",")),g&&g.gems)for(var b=0;b<g.gems.length;++b){if((C=g.gems[b])&&C instanceof Array){var d=DiabloCalc.legendaryGems[C[0]],f=DiabloCalc.gemColors[C[1]];d?l.push(","+d.name+","+C[1]):f&&l.push(","+f.names[C[0]])}}}l.length&&(e.push(l.join("\n")),l.length=0);for(var C in a.kanai){var h=a.kanai[C],g=h&&DiabloCalc.itemById[h];g&&l.push(g.name)}l.length&&(l.unshift(DiabloCalc.locale("ui-skills.js")("Kanai's Cube")),e.push(l.join("\n")),l.length=0);var v=window.URL.createObjectURL(new Blob([e.join("\n\n")],{type:"text/csv"}));S.href=v,S.download="profile.csv",document.body.appendChild(S),S.click(),setTimeout(function(){document.body.removeChild(S),window.URL.revokeObjectURL(v)},100)})),DiabloCalc.isKnownStat=function(a){return!!f[a]},DiabloCalc.showStatTip=function(a,e){f[e]&&DiabloCalc.tooltip.showHtml(a,l(f[e],DiabloCalc.getStats()))};var y=$('<div class="column"></div>');b.append(y),b.find(".column").sortable({containment:b,connectWith:".col.statsframe .column",items:".stat-section",handle:"h3",distance:4,placeholder:"drop-ph",forcePlaceholderSize:!0,start:function(){c.addClass("two-column")},stop:function(){setTimeout(function(){y.is(":empty")&&c.removeClass("two-column")},0)}}),$(".col.statsframe h3").click(function(){$(this).next().slideToggle()}),DiabloCalc.register("updateStats",t)}();