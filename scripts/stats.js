!function(){function addStat(t,s,i,e,a){if(i){if(i.source)return addStat(t,s,i.value,e,i.source);var n=statInfo[s];if(e||(e=1),n&&n.special&&t.special&&a){if(t.special[s]||(t.special[s]={}),t.special[s][a]||(t.special[s][a]=[]),i instanceof Array)t.special[s][a].push({percent:i[0]*e}),i=i[0];else if("number"==typeof i)t.special[s][a].push({percent:i*e});else{if(i.list){for(f=0;f<i.list.length;++f)addStat(t,s,i.list[f],e,a);return}var h=$.extend({},i);h.percent*=e,t.special[s][a].push(h),i=void 0===i.elems&&void 0===i.pet&&void 0===i.skills?i.percent:void 0}i&&(n.mult?t[s]=(t[s]||1)*(1+.01*i*e):t[s]=(t[s]||0)+i*e)}else{if(a&&t.sources){var r=("number"==typeof i?i:i[0])*e;r&&(t.sources[s]||(t.sources[s]={}),t.sources[s][a]=(t.sources[s][a]||0)+r)}if(n&&0==n.args)t[s]=1;else if(n&&1!=n.args)if(-1==n.args)t[s]=i.length>0?i[0]:"";else{void 0===t[s]&&(t[s]={});var o=n.argnames||["min","max"];if(n&&n.dr){t[s][o[0]]=100-.01*(100-(t[s][o[0]]||0))*Math.max(0,100-(void 0!==i[0]?i[0]:i[o[0]])*e);for(f=1;f<n.args;++f)t[s][o[f]]=Math.max(t[s][o[f]]||0,(void 0!==i[f]?i[f]:i[o[f]])*e)}else for(var f=0;f<n.args;++f)t[s][o[f]]=(!n.nostack&&t[s][o[f]]||0)+(void 0!==i[f]?i[f]:i[o[f]])*e}else"number"!=typeof i&&(i=i[0]),void 0===t[s]||n&&n.nostack?t[s]=i*e:n&&n.dr?t[s]=100-.01*(100-t[s])*Math.max(0,100-i*e):t[s]+=i*e}}}function Stats(t){switch(this.info={level:parseInt($(".char-level").val()),gems:0,ancients:0},this.charClass=t||DC.charClass,this.primary=DC.classes[this.charClass].primary,this.str=7+this.info.level,this.dex=7+this.info.level,this.int=7+this.info.level,this.vit=7+2*this.info.level,this.chc=5,this.chd=50,this.ias=0,this.gems={},this.sources={},this.special={},this.skills={},this.passives={},this[this.primary]+=2*this.info.level,this.info.mainhand={speed:1,wpnphy:{min:2,max:3}},this.info.sets={},this.info.itemregen=0,this.affixes={},this.charClass){case"wizard":this.maxap=100,this.apregen=10;break;case"demonhunter":this.maxhatred=125,this.hatredregen=5,this.maxdisc=30,this.discregen=1;break;case"witchdoctor":this.maxmana=750,this.manaregen=50;break;case"barbarian":this.maxfury=100;break;case"monk":this.maxspirit=250;break;case"crusader":this.maxwrath=100,this.wrathregen=2.5;break;case"necromancer":this.maxessence=200}}function invalidate(){statCache=null,DC.trigger("updateStats")}function computeStats(t,s){var i=new Stats;return s&&(statCache=i),i.loadItems(t),DC.addSkillBonuses&&DC.addSkillBonuses(i),i.finalize(),finCache=i,i}var DC=DiabloCalc,statInfo=$.extend({},DC.stats);Stats.prototype.addAbsolute=function(t,s){if(this[s]){var i=statInfo[t];this.sources[s],this[s];if(this.sources[s]){this.sources[t]||(this.sources[t]={});for(var e in this.sources[s])this.sources[t][e]&&i&&i.dr?this.sources[t][e]=100-.01*(100-this.sources[t][e])*(100-this.sources[s][e]):this.sources[t][e]=(this.sources[t][e]||0)+this.sources[s][e]}this[t]&&i&&i.dr?this[t]=100-.01*(100-this[t])*(100-this[s]):this[t]=(this[t]||0)+this[s]}},Stats.prototype.addPercent=function(t,s,i){var e,a;if("string"==typeof s){if(!this[s])return;e=this.sources[s],a=this[s]}else{e={},a=0;for(var n=0;n<s.length;++n)if(this[s[n]]){a+=this[s[n]];var h=this.sources[s[n]];if(h)for(var r in h)e[r]=(e[r]||0)+h[r]}if(!a)return}if(void 0===i){if(!this[t])return;i=this[t]}if(e){this.sources[t]||(this.sources[t]={});for(var r in e)if("number"==typeof i){f=.01*i*e[r];this.sources[t][r]=(this.sources[t][r]||0)+f}else for(var o in i){var f=.01*i[o]*e[r];this.sources[t][r]=(this.sources[t][r]||0)+f;break}}if("number"==typeof i)this[t]=(this[t]||0)+.01*i*a;else{this[t]||(this[t]={});for(var o in i)this[t][o]=(this[t][o]||0)+.01*i[o]*a}},Stats.prototype.add=function(t,s,i,e){addStat(this,t,s,i,e)},Stats.prototype.getValue=function(t){for(var s=this,i=t.split(".");"object"==typeof s&&i.length;)s=s[i.shift()];return s||0},Stats.prototype.execString=function(expr){var self=this;return expr=expr.replace(/[a-z_][a-z0-9_]*(?:\.[a-z_][a-z0-9_]*)*/g,function(t){var s=self.getValue(t);return"number"!=typeof s?"("+JSON.stringify(s)+")":s}),eval(expr)},Stats.prototype.getAffixSource=function(t){var s=this.affixes[t];if(s)return s.set?s.set:s.slot?DC.getSlotId(s.slot):s.kanai?DC.getSkills().kanai[s.kanai]:void 0},Stats.prototype.getSpecial=function(t,s,i,e,a){if(!this.special[t])return{};var n=[];for(var h in this.special[t])for(var r=0;r<this.special[t][h].length;++r){var o=this.special[t][h][r];if(o.percent&&!(a&&a.indexOf(h)>=0||o.elems&&o.elems.indexOf(s)<0||void 0!==o.pet&&o.pet!=(i||!1)||o.skills&&o.skills.indexOf(e)<0)){var f;f=o.name?o.name:DC.sourceNames[h]||h,n.push([f,o.percent])}}return n},Stats.prototype.getTotalSpecial=function(t,s,i,e,a){var n=statInfo[t].mult?1:0;if(!this.special[t])return n;for(var h in this.special[t])for(var r=0;r<this.special[t][h].length;++r){var o=this.special[t][h][r];a&&a.indexOf(h)>=0||(o.elems&&o.elems.indexOf(s)<0||void 0!==o.pet&&o.pet!=(i||!1)||o.skills&&o.skills.indexOf(e)<0||(statInfo[t].mult?n*=1+.01*o.percent:n+=o.percent))}return n},Stats.prototype.startLoad=function(){this.extraFx={},DiabloCalc.addExtraAffixes&&DiabloCalc.addExtraAffixes(this.extraFx),this.setSlots={}},Stats.prototype.addItem=function(t,s,i){function e(t,s){var i,e;if(t.realvalue?(i=t.realvalue.slice(),e=t.realdelta):t.value&&(i=t.value.slice(),e=t.delta),!i)return[];if(e)for(var a=0;a<e.length;++a)i[a]+=e[a]*s;return i}if(s&&DC.itemById[s.id]){var a=DC.itemById[s.id],n=DC.itemTypes[a.type];if("offhand"===t&&(this.info.ohtype=a.type),s.ancient&&++this.info.ancients,n.weapon){var h=n.weapon;a.weapon&&(h=$.extend({},h,a.weapon)),this.info[t]={speed:h.speed*(1+.01*(s.stats.weaponias||[0])[0]),ias:(s.stats.weaponias||[0])[0],wpnphy:{min:h.min,max:h.max},damage:(s.stats.damage||[0])[0],type:a.type,slot:n.slot,weaponClass:h.type}}a.set&&(this.info.sets[a.set]=(this.info.sets[a.set]||0)+1,this.setSlots[a.set]||(this.setSlots[a.set]=t));for(var r in s.stats){var o=r;"custom"==r&&(o=a.required.custom.id,statInfo[o]=a.required.custom,statInfo[o].nostack=!0,void 0===statInfo[o].args&&(statInfo[o].args=1),this.affixes[o]={slot:t,value:s.stats[r]}),statInfo[o].damage&&n.weapon?("mainhand"===t&&(this.info.mhelement=DiabloCalc.stats[r].elem),addStat(this.info[t],"wpnphy",s.stats[r])):("damage"!=o&&"weaponias"!=o||!n.weapon)&&addStat(this,o,s.stats[r],1,t),"regen"==r&&(this.info.itemregen+=s.stats[r][0])}if(s.gems){var f=1;s.stats.custom&&"leg_leoricscrown"==a.required.custom.id&&(f=1+.01*s.stats.custom[0]),"head"===t&&this.extraFx.leg_leoricscrown&&(f=1+.01*this.extraFx.leg_leoricscrown);var d=(DC.metaSlots[n.slot]||DC.itemSlots[n.slot]).socketType;"weapon"!=d&&"head"!=d&&(d="other"),this.info.gems+=s.gems.length;for(var l=0;l<s.gems.length;++l)if(DC.legendaryGems[s.gems[l][0]]){var c=DC.legendaryGems[s.gems[l][0]];if(this.gems[s.gems[l][0]]=s.gems[l][1],!i){var p=DC.isGemActive&&DC.isGemActive(s.gems[l][0]);if(p&&c.buffs){m=c.buffs(s.gems[l][1],this);for(var r in m)this.add(r,m[r],1,s.gems[l][0])}else{if(p){(u=c.effects[0].stat)||(u="gem_"+s.gems[l][0],statInfo[u]=c.effects[0]),this.add(u,e(c.effects[0],s.gems[l][1]),1,s.gems[l][0])}else if(c.inactive){var m=c.inactive(s.gems[l][1],this);for(var r in m)this.add(r,m[r],1,s.gems[l][0])}if(s.gems[l][1]>=25&&(p||"powerful"==s.gems[l][0])){var u=c.effects[1].stat;u||(u="gem_"+s.gems[l][0]+"_25",statInfo[u]=c.effects[1]),this.add(u,e(c.effects[1],s.gems[l][1]),1,s.gems[l][0])}}}}else if(DC.gemColors[s.gems[l][1]]){var g=DC.gemColors[s.gems[l][1]][d],v=[g.amount[s.gems[l][0]]];"wpnphy"==g.stat&&v.push(v[0]),statInfo[g.stat].damage&&n.weapon?addStat(this.info[t],"wpnphy",v,f):this.add(g.stat,v,f,"gems")}}}},Stats.prototype.finishLoad=function(){for(var t in this.extraFx)this.add(t,this.extraFx[t]);delete this.extraFx;for(var s in this.info.sets){var i=DC.itemSets[s],e=this.info.sets[s];e>=2&&this.leg_ringofroyalgrandeur&&(e+=1);for(var a in i.bonuses)if(e>=parseInt(a)){statInfo[r="set_"+s+"_"+a+"pc"]={args:0},this.add(r,!0);for(var n=0;n<i.bonuses[a].length;++n)i.bonuses[a][n].stat&&this.add(i.bonuses[a][n].stat,i.bonuses[a][n].value,1,s);this.affixes[r]={slot:this.setSlots[s],set:s,pieces:a,value:[]}}}delete this.setSlots;var h=DC.getParagon();if(h)for(var r in h)this.add(r,h[r],1,"paragon"),"regen"===r&&(this.info.itemregen+=h[r][0]);this.info.offhand?"fist"===this.info.offhand.weaponClass?this.info.weaponClass="dualwield"+("fist"===this.info.mainhand.weaponClass?"_ff":"_sf"):this.info.weaponClass="dualwield":this.info.weaponClass=this.info.mainhand.weaponClass},Stats.prototype.loadItems=function(t,s){t||(t=DC.getSlot),this.startLoad(),DiabloCalc.options.seasonal&&(this.info.sets.nightmares=2,this.setSlots.nightmares="leftfinger");for(var i in DC.itemSlots)this.addItem(i,t(i),s);this.finishLoad()},Stats.prototype.finalize=function(t,s){if(this.chc=Math.min(75,this.chc),this.addAbsolute("chc","extrachc"),this.chc=Math.min(100,this.chc),this.expmul&&(this.expmul*=.1),this.addAbsolute("str","caldesanns_str"),this.addAbsolute("dex","caldesanns_dex"),this.addAbsolute("int","caldesanns_int"),this.addAbsolute("vit","caldesanns_vit"),this.addPercent("str","str_percent"),this.addPercent("dex","dex_percent"),this.addPercent("int","int_percent"),!t){addStat(this,"armor",this.str,1,"str"),addStat(this,"armor",this.dex,1,"dex"),addStat(this,"resall",this.int,.1,"int"),this.armor+=this.basearmor||0,this.addPercent("armor","armor_percent"),this.passives.holdyourground&&this.dodge&&(this.sources.dodge.holdyourground=-this.dodge,this.dodge=0),addStat(this,"blockamount",[0,0]),this.addPercent("blockamount","blockamount_percent"),addStat(this,"block",this.baseblock,1,"baseblock"),this.block=Math.min(75,this.block||0),this.addAbsolute("block","extra_block"),this.addPercent("block","block_percent"),this.block=Math.min(100,this.block),this.leg_justicelantern&&this.add("dmgred",this.block*this.leg_justicelantern*.01,1,"P4_Unique_Ring_03");var i=10;70==this.info.level?i=100:this.info.level>65?i=5*this.info.level-270:this.info.level>60?i=4*this.info.level-205:this.info.level>35&&(i=this.info.level-25),this.info.hppervit=i,this.info.hp=36+4*this.info.level+this.vit*i,this.info.hp*=1+.01*(this.life||0);for(var e=["resphy","resfir","rescol","reslit","respsn","resarc"],a=0;a<e.length;++a)addStat(this,e[a],this.resall);for(a=0;a<e.length;++a)this.addPercent(e[a],["resist_percent",e[a]+"_percent"]);this.info.resavg=0,this.info.resmin=0;for(a=0;a<e.length;++a)this.info.resmin+=(this[e[a]]<0?-1:1)*Math.sqrt(Math.abs(this[e[a]])),this.info.resavg+=this[e[a]];this.info.resavg/=6,this.info.resmin=(this.info.resmin<0?-1:1)*(this.info.resmin*this.info.resmin)/36,this.info.defavg=1-.01*((this.meleedef||0)+(this.rangedef||0))*.333333;var n=.01*(this.nonphys||0);this.info.defavg*=1-.01*(this.physdef||0)*.16663,this.info.defavg*=1-.16663*(1-(1-n)*(1-.01*(this.colddef||0))),this.info.defavg*=1-.16663*n,this.info.defavg*=1-.16663*n,this.info.defavg*=1-.16663*n,this.info.defavg*=1-.16663*(1-(1-n)*(1+.01*(this.firetaken||0))),this.info.defavg*=1-.01*(this.dmgred||0),this.info.armor_factor=1/(1+this.armor/(50*this.info.level)),this.info.res_factor=1/(1+this.info.resavg/(5*this.info.level)),this.info.resmin_factor=1/(1+this.info.resmin/(5*this.info.level)),this.info.defense_factor=this.info.armor_factor*this.info.res_factor*(1-.01*(this.edef||0)/2)*this.info.defavg,this.info.defensemin_factor=this.info.armor_factor*this.info.resmin_factor*(1-.01*(this.edef||0)/2)*this.info.defavg,this.info.toughness=this.info.hp/this.info.defense_factor/(1-.01*(this.dodge||0)),this.info.toughnessmin=this.info.hp/this.info.defensemin_factor/(1-.01*(this.dodge||0)),this.info.toughpervit=this.info.toughness/this.info.hp*100*i*(1+.01*(this.life||0)),this.info.toughperlife=.01*this.info.toughness/(1+.01*(this.life||0)),this.info.toughperarmor=100*this.info.toughness/(50*this.info.level)*this.info.armor_factor*(1+.01*(this.armor_percent||0));var h=1+.01*(this.resist_percent||0)+.01*((this.resphy_percent||0)+(this.resfir_percent||0)+(this.rescol_percent||0)+(this.reslit_percent||0)+(this.respsn_percent||0)+(this.resarc_percent||0))/6;this.info.toughperres=100*this.info.toughness/(5*this.info.level)*this.info.res_factor*h,this.info.toughper650vit=100*this.info.toughpervit*6.5/this.info.toughness,this.info.toughper15life=100*this.info.toughperlife*15/this.info.toughness,this.info.toughper775armor=100*this.info.toughperarmor*7.75/this.info.toughness,this.info.toughper130res=100*this.info.toughperres*1.3/this.info.toughness,this.info.resphy_factor=1/(1+this.resphy/(5*this.info.level)),this.info.resfir_factor=1/(1+this.resfir/(5*this.info.level)),this.info.rescol_factor=1/(1+this.rescol/(5*this.info.level)),this.info.reslit_factor=1/(1+this.reslit/(5*this.info.level)),this.info.respsn_factor=1/(1+this.respsn/(5*this.info.level)),this.info.resarc_factor=1/(1+this.resarc/(5*this.info.level))}this.addAbsolute("thorns","firethorns"),this.addPercent("thorns","vit_to_thorns",this.vit),this.addPercent("thorns","thorns_multiply"),this.addPercent("thorns","thorns_percent"),this.info.thorns=(this.thorns||0)*(1+this[this.primary]/100),this.calcWeapon=function(t){t.speed+=this.weaponaps||0,t.speed*=1+.01*(this.weaponaps_percent||0);var s=1+.01*(t.damage||0);t.wpnphy.min*=s,t.wpnphy.max*=s,this.wpnphy&&(t.wpnphy.min+=this.wpnphy.min,t.wpnphy.max+=this.wpnphy.max),t.wpnbase=$.extend({},t.wpnphy),s=(1+.01*this[this.primary])*(1+.01*(this.damage||0)),t.wpnphy.min*=s,t.wpnphy.max*=s,t.damage=.5*(t.wpnphy.min+t.wpnphy.max),t.speed*=1+.01*this.ias,t.speed=Math.min(5,t.speed),t.dps=t.damage*this.info.critfactor*t.speed,t.dph=t.damage*this.info.critfactor},this.info.offhand&&this.add("ias",15,1,"dualwield"),this.info.critfactor=1+.01*this.chc*(.01*this.chd),this.calcWeapon(this.info.mainhand),this.info.offhand?(this.calcWeapon(this.info.offhand),this.info.aps=2/(1/this.info.mainhand.speed+1/this.info.offhand.speed),this.info.dps=(this.info.mainhand.dph+this.info.offhand.dph)*this.info.aps/2):(this.info.dps=this.info.mainhand.dps,this.info.aps=this.info.mainhand.speed),this.info.maxelem="arc",this.info.elemental=this.dmgarc||0;for(var r in DC.elements){var o=this["dmg"+r]||0;o>this.info.elemental&&(this.info.maxelem=r,this.info.elemental=o)}t||(this.addAbsolute("regen","post_regen"),this.addPercent("regen","post_regen_bonus",this.info.itemregen),this.addPercent("regen","regen_bonus"),this.info.healing=(this.regen||0)+.01*(this.regen_percent||0)*this.info.hp+(this.lph||0)*this.info.aps+.16*(this.laek||0)+.08*(this.healbonus||0),this.info.recovery=this.info.healing*this.info.toughness/this.info.hp,this.info.recoverymin=this.info.healing*this.info.toughnessmin/this.info.hp),this.info.edps=this.info.dps*(1+.01*(this.edmg||0)),this.info.elementaldps=this.info.dps*(1+.01*this.info.elemental),this.info.dph=this.info.dps/this.info.aps,this.info.primary=this[this.primary];this.info.dmgmul=100*((this.dmgmul||1)-1),this.final={},this.final.addbase=1+.01*(this.damage||0)+.01*(this.dmgtaken||0),this.final.chc=this.chc+(this.chctaken||0),this.final.chc*=1+.01*(this.chctaken_percent||0);var f=(this.dmgmul||1)*this.final.addbase/(1+.01*(this.damage||0));if(f*=(1e4+this.final.chc*this.chd)/(1e4+this.chc*this.chd),this.final.dps=this.info.dps*f,this.final.dph=this.info.dph*f,this.final.elemdps=this.final.dps*(1+.01*this.info.elemental),this.final.elemdph=this.final.dph*(1+.01*this.info.elemental),this.final.elemedps=this.final.elemdps*(1+.01*(this.edmg||0)),this.final.elemedph=this.final.elemdph*(1+.01*(this.edmg||0)),!t){this.ms=Math.min(25,this.ms||0),this.addAbsolute("ms","extrams"),this.mf=Math.min(300,this.mf||0),this.info["dpsper"+this.primary]=this.info.elementaldps/(1+.01*this[this.primary]),this.info.dpsperchc=1e-4*this.info.elementaldps*this.chd/this.info.critfactor,this.info.dpsperchd=1e-4*this.info.elementaldps*this.chc/this.info.critfactor,this.info.dpsperias=.01*this.info.elementaldps/(1+.01*this.ias),this.info.dpsperelem=.01*this.info.elementaldps/(1+.01*this.info.elemental),this.info["dpsper650"+this.primary]=100*this.info["dpsper"+this.primary]*6.5/this.info.elementaldps,this.info.dpsper6chc=100*this.info.dpsperchc*6/this.info.elementaldps,this.info.dpsper50chd=100*this.info.dpsperchd*50/this.info.elementaldps,this.info.dpsper7ias=100*this.info.dpsperias*7/this.info.elementaldps,this.info.dpsper20elem=100*this.info.dpsperelem*20/this.info.elementaldps;var d=.5*(this.info.mainhand.wpnbase.min+this.info.mainhand.wpnbase.max);if(this.info.offhand){var l=this.info.mainhand.dph,c=this.info.offhand.dph,p=.5*(this.info.offhand.wpnbase.min+this.info.offhand.wpnbase.max);this.info.dpsperdmg=this.info.elementaldps*(l/d+c/p)/(l+c)}else this.info.dpsperdmg=this.info.elementaldps/d;this.info.dpsper105210dmg=100*this.info.dpsperdmg*315/2/this.info.elementaldps}switch(this.charClass){case"wizard":this.addPercent("apregen","resourcegen"),this.addAbsolute("rcr_ap","rcr");break;case"demonhunter":this.addPercent("hatredregen","resourcegen"),this.addPercent("discregen","resourcegen"),this.addAbsolute("rcr_hatred","rcr"),this.addAbsolute("rcr_disc","rcr");break;case"witchdoctor":this.addPercent("maxmana","maxmana_percent"),this.addPercent("manaregen","manaregen_percent",this.maxmana),this.addPercent("manaregen","resourcegen"),this.addAbsolute("rcr_mana","rcr");break;case"barbarian":this.addPercent("furyregen","resourcegen"),this.addPercent("lifefury","lpfs_percent"),this.addAbsolute("rcr_fury","rcr");break;case"monk":this.addPercent("spiritregen","resourcegen"),this.addAbsolute("rcr_spirit","rcr");break;case"crusader":this.addPercent("wrathregen","resourcegen"),this.addAbsolute("rcr_wrath","rcr");break;case"necromancer":this.addPercent("maxessence","maxessence_percent"),this.addPercent("essenceregen","resourcegen"),this.addAbsolute("rcr_essence","rcr")}},Stats.prototype.clone=function(){var t=new Stats(this.charClass);for(var s in this)if(this.hasOwnProperty(s)){var i=this[s];null==i||(i instanceof Array?t[s]=$.extend(!0,[],i):i instanceof Object?t[s]=$.extend(!0,{},i):void 0!==i&&(t[s]=i))}return t},Stats.prototype.flatten=function(){delete this.sources;var t={};for(var s in this.special){var i=[];for(var e in this.special[s])i=i.concat(this.special[s][e]);t[s]=i}this.special=t};var statCache=null,finCache=null;DC.getStats=function(t){return t&&finCache?finCache:statCache||(computeStats(void 0,!0),computeStats(void 0,!0),statCache)},DC.computeStats=computeStats,DC.register("updateSlotStats",invalidate),DC.register("updateParagon",invalidate),DC.register("updateSkills",invalidate),DC.register("importEnd",invalidate),DC.register("updateSlotItem",function(){statCache=null}),DC.Stats=Stats}();