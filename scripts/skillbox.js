!function(){function i(i,s){var e=s.constructor;e||(e=function(){this.parent.apply(this,arguments)}),delete s.constructor;var t=function(){};t.prototype=i.prototype,e.prototype=new t,e.prototype.uber=i;for(var a in s)e.prototype[a]=s[a];return e}function s(i){function s(i,s,a,n,o){i.data("box",t);var l=!1;i.draggable({zIndex:100,cursor:"-webkit-grabbing",appendTo:"body",tolerance:o||"intersect",distance:4,helper:a,start:function(i,s){if(!t[t.type])return setTimeout(function(){$("body").css("cursor","")}),!1;n(!0),e.tooltip&&e.tooltip.disable()},revert:function(i){return e.tooltip&&e.tooltip.enable(),!i},stop:function(){if(l)return!1;setTimeout(function(){n(!1)},0)}}),s.droppable({hoverClass:"selected",accept:function(i){var s=i.data("box");return!(!s||s.type!==t.type||!s[s.type]||s===t)&&(t.accept(s[s.type])&&s.accept(t[t.type]))},drop:function(i,s){var a=s.draggable.data("box");if(!a||a.type!==t.type||a===t)return!1;var n=a[a.type];n&&t.accept(n)&&a.accept(t[t.type])&&(a._set(t[t.type]),t._set(n),e.trigger("updateSkills",!0))}})}if(this.paramList=[],this.line=$('<div class="skill-line"></div>'),i&&i.append(this.line),this.initHeader(),this.readonly&&this.header.addClass("readonly"),this.level&&this.icon.append('<span class="skill-text">'+this.level+"</span>"),this.desc=$('<span class="skill-description"></span>'),this.line.append(this.header.append(this.icon,this.desc)),this.applybox=$('<input type="checkbox"></input>'),this.params=$('<ul class="skill-info"></ul>').hide(),this.initName(),this.apply.prepend(this.applybox),this.init&&this.init(),this.header.mouseleave(function(){e.tooltip.hide()}),this.apply.click(function(i){i.stopPropagation()}),this.updateParams(),!this.readonly){var t=this;this.accept=function(i){if(!i)return!0;if("skill"===this.type&&0===this.index){var s=e.skills[e.charClass][i[0]];if(!s||s.nolmb)return!1}return!0},s(this.header,this.line,function(){return t.header.clone().addClass("class-"+e.charClass)},function(i){t.header.css("visibility",i?"hidden":"")});var a="skill"===this.type?e.getDollSkill:e.getDollPassive;a&&(a=a(this.index)),a&&s(a,a,function(){return $('<div class="class-'+e.charClass+'" style="width: 42px; height: 42px; position: absolute"></div>').append(a.clone().css("left",0))},function(i){a.toggleClass("empty",i||!t[t.type])},"pointer")}e.enableTouch(this.header)}var e=DiabloCalc,t=e.locale("ui-skills.js","skilldata"),a={weapon:{name:t("Weapon"),filter:function(i){var s=e.itemTypes[i]&&e.itemTypes[i].slot;return"onehand"===s||"twohand"===s||"offhand"===s}},armor:{name:t("Armor"),filter:function(i){return!a.weapon.filter(i)&&!a.jewelry.filter(i)}},jewelry:{name:t("Jewelry"),filter:function(i){return"ring"===i||"amulet"===i}}};e.getKanaiType=function(i){var s=e.itemById[i];if(s)for(var i in a)if(a[i].filter(s.type))return i};var n={};s.prototype.initHeader=function(){this.header=$('<span class="passive-header readonly"></span>'),this.icon=$('<span class="item-icon"></span>')},s.prototype.initName=function(){this.name=$('<span class="skill-name"></span>'),this.desc.append(this.name,'<span class="skill-separator"></span>'),this.apply=$('<label class="passive-apply">'+t("Include in stats")+"</label>"),this.desc.append(this.apply),this.desc.append(this.params)},s.prototype.updateParams=function(){this.params.empty(),this.paramList=[];var i=this.getInfo();if(i&&i.params){var s=this;$.each(i.params,function(a,n){n=i.params[a];if(!("skill"===s.type&&n.rune&&n.rune.indexOf(s.skill[1])<0)){var o=$('<span class="param-value"></span>').text(n.val+(n.percent?"%":"")),l=$("<div></div>").slider({value:n.val,min:n.min,max:n.max,step:n.step||1,slide:function(i,t){n.val=t.value,o.text(t.value+(n.percent?"%":"")),e.trigger("updateSkills"),s.onChangeParam&&s.onChangeParam()}}).click(function(i){i.stopPropagation(!0)}),r=(n.max-n.min)/(n.step||1);r<=5?l.css("width",40*r):l.css("width","");var h=$("<li></li>");h.append('<span class="param-name"><b>'+t(n.name)+":</b></span>",o,$('<div class="param-slider"></div>').append(l)),s.paramList.push({param:n,value:o,slider:l,line:h}),s.params.append(h)}})}},s.prototype.getCurInfo=function(i,s){var t=this.getCurInfo_&&this.getCurInfo_(i,s),a=e.options.showElites?1+.01*(s.edmg||0):1;if("function"==typeof i.info){if(t){t=$.extend({},t);for(var n in t)"number"==typeof t[n]&&(t[n]=e.formatNumber(t[n]*a,0,1e4))}}else if(i.info&&t){t=$.extend({},t);for(var n in t)if("string"==typeof t[n]){var o=t[n],l=void 0;"@"!=o[0]&&"%"!=o[0]||(l=o[0],o=o.substring(1)),"number"==typeof(o=e.execString(o,s,i.affixid||this.affix,i.params))?(l||(o*=a),t[n]="%"==l?Math.floor(o)+"%":e.formatNumber(o,0,1e4)):t[n]=o}}return t},s.prototype.update=function(){var i=this.getInfo();if(!i)return this.apply.hide(),void(this.info&&(this.info.remove(),this.info=void 0));var s=e.getStats(),a=!1;this.updateBox&&!0===this.updateBox(i,s)&&(a=!0),this.apply[0].lastChild.nodeValue=t(i.activetip)||t("Include in stats");var n=!1,o=this;$.each(this.paramList,function(e,t){var l={min:t.param.min,max:t.param.max,val:t.param.val};t.value.text(l.val+(t.param.percent?"%":"")),t.slider.slider({value:l.val,min:l.min,max:l.max});var r=(l.max-l.min)/(t.param.step||1);r<=5?t.slider.css("width",40*r):t.slider.css("width","");var h=l.min!==l.max&&(!1!==i.active||!1===t.param.buffs)&&!a;n=n||h,h&&t.param.show&&(h="skill"===o.type?t.param.show.call(i,o.skill[1],s):t.param.show.call(i,s)),t.line.toggle(!!h)}),this.params.toggle(n);var l;if(l=this.getCurInfo(i,s)){var r=e.skill_processInfo(l,{affix:i.affixid||this.affix,params:i.params,skill:this.skill});this.skillData=r,this.info||(this.info=$("<ul></ul>").addClass("skill-info"),"skill"===this.type&&this.skill?this.line.append(this.info):this.desc.append(this.info),this.info.click(function(){return!1})),this.info.empty(),$.each(r,function(i,s){var a=$("<span><b>"+t(i)+":</b> "+s.text+"</span>");s.tip&&a.mouseover(function(){return e.tooltip.showHtml(this,s.tip),!1}).mouseleave(function(){e.tooltip.hide()}),o.info.append($("<li></li>").append(a))})}else this.info&&(this.info.remove(),delete this.info,delete this.skillData)},e.SkillBox={},e.SkillBox.skill=i(s,{constructor:function(i,s){this.type="skill",this.index=s,this.level=[1,2,4,9,14,19][s],this.uber(i)},initHeader:function(){void 0!==this.index&&this.line.append('<span class="skill-key skill-key-'+this.index+'"></span>'),this.header=$('<span class="skill-header"></span>'),this.icon=$('<span class="skill-icon"></span>'),this.icon.append('<span class="skill-frame"></span>')},initName:function(){this.apply=$('<label class="skill-bonus">'+t("Include in stats")+"</label>"),this.header.after(this.apply),this.line.append(this.params)},init:function(){this.setSkill();var i=this;this.header.mouseover(function(){if(i.skill&&e.skills[e.charClass][i.skill[0]])e.tooltip.showSkill(this,e.charClass,i.skill[0],i.skill[1]);else{var s=i.getInfo();s&&e.tooltip.showAttack(this,s)}}),this.applybox.change(function(){var s=i.skill&&e.skills[e.charClass][i.skill[0]];s&&(s.active=this.checked,e.trigger("updateSkills"))})},getInfo:function(){if(!this.skill&&void 0!==this.index&&this.index<=1){var i=e.itemSlots.mainhand.item;return i=i&&e.itemById[i.id]&&e.itemById[i.id].type,i=i&&e.itemTypes[i].attack||"hand",e.skills.attack[i]}return this.skill&&e.skills[e.charClass][this.skill[0]]},setSkill:function(i){this.skill=i,this.desc.empty();var s=this.getInfo();this.info&&this.line.append(this.info),s?(this.icon.removeClass("empty"),void 0!==s.row?(this.icon.removeClass("skill-icon-attack"),this.icon.css("background-position",42*-s.col+"px "+84*-s.row+"px")):(this.icon.addClass("skill-icon-attack").addClass(s.id),this.icon.css("background-position","")),this.desc.append('<span class="skill-name">'+s.name+"</span>"),this.desc.append('<span class="skill-separator"></span>'),i?this.desc.append('<span class="skill-rune"><span class="skill-rune-'+i[1]+'"></span> '+("x"===i[1]?t("No Rune"):s.runes[i[1]])+"</span>"):this.desc.append(this.info)):(this.icon.addClass("empty"),this.icon.removeClass("skill-icon-attack"),this.desc.append('<span class="skill-none">'+t("Choose Skill")+"</span>"),this.desc.append('<span class="skill-separator"></span>')),this.updateParams()},_set:function(i){this.setSkill(i)},updateBox:function(i,s){this.applybox.prop("checked",!1!==i.active),this.apply.toggle(!!(i.activeshow?i.activeshow(this.skill[1],s):e.getSkillBonus(this.skill,s)))},getCurInfo_:function(i,s){if("function"==typeof i.info)return i.info(this.skill[1],s);if(i.info&&this.skill){var e=i.info[this.skill[1]];return i.info["*"]&&(e=$.extend({},i.info["*"],e)),e}return i.info?i.info:void 0}}),e.SkillBox.passive=i(s,{constructor:function(i,s){this.type="passive",this.index=s,s>=0?this.level=[10,20,30,70][s]:this.readonly=!0,this.uber(i)},initHeader:function(){this.header=$('<span class="passive-header"></span>'),this.icon=$('<span class="passive-icon"></span>'),this.icon.append('<span class="passive-frame"></span>')},init:function(){this.setPassive();var i=this;this.header.mouseover(function(){i.passive&&e.passives[e.charClass][i.passive]&&e.tooltip.showSkill(this,e.charClass,i.passive)}),this.applybox.click(function(s){var t=i.passive&&e.passives[e.charClass][i.passive];t&&(t.active=this.checked,e.trigger("updateSkills")),s.stopPropagation()})},getInfo:function(){return this.passive&&e.passives[e.charClass][this.passive]},setPassive:function(i){this.passive=i;var s=i&&e.passives[e.charClass][i];s?(this.applybox.prop("checked",!1!==s.active),this.icon.removeClass("empty"),this.icon.css("background-position",42*-s.index+"px 0"),this.name.removeClass().addClass("skill-name").text(s.name)):(this.icon.addClass("empty"),this.name.removeClass().addClass("skill-none").text(t("Choose Skill"))),this.updateParams()},_set:function(i){this.setPassive(i)},updateBox:function(i,s){var t=e.getPassiveBonus(this.passive,s);this.apply.toggleClass("always",void 0===i.active),this.applybox.prop("disabled",void 0===i.active),this.applybox.prop("checked",!1!==i.active),this.apply.toggle(!!t)},getCurInfo_:function(i,s){return"function"==typeof i.info?i.info(s):i.info}}),e.SkillBox.gem=i(s,{constructor:function(i,s){this.type="gem",this.gem=s,this.readonly=!0,this.uber(i)},getInfo:function(){return this.gem&&e.legendaryGems[this.gem]},init:function(){var i=e.legendaryGems[this.gem];this.applybox.prop("disabled",!!i.always),this.apply.toggleClass("always",!!i.always),this.apply.toggle(i.always||void 0!==i.active),this.icon.css("background-image","url("+e.getItemIcon(this.gem)+")");var s=this;this.header.mouseover(function(){s.gem&&e.tooltip.showGem(this,s.gem,e.getStats().gems[s.gem])}),this.applybox.click(function(i){var t=s.gem&&e.legendaryGems[s.gem];t&&(t.active=this.checked,e.trigger("updateSkills")),i.stopPropagation()})},updateBox:function(i,s){var e=!1;if(i.check&&"function"==typeof i.buffs){var a=i.buffs(s.gems[this.gem]||0,s);this.apply.toggle(!!a),a||(e=!0)}else{var n=!!i.effects[0].stat;s.gems[this.gem]&&s.gems[this.gem]>=25&&(n=n||!!i.effects[1].stat),this.apply.toggle(n)}return this.applybox.prop("checked",!(!i.always&&!i.active)),this.name.html(i.name+(s.gems[this.gem]?' <span class="gem-rank">&#x2013; '+t("Rank {0}").format(s.gems[this.gem])+"</span>":"")),e},getCurInfo_:function(i,s){return"function"==typeof i.info?i.info(s.gems[this.gem],s):i.info}}),e.SkillBox.affix=i(s,{constructor:function(i,s){this.type="affix",this.affix=s,this.readonly=!0,this.uber(i)},init:function(){var i=e.itemaffixes[this.affix];this.apply.toggle(void 0!==i.active);var s=this;if(this.header.mouseover(function(){var i=e.getStats();i.affixes[s.affix]&&e.tooltip.showItem(this,i.affixes[s.affix].slot)}),this.applybox.click(function(i){var t=s.affix&&e.itemaffixes[s.affix];t&&(t.active=this.checked,e.trigger("updateSkills")),i.stopPropagation()}),i.boxnames){this.boxes=[],this.boxlabels=[];for(var a=0;a<i.boxnames.length;++a){var n=$('<input type="checkbox"></input>'),o=$('<label class="passive-apply">'+t(i.boxnames[a])+"</label>").prepend(n);this.boxes.push(n),this.boxlabels.push(o),this.params.before(o),o.toggle(!1!==i.active),n.click(function(s){return function(){i.boxvals[s]=$(this).prop("checked"),e.trigger("updateSkills")}}(a))}}},getInfo:function(){return this.affix&&e.itemaffixes[this.affix]},updateBox:function(i,s){this.applybox.prop("checked",!0===i.active);var a=e.getSlotId(s.affixes[this.affix].slot),n=e.itemById[a];if(n&&this.icon.css("background-image","url("+e.getItemIcon(n.id)+")"),s.affixes[this.affix].set){var o=e.itemSets[s.affixes[this.affix].set].name;s.affixes[this.affix].pieces&&(o+=' <span class="gem-rank">&#x2013; '+t("{0} pieces").format(s.affixes[this.affix].pieces)+"</span>"),this.name.html(o)}else n&&this.name.text(n.name);if(this.boxlabels)for(var l=0;l<this.boxlabels.length;++l)this.boxlabels[l].toggle(!1!==i.active)},getCurInfo_:function(i,s){return"function"==typeof i.info?i.info(s.affixes[this.affix].value,s):i.info}}),e.SkillBox.kanai=i(s,{constructor:function(i,s){this.type="kanai",this.kanai=s,this.readonly=!0,this.uber(i)},init:function(){var i=this;this.onInner=!1,this.namebox=$('<select class="skill-namelist empty"></select>'),this.fillnames(),this.desc.addClass("chosen-noframe"),this.name.replaceWith(this.namebox),this.namebox.chosen({disable_search_threshold:10,inherit_select_classes:!0,allow_single_deselect:!0,search_contains:!0,placeholder_text_single:t("Choose {0}").format(a[this.kanai].name),populate_func:function(){i.fillnames()}}).change().change(function(){i.onChangeItem(),e.trigger("updateSkills")}),e.chosenTips(this.namebox,function(s){if(e.itemById[s]){i.onInner=!0;var t=e.itemById[s],a=t.required.custom.args;void 0===a&&(a=1),a=1===a?"min"===t.required.custom.best?[t.required.custom.min||1]:[t.required.custom.max||1]:void 0,e.tooltip.showItem(this,s,a)}}),e.chosen_addIcons(this.namebox,function(i){var s=e.itemById[i];if(s){var t=e.itemIcons,a=t?t[i]:void 0;return void 0!==a?'<span style="background: url(css/items/'+s.type+".png) 0 -"+24*a[0]+'px no-repeat"></span>':void 0}}),e.chosen_fixSearch(this.namebox,function(i,s){var t=e.itemById[i];if(t)return!!s(t.name)||(!!(t.required&&t.required.custom&&s(t.required.custom.format))||void 0)}),this.setItemEffect(),this.header.mouseover(function(){if(i.onInner)return i.onInner=!1,!0;var s=i.namebox.val();if(e.itemById[s]){var t=e.itemById[s],a=t.required.custom.args;void 0===a&&(a=1),a=1===a?"min"===t.required.custom.best?[t.required.custom.min||1]:[t.required.custom.max||1]:void 0,e.tooltip.showItem(this,s,a)}}),this.applybox.click(function(s){var t=i.getInfo();t&&(t.active=this.checked,e.trigger("updateSkills")),s.stopPropagation()})},fillnames:function(){var i=this,s=this.namebox.val();this.namebox.empty(),this.namebox.append('<option value="">'+(e.noChosen?t("Choose {0}").format(a[this.kanai].name):"")+"</option>");var n={};$.each(e.items,function(s,o){if(o.required&&o.required.custom&&!1!==o.required.custom.cube&&(!e.options.hideLegacy||o.suffix!==t("Legacy"))){var l=o.required.custom.id;if(!(o.classes&&o.classes.indexOf(e.charClass)<0)){var r=e.itemTypes[o.type];r.classes&&r.classes.indexOf(e.charClass)<0||e.itemPowerClasses&&e.itemPowerClasses[l]&&e.itemPowerClasses[l]!==e.charClass||a[i.kanai].filter(o.type)&&(o.required.custom.args<0||(n[o.type]||(n[o.type]=[]),n[o.type].push(o)))}}});for(var o in n){var l='<optgroup label="'+e.itemTypes[o].name+'">';n[o].sort(function(i,s){return i.name.localeCompare(s.name)});for(var r=0;r<n[o].length;++r){var h=n[o][r],p="";h.id===s&&(p='" selected="selected'),l+='<option class="item-info-icon quality-'+(h.quality||"rare")+'" value="'+h.id+p+'">'+h.name+(h.suffix?" ("+h.suffix+")":"")+"</option>"}this.namebox.append(l+"</optgroup")}},getInfo:function(){return n[this.namebox.val()]},onChangeItem:function(){if(this.boxlabels){for(r=0;r<this.boxlabels.length;++r)this.boxlabels[r].remove();delete this.boxlabels}var i=this.namebox.val(),s=e.itemById[i],a=this.namebox;if(e.noChosen||(a=a.next()),a.toggleClass("empty",!s),!s)return this.icon.hide(),this.apply.hide(),void this.updateParams();this.icon.css("background-image","url("+e.getItemIcon(i)+")"),this.icon.show();var o=s.required&&s.required.custom;o&&e.itemaffixes[o.id]&&this.apply.toggle(void 0!==e.itemaffixes[o.id].active);var l=n[i];if(l||(l={},o&&e.itemaffixes[o.id]&&((l=e.itemaffixes[o.id]).affixid=o.id),n[i]=l),l.boxnames){this.boxes=[],this.boxlabels=[];for(var r=0;r<l.boxnames.length;++r){var a=$('<input type="checkbox"></input>'),h=$('<label class="passive-apply">'+t(l.boxnames[r])+"</label>").prepend(a);this.boxes.push(a),this.boxlabels.push(h),this.params.before(h),h.toggle(!1!==l.active),a.click(function(i){return function(){l.boxvals[i]=$(this).prop("checked"),e.trigger("updateSkills")}}(r))}}this.updateParams()},setItemEffect:function(i){this.namebox.val(i),this.namebox.trigger("chosen:updated"),this.onChangeItem()},getItemPair:function(){var i=this.namebox.val();if(e.itemById[i])return i},setItemPair:function(i){i instanceof Array?this.setItemEffect(i[0]):this.setItemEffect(i)},getItemAffix:function(){var i=e.itemById[this.namebox.val()];return i&&i.required&&i.required.custom&&i.required.custom.id},getItemAffixValue:function(){var i=e.itemById[this.namebox.val()],s=i.required.custom.args;return void 0===s&&(s=1),1===s?"min"===i.required.custom.best?i.required.custom.min||1:i.required.custom.max||1:1},updateBox:function(i,s){if(this.applybox.prop("checked",!0===i.active),this.shown=!0,i.info||void 0!==i.active||i.params||(this.shown=!1),i.check){this.shown=!1;var e=[this.getItemAffixValue()];"function"==typeof i.info?i.info(e,s)&&(this.shown=!0):i.info&&(this.shown=!0),(void 0!==i.active||i.params)&&("function"==typeof i.buffs?i.buffs(e,s)&&(this.shown=!0):i.buffs&&(this.shown=!0))}if(this.apply.toggle(this.shown&&void 0!==i.active),!this.shown)return this.params.hide(),void(this.info&&(this.info.remove(),delete this.info));if(this.boxlabels)for(var t=0;t<this.boxlabels.length;++t)this.boxlabels[t].toggle(!1!==i.active)},getCurInfo_:function(i,s){return"function"==typeof i.info?i.info(s[i.affixid],s):i.info}}),e.SkillBox.buff=i(s,{constructor:function(i,s){this.type="buff",this.buff=s,this.readonly=!0,this.uber(i)},initHeader:function(){"skill"===this.buff.type||"custom"===this.buff.type?e.SkillBox.skill.prototype.initHeader.call(this):"passive"===this.buff.type?e.SkillBox.passive.prototype.initHeader.call(this):this.uber.prototype.initHeader.call(this)},initName:function(){"skill"===this.buff.type?e.SkillBox.skill.prototype.initName.call(this):this.uber.prototype.initName.call(this)},init:function(){var i=!1,s=this;if("skill"===this.buff.type){o=e.skills[this.buff.charClass][this.buff.id];if(this.icon.removeClass("empty"),this.icon.css("background-position",42*-o.col+"px "+84*-o.row+"px"),this.desc.append('<span class="skill-name">'+o.name+"</span>"),this.desc.append('<span class="skill-separator"></span>'),this.buff.multiple){this.header.removeClass("skill-header").addClass("passive-header"),this.runebox={};for(var a in this.buff.runes)this.runebox[a]=$('<input type="checkbox"></input>').click(function(i){return function(){s.buff.runevals[i]=$(this).prop("checked"),e.trigger("updateSkills")}}(a)),this.desc.append($('<label class="rune-box"></label>').append(this.runebox[a],'<span class="skill-rune"><span class="skill-rune-'+this.buff.runelist+'"></span> '+this.buff.runes[a]+"</span>").mouseover(function(i){return function(){return e.tooltip.showSkill(this,s.buff.charClass,s.buff.id,i,!0),!1}}(a)).mouseleave(function(){e.tooltip.hide()}));this.apply.hide()}else if(this.buff.runelist.length>1||"*"===this.buff.runelist){this.runebox=$('<select class="skill-runelist"></select>');for(var a in this.buff.runes)this.runebox.append('<option class="skill-rune-option rune-'+a+'" value="'+a+'">'+this.buff.runes[a]+"</option>");this.desc.addClass("chosen-noframe"),this.desc.append(this.runebox);var n=void 0;this.runebox.chosen({disable_search:!0,inherit_select_classes:!0}).change(function(){var i=$(this).next().find("span").first();n&&i.removeClass(n),n="rune-"+$(this).val(),i.addClass("skill-rune-option "+n)}).change().change(function(){s.buff.runevals=$(this).val(),e.trigger("updateSkills")}),e.chosenTips(this.runebox,function(t){"*"!=t&&(i=!0,e.tooltip.showSkill(this,s.buff.charClass,s.buff.id,t,!0))})}else this.desc.append('<span class="skill-rune"><span class="skill-rune-'+this.buff.runelist+'"></span> '+this.buff.runes[this.buff.runelist]+"</span>");this.header.mouseover(function(){if(s.buff.multiple)e.tooltip.showSkill(this,s.buff.charClass,s.buff.id);else{if(i)return i=!1,!0;e.tooltip.showSkill(this,s.buff.charClass,s.buff.id,s.runebox?s.runebox.val():s.buff.runelist)}})}else if("passive"===this.buff.type){var o=e.passives[this.buff.charClass][this.buff.id];this.icon.removeClass("empty"),this.icon.css("background-position",42*-o.index+"px 0"),this.name.removeClass().addClass("skill-name").text(o.name),this.header.mouseover(function(){e.tooltip.showSkill(this,s.buff.charClass,s.buff.id)})}else if("affix"===this.buff.type){var l=e.itemById[this.buff.item];l&&(this.icon.css("background-image","url("+e.getItemIcon(l.id)+")"),this.name.text(l.name),this.header.mouseover(function(){var i=void 0;s.buff.params&&(i=[s.buff.params[0].val]),e.tooltip.showItem(this,l.id,i)}))}else"gem"===this.buff.type?(this.icon.css("background-image","url("+e.getItemIcon(this.buff.id)+")"),this.name.text(e.legendaryGems[this.buff.id].name),this.header.mouseover(function(){e.tooltip.showGem(this,s.buff.id,25)})):"custom"===this.buff.type&&(this.icon.removeClass("empty"),this.icon.css("background-position",42*-this.buff.icon+"px 0"),this.name.removeClass().addClass("skill-name").text(this.buff.name),this.header.mouseover(function(){e.tooltip.showCustomSkill(this,s.buff)}));if(this.applybox.prop("checked",this.buff.active),this.applybox.change(function(){if(s.buff.active=this.checked,s.boxlabels)for(var i=0;i<s.boxlabels.length;++i)s.boxlabels[i].toggle(this.checked);s.buff.params&&s.params.toggle(this.checked),e.trigger("updateSkills")}),this.buff.boxnames){this.boxes=[],this.boxlabels=[];for(var r=0;r<this.buff.boxnames.length;++r){var h=$('<input type="checkbox"></input>'),p=$('<label class="'+("skill"===this.buff.type?"skill-bonus":"passive-apply")+'">'+t(this.buff.boxnames[r])+"</label>").prepend(h);this.boxes.push(h),this.boxlabels.push(p),this.params.before(p),p.toggle(!1!==this.buff.active||this.buff.multiple),h.click(function(i){return function(){s.buff.boxvals[i]=$(this).prop("checked"),e.trigger("updateSkills")}}(r))}}this.updateBoxes()},updateBoxes:function(){if(this.apply.toggle(!this.buff.multiple&&void 0!==this.buff.active),this.buff.multiple)for(var i in this.runebox)this.runebox[i].prop("checked",!!this.buff.runevals[i]);else this.applybox.prop("checked",!!this.buff.active),this.runebox&&this.runebox.val(this.buff.runevals).trigger("chosen:updated");if(this.boxlabels)for(s=0;s<this.boxlabels.length;++s)this.boxlabels[s].toggle(!1!==this.buff.active||!!this.buff.multiple);if(this.boxes)for(var s=0;s<this.boxes.length;++s)this.boxes[s].prop("checked",!(!this.buff.boxvals||!this.buff.boxvals[s]));this.buff.params&&this.params.toggle(!1!==this.buff.active||!!this.buff.multiple),this.updateParams()},getInfo:function(){return this.buff},onChangeParam:function(){this.buff&&"affix"===this.buff.type&&e.tooltip.getNode()===this.header[0]&&e.tooltip.showItem(this.header[0],this.buff.item,[this.buff.params[0].val])}})}();