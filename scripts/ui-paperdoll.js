!function(){function a(a,l){if("custom"==l.id||"customwpn"==l.id){var s="offhand"===a?DiabloCalc.getOffhandTypes():DiabloCalc.itemSlots[a].types;for(var e in s)if(!(s[e].classes&&s[e].classes.indexOf(DiabloCalc.charClass)<0)&&("customwpn"===l.id||!DiabloCalc.itemTypes[e].weapon)&&("customwpn"!==l.id||DiabloCalc.itemTypes[e].weapon))return DiabloCalc.getItemIcon(DiabloCalc.itemTypes[e].generic)}return DiabloCalc.getItemIcon(l.id)}function l(){for(var a=$(".char-class").val(),l=DiabloCalc.getSkills(),s=0;s<6;++s){var e=l.skills[s];if(e){i=DiabloCalc.skills[a][e[0]];c[s].removeClass("empty"),c[s].css("background-position",-42*i.col+"px "+-84*i.row+"px")}else c[s].addClass("empty")}for(s=0;s<4;++s){var o=l.passives[s];if(o){var i=DiabloCalc.passives[a][o];n[s].removeClass("empty"),n[s].css("background-position",-42*i.index+"px 0")}else n[s].addClass("empty")}for(var t in d)l.kanai[t]?(d[t].removeClass("empty"),d[t].find(".icon").css("background-image","url("+DiabloCalc.getItemIcon(l.kanai[t])+")")):d[t].addClass("empty")}function s(a){a.removeClass("empty-slot disabled-offhand");for(var l in DiabloCalc.qualities)a.removeClass("quality-"+l);return a}function e(l){$(".char-class").val();var o=DiabloCalc.itemSlots[l],i=DiabloCalc.getSlot(l);if(o.flourish&&o.flourish.removeClass(),!i||!DiabloCalc.itemById[i.id])return s(o.dollFrame).addClass("doll-slot").addClass("slot-"+l).addClass("empty-slot"),o.dollImage.hide(),o.dollSockets&&o.dollSockets.empty(),void(i||"offhand"!=l||(i=DiabloCalc.getSlot("mainhand"))&&DiabloCalc.itemById[i.id]&&"twohand"==DiabloCalc.itemTypes[DiabloCalc.itemById[i.id].type].slot&&(o.dollFrame.addClass("disabled-offhand"),o.dollImage.attr("src",a("mainhand",i)).show()));var t=DiabloCalc.itemById[i.id];if(s(o.dollFrame).addClass("doll-slot").addClass("slot-"+l).addClass("quality-"+t.quality),o.dollImage.attr("src",a(l,i)).show(),o.dollImage.toggleClass("ancient",!!i.ancient),o.flourish){var c=null;for(var n in i.stats)if(DiabloCalc.stats[n].elemental){c=DiabloCalc.stats[n].elemental;break}c&&o.flourish.addClass("weapon-flourish").addClass(l+"-flourish").addClass("elemental-"+c)}if(o.dollSockets){o.dollSockets.empty();for(var d=i.stats.sockets&&i.stats.sockets[0]||0,r=0;r<d;++r){var p=$("<span></span>").addClass("socket");if(i.gems&&r<i.gems.length){var C;DiabloCalc.legendaryGems[i.gems[r][0]]?C=DiabloCalc.getItemIcon(i.gems[r][0],"small"):DiabloCalc.gemQualities[i.gems[r][0]]&&(C=DiabloCalc.getItemIcon(i.gems[r],"small")),C&&p.append($("<img></img>").attr("src",C))}o.dollSockets.append(p).append($("<br></br>"))}}"mainhand"==l&&"twohand"==DiabloCalc.itemTypes[t.type].slot&&e("offhand")}function o(){var a=$(".char-class").val();$(".paperdoll-background").parent().removeClass().addClass("paperdoll-container").addClass("class-"+a).addClass(DiabloCalc.gender||"female"),$(".paperdoll-background").removeClass().addClass("paperdoll-background").addClass(DiabloCalc.classes[a].follower?"class-follower":"class-character"),i.toggleClass("selected","male"===DiabloCalc.gender),t.toggleClass("selected","male"!==DiabloCalc.gender)}var i,t,c=[],n=[],d={};DiabloCalc.getDollSkill=function(a){return c[a]},DiabloCalc.getDollPassive=function(a){return n[a]};var r=$(".paperdoll-background");DiabloCalc.itemSlots.mainhand.flourish=$('<span class="weapon-flourish mainhand-flourish"></span>'),DiabloCalc.itemSlots.offhand.flourish=$('<span class="weapon-flourish offhand-flourish"></span>'),r.append(DiabloCalc.itemSlots.mainhand.flourish).append(DiabloCalc.itemSlots.offhand.flourish);for(var p in DiabloCalc.itemSlots){var C=DiabloCalc.itemSlots[p];if(C.dollFrame=$("<div></div>").addClass("doll-slot").addClass("slot-"+p).addClass("empty-slot").append('<span class="item-gradient"><span class="item-glow"></span></span>'),C.dollImage=$("<img></img>").hide(),C.dollFrame.append(C.dollImage),C.sockets){var m=$("<span></span>").addClass("sockets-wrapper");C.dollSockets=$("<span></span>").addClass("sockets-align"),C.dollFrame.append(m.append(C.dollSockets))}!function(a){C.dollFrame.hover(function(){DiabloCalc.tooltip&&DiabloCalc.tooltip.showItem(this,a)},function(){DiabloCalc.tooltip&&DiabloCalc.tooltip.hide()})}(p),r.append(C.dollFrame)}for(var b=$("<div></div>").addClass("paperdoll-skills"),f=$("<div></div>").addClass("paperdoll-skills"),D=0;D<6;++D){(g=$("<span></span>").addClass("skill-icon").addClass("empty")).append('<span class="skill-frame"></span>'),g.css("left",14+(D<2?218+52*D:52*(D-2))),g.append('<span class="skill-text">'+[1,2,4,9,14,19][D]+"</span>"),function(a){g.hover(function(){if(DiabloCalc.getSkill&&DiabloCalc.tooltip){var l=DiabloCalc.getSkill(a);l&&DiabloCalc.tooltip.showSkill(this,$(".char-class").val(),l[0],l[1])}},function(){DiabloCalc.tooltip&&DiabloCalc.tooltip.hide()}),g.click(function(){var l=DiabloCalc.getSkill(a);if(l&&DiabloCalc.d3gl&&DiabloCalc.d3gl.character&&DiabloCalc.d3gl.enabled()){DiabloCalc.tooltip.hide();var s=DiabloCalc.webglSkills&&l&&DiabloCalc.webglSkills[l[0]];s&&"object"==typeof s&&"x"in s&&(s=s[l[1]]),s&&DiabloCalc.d3gl.character.animate(s)}else DiabloCalc.trigger("editSkill",a)})}(D),b.append(g),c.push(g)}for(D=0;D<4;++D){var g=$("<span></span>").addClass("passive-icon").addClass("empty");g.append('<span class="passive-frame fancy"></span>'),g.css("left",50+66*D),g.append('<span class="skill-text">'+[10,20,30,70][D]+"</span>"),function(a){g.hover(function(){if(DiabloCalc.getPassive&&DiabloCalc.tooltip){var l=DiabloCalc.getPassive(a);l&&DiabloCalc.tooltip.showSkill(this,$(".char-class").val(),l)}},function(){DiabloCalc.tooltip&&DiabloCalc.tooltip.hide()}),g.click(function(){DiabloCalc.trigger("editPassive",a)})}(D),f.append(g),n.push(g)}r.parent().append(b).append(f);var u=$("<div></div>").addClass("paperdoll-cube");d.weapon=$('<span class="cube-item weapon empty"><span class="icon"></span></span>'),d.armor=$('<span class="cube-item armor empty"><span class="icon"></span></span>'),d.jewelry=$('<span class="cube-item jewelry empty"><span class="icon"></span></span>'),u.append(d.weapon,d.armor,d.jewelry),r.parent().append(u),$.each(d,function(a,l){l.hover(function(){if(DiabloCalc.getSkills){var l=DiabloCalc.getSkills();l.kanai[a]&&DiabloCalc.tooltip.showItem(this,l.kanai[a])}},function(){DiabloCalc.tooltip.hide()}),l.click(function(){DiabloCalc.trigger("editKanai",a)})}),i=$('<span class="d3gl-button-male"></span>').click(function(){DiabloCalc.gender="male",i.addClass("selected"),t.removeClass("selected"),DiabloCalc.updateClassIcon&&DiabloCalc.updateClassIcon(),DiabloCalc.trigger("changeGender")}),t=$('<span class="d3gl-button-female selected"></span>').click(function(){DiabloCalc.gender="female",i.removeClass("selected"),t.addClass("selected"),DiabloCalc.updateClassIcon&&DiabloCalc.updateClassIcon(),DiabloCalc.trigger("changeGender")}),$(".paperdoll-container").append(i,t),DiabloCalc.register("changeClass",o),DiabloCalc.register("changeGender",function(){o();for(var a in DiabloCalc.itemSlots)e(a)}),o(),DiabloCalc.register("updateSlotStats",function(a){DiabloCalc.tooltip&&DiabloCalc.tooltip.getNode()==DiabloCalc.itemSlots[a].dollFrame[0]&&DiabloCalc.tooltip.showItem(DiabloCalc.itemSlots[a].dollFrame[0],a)}),DiabloCalc.register("updateSlotItem",e),DiabloCalc.register("updateSkills",l),DiabloCalc.register("importEnd",function(){for(var a in DiabloCalc.itemSlots)e(a);l()})}();