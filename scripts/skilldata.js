!function(){function e(e,a,t,s){return e?"string"!=typeof e?e:(t?e=e.replace(/\$([1-9])/g,function(e,s){return a.affixes[t]?a.affixes[t].value[parseInt(s)-1]:1===parseInt(s)?a[t]:void 0}):s&&(e=e.replace(/\$([1-9])/g,function(e,a){return s[parseInt(a)-1].val})),a.execString(e)):0}function a(e,a){function t(e){return i(e,o,a.affix,a.params)}var s,n,o=(a=a||{}).stats||r.getStats();if(e.thorns)s={min:n=o.thorns||0,max:n};else if(e.weapon){if(!o.info[e.weapon])return;n=.5*((s=$.extend({},o.info[e.weapon].wpnbase)).min+s.max)}else n=.5*((s=$.extend({},o.info.mainhand.wpnbase)).min+s.max),o.info.offhand&&(s.min=Math.min(s.min,o.info.offhand.wpnbase.min),s.max=Math.max(s.max,o.info.offhand.wpnbase.max),n=.5*n+.25*(o.info.offhand.wpnbase.min+o.info.offhand.wpnbase.max));var f=1,d=0,l=[];if(l.push({name:r.stats[r.classes[r.charClass].primary].name,percent:("bad"===e.thorns?.25:1)*o.info.primary}),e.aps&&l.push({name:"Attack speed",factor:(e.weapon?o.info[e.weapon].speed:o.info.aps)*(!0===e.aps?1:t(e.aps))}),e.coeff||e.addcoeff){var p=e.coeff?t(e.coeff):0,c=p,h=void 0;if(f=p,e.addcoeff){h=[];for(P=0;P<e.addcoeff.length;++P){var m,u=e.addcoeff[P];"object"==typeof u?((u=[t(u[0]),t(u[1])])[0]&&u[1]&&h.push([100*u[0],u[1]]),m=u[0]*u[1]):((u=t(u))&&h.push(100*u),m=u),"number"!=typeof e.total||P<e.total?f+=m:d+=m,p+=m}}l.push({name:"Skill multiplier",factor:p,percent:100*c,extra:h,coeff:!0})}if(e.factors)for(var v in e.factors){1!=(E=t(e.factors[v]))&&l.push({name:v,factor:E})}if(e.divide)for(var v in e.divide){1!=(E=t(e.divide[v]))&&l.push({name:v,factor:1/E,divide:E})}if(e.percent)for(var v in e.percent){(E=t(e.percent[v]))&&l.push({name:v,percent:E})}if(e.passives)for(var b in e.passives)if(o.passives[b]){(E=t(e.passives[b]))&&l.push({name:r.passives[r.charClass][b].name,percent:E})}var w={},g=e.skill||a.skill&&a.skill[0];if(g&&"special"!==e.thorns&&!e.manald){var x=o["skill_"+r.charClass+"_"+g];x&&(w["Skill %"]=x)}if(e.bonuses)for(var _ in e.bonuses){(E=t(e.bonuses[_]))&&(w[_]=E)}if(e.addpassives)for(var b in e.addpassives)if(o.passives[b]){(E=t(e.addpassives[b]))&&(w[r.passives[r.charClass][b].name]=E)}e.pet&&!$.isEmptyObject(w)&&(l.push({name:"Skill damage",percent:w}),w={});var y="max"==e.elem?o.info.maxelem:e.elem,k=("max"==e.srcelem?o.info.maxelem:e.srcelem)||y,M=o.getTotalSpecial("damage",y,e.pet,g,e.exclude);M&&(w.Buffs=M);if((M=o.getTotalSpecial("dmgtaken",y,e.pet,g,e.exclude))&&"normal"!==e.thorns&&"bad"!==e.thorns&&"special"!==e.thorns&&(w.Debuffs=M),$.isEmptyObject(w)||l.push({name:e.pet?"Buffs/debuffs":"Damage increased by skills",percent:w}),!M||"normal"!==e.thorns&&"bad"!==e.thorns&&"special"!==e.thorns||l.push({name:r.stats.dmgtaken.name,percent:M}),"normal"!==e.thorns&&"bad"!==e.thorns||!o.thorns_taken||l.push({name:r.itemById.Unique_Shield_104_x1.name,percent:o.thorns_taken}),(k&&o["dmg"+k]||e.pet&&o.petdamage)&&!e.manald){w={};k&&o["dmg"+k]&&(w[r.elements[k]]=o["dmg"+k]),e.pet&&o.petdamage&&(w.Pets=o.petdamage),l.push({name:"Elemental damage",percent:w})}if(r.options.showElites&&o.edmg){var S=o.edmg;e.manald&&(S-=o.leg_thefurnace||0,o.gem_powerful_25&&(S-=15)),S&&l.push({name:r.stats.edmg.name,percent:S})}r.options.targetBoss&&r.options.showElites&&o.bossdmg&&l.push({name:r.stats.bossdmg.name,percent:o.bossdmg});var F=r.options.targetType;F&&o["damage_"+F]&&l.push({name:r.stats["damage_"+F].name,percent:o["damage_"+F]}),$.each(o.getSpecial("dmgmul",y,e.pet,g,e.exclude),function(e,a){l.push({name:a[0],percent:a[1]})});for(var A=1,P=0;P<l.length;++P){if(!l[P].factor){var N=0;if("number"==typeof l[P].percent)N=l[P].percent;else for(var C in l[P].percent)N+=l[P].percent[C];l[P].factor=1+.01*N}A*=l[P].factor}var j=t(e.chc),D=t(e.chd),B=Math.min(1,.01*(o.final.chc+j*(1+.01*(o.chctaken_percent||0)))),I=.01*(o.chd+D);e.thorns&&(B=I=j=0);var E=n*A*(1+B*I);return{factors:l,total_factor:A*f/(f+d),extra_factor:A*d/(f+d),value:E,base:s,chc:B,chd:I,bonus_chc:j}}function t(e,a){this.header_="",this.body_="",e&&this.header(e,a)}function s(e,a,t,s){var n=(""+parseFloat(e.toFixed(a||0))).split(".");return Math.abs(parseFloat(e))>=1e4&&(n[0]=n[0].replace(/\B(?=(\d{3})+(?!\d))/g,",")),e=n.join("."),s&&s.indexOf("+")>=0&&(e>0&&(e="+"+e),s=s.replace("+","")),'<span class="d3-color-'+(t||"green")+'">'+e+(s||"")+"</span>"}function n(e,a,t){return e=Math.floor(e),a=Math.floor(a),s(e,0,t)+(e==a?"":"-"+s(a,0,t))}var r=DiabloCalc,o=r.locale("ui-skills.js","skilldata");r.getSkillBonus=function(e,a,t){if(e){t=t||"buffs";var s=r.skills[r.charClass][e[0]],n=null;return s&&s[t]&&(n="function"==typeof s[t]?s[t](e[1],a):s[t][e[1]]),n}},r.getPassiveBonus=function(e,a){var t=r.passives[r.charClass][e],s=null;return t&&t.buffs&&(s="function"==typeof t.buffs?t.buffs(a):t.buffs),s},r.execString=e;var i=e;r.calcFramesFull=function(e,a,t,s,n,o){!0!==t&&!1!==t&&(n=s,s=t,t=void 0);var i="up"===n?1:0,o=o||r.getStats(),f={fpa:e,dspeed:s||1,fpadelta:i};return!a&&o.info.offhand?t?(f.basespeed=Math.min(o.info.mainhand.speed,o.info.offhand.speed),f.frames=Math.floor(e/(f.dspeed*f.basespeed))+i):(f.framesmh=Math.floor(e/(f.dspeed*o.info.mainhand.speed))+i,f.framesoh=Math.floor(e/(f.dspeed*o.info.offhand.speed))+i,f.frames=.5*(f.framesmh+f.framesoh)):(f.basespeed=o.info[a||"mainhand"].speed,f.frames=Math.floor(e/(f.dspeed*f.basespeed))+i),f},r.calcFrames=function(e,a,t,s,n,o){return r.calcFramesFull.apply(r,arguments).frames},t.prototype.html=function(){return'<div xmlns="http://www.w3.org/1999/xhtml" class="profile-tooltip"><p>'+this.header_+this.body_+"</p></div>"},t.prototype.empty=function(){return 0==this.body_.length},t.prototype.header=function(e,a){return e=o(e),void 0!==a&&(e+=': <span class="d3-color-green">'+a+"</span>"),this.header_='<span class="d3-color-gold">'+e+"</span>",this},t.prototype.line=function(e,a){var t=2,s=a;return!0!==e&&!1!==e&&(s=e,e=!0,t=1),this.body_+='<br/><span class="tooltip-icon-'+(!1===e?"nobullet":"bullet")+'"></span>'+String.prototype.format.apply(o(s),Array.prototype.slice.call(arguments,t)),this},t.prototype.add=function(e){if(!e)return this;if("string"==typeof e){var a=!0;"@"===e[0]&&(e=e.substring(1),a=!1),this.line(a,e)}else if(e instanceof Array)for(var s=0;s<e.length;++s)this.add(e[s]);else e instanceof t&&(this.body_+=e.body_);return this},t.prototype.breakpoints=function(e,a){function t(e,t){var s;return(s=a.framesmh&&a.framesoh?.5*(Math.floor(a.fpa/(a.dspeed*e))+Math.floor(a.fpa/(a.dspeed*t)))+a.fpadelta:Math.floor(a.fpa/(a.dspeed*e))+a.fpadelta)<a.frames?'<span class="d3-color-green">+'+r.formatNumber(100*(a.frames/s-1),1)+"%</span>":s>a.frames?'<span class="d3-color-red">-'+r.formatNumber(100*(1-a.frames/s),1)+"%</span>":'<span class="d3-color-gray">+0%</span>'}function s(e){var a=e[0]===b||e[0]===w?' class="current"':"";return"<td"+a+">"+e[0]+"</td><td"+a+">"+e[1]+"</td>"}if(a.pet){if(a.frames>6){var n=e.info.mainhand.speed/(1+.01*(e.ias||0)),i=a.fpa/(a.frames-5)/a.speed,f=Math.ceil(10*(100*i/n-100-(e.ias||0)))/10;this.line(!1,"IAS to next breakpoint: {0}",'<span class="d3-color-white">'+f+"%</span>")}this.body_+="</p><table><tr><th>"+["FPA","APS","Pet APS","Delta"].map(o).join("</th><th>")+"</th></tr>";for(_=6*Math.ceil(Math.floor(a.fpa)/6);_>=6;_-=6){y=Math.max(1,a.fpa/(_+1)/a.speed+51e-6);if(a.speed/(_+1)>5)break;this.body_+="<tr"+(_===a.frames?' class="current"':"")+"><td>"+_+"</td>",this.body_+="<td>"+y.toFixed(4)+"</td><td>"+Math.max(1,a.fpa/(_+1)+51e-6).toFixed(4)+"</td>";var d=100*(a.frames/_-1);this.body_+='<td class="'+(d<0?"d3-color-red":d>0?"d3-color-green":"d3-color-gray")+'">',this.body_+=(d<0?d.toFixed(1):"+"+d.toFixed(1))+"%</td></tr>"}this.body_+="</table><p>"}else{if(a.framesmh&&a.framesoh){if(a.framesmh>1&&a.framesoh>1){var l=a.fpa/(a.framesmh-a.fpadelta)/a.dspeed+51e-6,p=a.fpa/(a.framesoh-a.fpadelta)/a.dspeed+51e-6;l=(m=Math.min(l/e.info.mainhand.speed,p/e.info.offhand.speed))*e.info.mainhand.speed,p=m*e.info.offhand.speed;f=Math.ceil(10*(m*(100+(e.ias||0))-100-(e.ias||0)))/10;this.line(!1,"Next breakpoint: {0} APS ({1} IAS)"+(!1!==a.dps?", {2} DPS":""),'<span class="d3-color-white">'+r.formatNumber(l,4,1e4)+'</span>/<span class="d3-color-white">'+r.formatNumber(p,4,1e4)+"</span>",'<span class="d3-color-white">+'+f+"%</span>",t(l,p))}var c=a.fpa/(a.framesmh+1-a.fpadelta)/a.dspeed-51e-6,h=a.fpa/(a.framesoh+1-a.fpadelta)/a.dspeed-51e-6;c=(u=Math.max(c/e.info.mainhand.speed,h/e.info.offhand.speed))*e.info.mainhand.speed,h=u*e.info.offhand.speed;f=Math.ceil(10*(u*(100+(e.ias||0))-100-(e.ias||0)))/10;this.line(!1,"Previous breakpoint: {0} APS ({1} IAS)"+(!1!==a.dps?", {2} DPS":""),'<span class="d3-color-white">'+r.formatNumber(c,4,1e4)+'</span>/<span class="d3-color-white">'+r.formatNumber(h,4,1e4)+"</span>",'<span class="d3-color-white">'+f+"%</span>",t(c,h))}else{if(a.frames>1){var m=a.fpa/(a.frames-a.fpadelta)/a.dspeed+51e-6,n=a.basespeed/(1+.01*(e.ias||0)),f=Math.ceil(10*(100*m/n-100-(e.ias||0)))/10;this.line(!1,"Next breakpoint: {0} APS ({1} IAS)"+(!1!==a.dps?", {2} DPS":""),'<span class="d3-color-white">'+r.formatNumber(m,4,1e4)+"</span>",'<span class="d3-color-white">+'+f+"%</span>",t(m))}var u=a.fpa/(a.frames+1-a.fpadelta)/a.dspeed-51e-6,n=a.basespeed/(1+.01*(e.ias||0)),f=Math.ceil(10*(100*u/n-100-(e.ias||0)))/10;this.line(!1,"Previous breakpoint: {0} APS ({1} IAS)"+(!1!==a.dps?", {2} DPS":""),'<span class="d3-color-white">'+r.formatNumber(u,4,1e4)+"</span>",'<span class="d3-color-white">'+f+"%</span>",t(u))}if(!a.sequence){var v="<th>"+o("FPA")+"</th><th>"+o("APS")+"</th>";this.body_+='</p><table class="col2"><tr>'+v+"<th></th>"+v+"<th></th>"+v+"</tr>";var b=a.frames,w=a.frames;a.framesmh&&a.framesoh&&(b=a.framesmh,w=a.framesoh);var g=[],x=Math.max(3,e.info.mainhand.speed);a.framesoh&&(x=Math.max(x,e.info.offhand.speed)),x=Math.max(1.2*x,x+.5);for(var _=Math.floor(a.fpa)+a.fpadelta;_>=1;_-=1){var y;if((y=Math.max(1,a.fpa/(_+1-a.fpadelta)/a.dspeed+51e-6))>x&&g.length%3==0)break;g.push([_,y.toFixed(4)])}for(var k=Math.ceil(g.length/3),M=0;M<k;++M)this.body_+="<tr>"+s(g[M]),M+k<g.length&&(this.body_+="<td></td>"+s(g[M+k])),M+k+k<g.length&&(this.body_+="<td></td>"+s(g[M+k+k])),this.body_+="</tr>";this.body_+="</table><p>"}}},r.skill_formatObject=a,r.skill_processInfo=function(e,f){function d(e){return i(e,h,f.affix,f.params)}var l={},p=[],c=(f=f||{}).notip,h=f.stats||r.getStats(),m=new t,u=[];$.each(e,function(e,i){function v(e,a){return a?v(a,e%a):e}if(i)if(l[e]={},"object"!=typeof i)"number"==typeof i?results[e].value=i:c||(l[e].text=i);else if(i.sum)p.push(e);else if(void 0!==i.cooldown&&void 0!==i.duration){var b=d(i.duration),w=d(i.cooldown);(F=i.skill||f.skill&&f.skill[0])&&(w-=h["skill_"+r.charClass+"_"+F+"_cooldown"]||0),w-=h.cdrint||0,i.cdr&&(w*=1-.01*d(i.cdr)),S=(w=Math.max(.5,w*(1-.01*(h.cdr||0))))<=.01?100:Math.min(100,100*b/(w+(i.after?b:0))),l[e].value=S,c||(l[e].text=r.formatNumber(S,0,1e4)+"%",(O=new t(e,l[e].text)).add(i.tip),O.line("Duration: {0} seconds",s(b,0,"white")),O.line("Cooldown: {0} seconds",s(w,2,"white")),i.after?(O.line("Downtime: {0}",s(100-S,2,"white","%")),O.line("Cooldown does not start until the effect expires.")):O.line("Downtime: {0} ({1} seconds)",s(100-S,2,"white","%"),s(Math.max(0,w-b),2,"white")),l[e].tip=O.html())}else if(void 0!==i.cooldown){if(!(w=d(i.cooldown)))return void delete l[e];(F=i.skill||f.skill&&f.skill[0])&&(w-=h["skill_"+r.charClass+"_"+F+"_cooldown"]||0),w-=h.cdrint||0,i.cdr&&(w*=1-.01*d(i.cdr)),w=Math.max(.5,w*(1-.01*(h.cdr||0))),l[e].value=w,c||(l[e].text=o("{0} seconds").format(parseFloat(w.toFixed(2))))}else if(void 0!==i.duration)b=d(i.duration),l[e].value=b,c||(l[e].text=o("{0} seconds").format(parseFloat(b.toFixed(2))));else if(void 0!==i.cost){var g=i.resource||r.classes[r.charClass].resources[0],x=d(i.cost),_=x,y={},k={};if(x*=1-.01*(h["rcr_"+g]||0),i.rcr)if("object"==typeof i.rcr)for(var M in i.rcr)(S=d(i.rcr[M]))&&(x*=1-.01*S,c||(h.affixes[M]&&(M=h.getAffixSource(M)),y[r.sourceNames[M]||M]=S));else{var S;(S=d(i.rcr))&&(x*=1-.01*S,c||(y[o("Unknown")]=S))}if(f.skill&&f.skill[0]){var F=r.skilltips[r.charClass][f.skill[0]];F&&"fir"===F.elements[f.skill[1]]&&(x*=1-.01*(h.leg_cindercoat||0),!c&&h.leg_cindercoat&&h.affixes.leg_cindercoat&&(y[r.sourceNames[h.getAffixSource("leg_cindercoat")]]=h.leg_cindercoat))}var A=i.skill||f.skill&&f.skill[0];if(A&&(M="skill_"+r.charClass+"_"+A+"_cost",h[M]&&(x=Math.max(0,x-(h[M]||0)),!c&&h[M]&&(k[r.sourceNames[M]||M]=h[M]))),x=Math.max(0,x-(h.rcrint||0)),!c&&h.sources.rcrint)for(var M in h.sources.rcrint)r.sourceNames[M]&&(k[r.sourceNames[M]]=h.sources.rcrint[M]);if(0===x)return void delete l[e];if(!c){var P=[s(_,2,"white")],N=[o("Base cost: {0}").format(s(_,2,"white"))];if(h["rcr_"+g]){j=h["rcr_"+g]>0?"green":"red",P.push(s(1-.01*h["rcr_"+g],4,j));var C=h["rcr_"+g]===h.rcr?"rcr":"rcr_"+g;N.push("{0}: {1}".format(r.stats[C].name,s(-h["rcr_"+g],2,j,"+%")))}for(var M in y)j=y[M]>0?"green":"red",P.push(s(1-.01*y[M],4,j)),N.push("{0}: {1}".format(M,s(-y[M],2,j,"+%")));P=P.join(" &#215; ");for(var M in k){var j=k[M]>0?"green":"red";P+=(k[M]>0?" - ":" + ")+s(Math.abs(k[M]),2,j),N.push("{0}: {1}".format(M,s(-k[M],2,j,"+")))}}if(i.speed||i.fpa){var D,B,I=(d(i.speed)||1)*(1+.01*d(i.ias));if(i.fpa?(D=60/(B=i.slowest?r.calcFramesFull(i.fpa,i.weapon,!0,I,i.round,h):r.calcFramesFull(i.fpa,i.weapon,I,i.round,void 0,h)).frames,x*=i.fpa/60):D=I*(i.weapon?h.info[i.weapon].speed:h.info.aps),l[e].value=x*D,!c&&(l[e].text=o("{0} {1} per second").format(parseFloat((x*D).toFixed(2)),r.resources[g]),i.fpa)){(O=new t(e,l[e].text)).add(i.tip),O.line("Cost per tick: {0} {1}",s(x,2,"white"),r.resources[g]);var $=v(60,i.fpa);Object.keys(k).length&&(P="("+P+")"),i.fpa>$&&(P+=" &#215; "+s(i.fpa/$,0,"white")),P+=" / "+s(60/$,0,"white"),O.line("Formula: {0}",P),N.forEach(function(e){O.line(!1,e)}),O.line(!1,"Base tick rate factor: {0}",s(i.fpa/$,0,"white")+" / "+s(60/$,0,"white")),O.line("Breakpoint: {0} frames ({1} APS)",B.frames,s(D,2,"white")),l[e].tip=O.html(),i.bp&&(m.line("{0}: {1} frames ({2} APS)",o("Tick rate"),s(B.frames,0,"white"),s(D,2,"white")),B.dps=!1,m.breakpoints(h,B),u.push(B.frames))}}else l[e].value=x,c||(l[e].text=o(i.persecond?"{0} {1} per second":"{0} {1}").format(parseFloat(x.toFixed(2)),r.resources[g]),(O=new t(e,l[e].text)).add(i.tip),O.line("Formula: {0}",P),N.forEach(function(e){O.line(!1,e)}),l[e].tip=O.html())}else if(void 0!==i.value)"number"==typeof i.value?(l[e].value=i.value,c||(l[e].text=r.formatNumber(i.value,0,1e4))):c||(l[e].text=o(i.value)),i.tip&&!c&&(l[e].tip=new t(e,l[e].text).add(i.tip).html());else{var E=a(i,f);if(!E)return void delete l[e];if(l[e].value=E.value,!c){l[e].text=r.formatNumber(E.value,0,1e4);var O=new t(!0===i.total?e:o("Average {0}").format(o(e)),l[e].text);O.add(i.tip),!i.weapon&&h.info.mainhand&&h.info.offhand&&O.line("Alternates weapons"),i.thorns||!0===i.total||(i.nocrit?O.line("Damage range: {0}",n(E.base.min*E.total_factor*(1+E.chc*E.chd),E.base.max*E.total_factor*(1+E.chc*E.chd),"white")):!i.weapon&&h.info.mainhand&&h.info.offhand?(O.line("Mainhand white damage: {0}",n(h.info.mainhand.wpnbase.min*E.total_factor,h.info.mainhand.wpnbase.max*E.total_factor,"white")),O.line("Offhand white damage: {0}",n(h.info.offhand.wpnbase.min*E.total_factor,h.info.offhand.wpnbase.max*E.total_factor,"white")),E.bonus_chc&&O.line("Critical chance: {0}",s(100*E.chc,2,"green","%")),O.line("Mainhand critical damage: {0}",n(h.info.mainhand.wpnbase.min*E.total_factor*(1+E.chd),h.info.mainhand.wpnbase.max*E.total_factor*(1+E.chd),"white")),O.line("Offhand critical damage: {0}",n(h.info.offhand.wpnbase.min*E.total_factor*(1+E.chd),h.info.offhand.wpnbase.max*E.total_factor*(1+E.chd),"white"))):(O.line("White damage: {0}",n(E.base.min*E.total_factor,E.base.max*E.total_factor,"white")),E.bonus_chc&&O.line("Critical chance: {0}",s(100*E.chc,2,"green","%")),O.line("Critical damage: {0}",n(E.base.min*E.total_factor*(1+E.chd),E.base.max*E.total_factor*(1+E.chd),"white")))),"number"==typeof i.total&&O.line("Extra damage: {0}",s(.5*(E.base.min+E.base.max)*E.extra_factor*(1+E.chc*E.chd),0,"white")),O.line(o("Formula: ")+'<span class="d3-color-gray">'+o(i.thorns?"[Thorns]":"[Weapon]")+"</span>"+(i.nocrit||i.total?" &#215; "+s(1+E.chc*E.chd,2):"")+E.factors.map(function(e){return e.divide?" / "+s(e.divide):" &#215; "+s(e.factor,2)}).join("")),i.thorns?O.line(!1,"Thorns damage: {0}",s(h.thorns||0,0,"white")):("offhand"!==i.weapon&&(i.avg?O.line(!1,"Average main hand damage: {0}",s(.5*(h.info.mainhand.wpnbase.min+h.info.mainhand.wpnbase.max),0,"white")):O.line(!1,"Main hand damage: {0}",n(h.info.mainhand.wpnbase.min,h.info.mainhand.wpnbase.max,"white"))),"mainhand"!==i.weapon&&h.info.offhand&&O.line(!1,"Off hand damage: {0}",n(h.info.offhand.wpnbase.min,h.info.offhand.wpnbase.max,"white"))),E.chd&&(i.nocrit||i.total?O.line(!1,"Critical multiplier: {0}",s(1,0,"white")+" + "+s(E.chc,2,"green")+" &#215; "+s(E.chd,2,"green")):O.line(!1,"Critical damage: {0}",s(100*E.chd,1,"white","%"))),E.factors.forEach(function(e){var a=[];if(e.divide)a.push(s(1,0,"white")+" / "+s(e.divide));else if(void 0!==e.percent)if("number"==typeof e.percent)e.percent&&a.push(s(e.percent,2,"green","%"));else for(var t in e.percent)a.push(s(e.percent[t],2,"green","%")+' <span class="d3-color-gray">('+o(t)+")</span>");else a.push(s(e.factor,2));if(e.extra)for(var n=0;n<e.extra.length;++n)"object"==typeof e.extra[n]?a.push(s(e.extra[n][0],2,"green","%")+" &#215; "+s(e.extra[n][1],2,"green")):a.push(s(e.extra[n],2,"green","%"));O.line(!1,o(e.name)+": "+a.join(" + "))}),l[e].tip=O.html()}}});for(var v={};p.length;){for(var b=[],w=0;w<p.length;++w){var g=p[w],x=!0,_=0,y=new t,k=new t,M=[],S="sequence"===e[g].sum,F=0;if($.each(e[g],function(a,t){if(l[a]||"object"==typeof t&&"tip"!=a){var n=a;if("object"==typeof t&&"tip"!=a&&(n=t.src||a),l[n]&&void 0!==l[n].value||"object"==typeof t&&t.value){t="object"==typeof t?$.extend({},t):{speed:t};var i=o(t.name||a)+": ",f=1;t.count&&(t.count=d(t.count),t.count&&1!=t.count&&(f*=t.count,i+=parseFloat(t.count.toFixed(2))+"x "));var p=t.value?d(t.value):l[n].value;if(i+=s(p,0,"white"),t.factor&&(t.factor=d(t.factor),1!=t.factor&&(f*=t.factor,i+=" &#215; "+s(t.factor,2,"white"))),t.divide&&(t.divide=d(t.divide),1!=t.divide&&(f/=t.divide,i+=" / "+s(t.divide,0,"white"))),y.line(i),t.cd&&(t.cd=d(t.cd),!1!==t.cdr&&(t.cd-=h.cdrint||0,t.cd*=1-.01*(h.cdr||0)),t.cd=Math.max(.5,t.cd),y.line(!1,"Cooldown: {0} seconds",s(t.cd,2,"white")),f/=t.cd),t.pet){var m=void 0,u=t.speed?d(t.speed)*h.info.mainhand.speed:t.aps?d(t.aps):1,b=h.petias||0;!1===t.area&&(b=h.leg_taskerandtheo||0);var w=1+.01*d(t.ias)+.01*b;u*=w,"number"==typeof t.pet&&(u=60/(m=6*Math.ceil(Math.floor(t.pet/u)/6))),c||(N='<span class="d3-color-white">'+r.formatNumber(u,2,1e4)+"</span>",m?(y.line(!1,"Speed: {0} ({1} frames)",N,s(m,0,"white")),t.nobp||(M.push(m),k.line("{0}: {1} frames ({2} APS)",o(t.name||a),s(m,0,"white"),N),t.speed&&k.breakpoints(h,{pet:!0,fpa:t.pet,frames:m,speed:w*d(t.speed)}))):y.line(!1,"Speed: {0}",N)),S?F+=1/u:t.cd?f*=Math.min(1,t.cd*u):f*=u}else if(t.speed||t.aps||t.fpa){var g,u=1;if(t.speed?(g="object"==typeof e[n]&&e[n].weapon,dspeed=d(t.speed),u=dspeed*(g?h.info[g].speed:h.info.aps)):t.aps&&(u=d(t.aps)),t.ias){var A=1+.01*d(t.ias);u*=A,dspeed&&(dspeed*=A)}var P=void 0;if(t.fpa&&(u=60/(P=t.speed?r.calcFramesFull(t.fpa,g,!!t.slowest,dspeed,t.round,h):{frames:Math.floor(t.fpa/u)+("up"===t.round?1:0)}).frames),!c){var N='<span class="d3-color-white">'+r.formatNumber(u,2,1e4)+"</span>";if(P){if(y.line(!1,"Speed: {0} ({1} frames)",N,s(P.frames,1,"white")),!t.nobp&&(M.push(P.frames),k.line("{0}: {1} frames ({2} APS)",o(t.name||a),s(P.frames,0,"white"),N),t.speed&&(P.sequence=S,k.breakpoints(h,P)),t.total)){var C;if(P.framesmh&&P.framesoh){var j=Math.floor(t.total/(P.framesmh+P.framesoh)),D=t.total-j*(P.framesmh+P.framesoh);C=2*j,D&&(C+=(D>P.framesmh?1:.5)+(D>P.framesoh?1:.5))}else C=Math.ceil(t.total/P.frames);y.line(!1,"Total ticks: {0} ({1} damage)",s(C,1,"white"),'<span class="d3-color-green">'+r.formatNumber(p*(f*(t.cd||1))*C,0,1e4)+"</span>")}}else y.line(!1,"Speed: {0}",N)}S?F+=1/u:t.cd?f*=Math.min(1,t.cd*u):f*=u}else t.refspeed&&(void 0===v[t.refspeed]?x=!1:(t.cd?f*=Math.min(1,t.cd/v[t.refspeed]):f/=v[t.refspeed],y.line(!1,"Speed: {0}",s(1/v[t.refspeed],2,"white"))));_+=p*f}else x=!1}}),S&&x&&(F>.1?(_/=F,v[g]=F,(A=new t).line("Sequence length: {0} seconds",s(F,2,"white")),y=A.add(y)):x=!1),x){if(l[g].value=_,!c){l[g].text=r.formatNumber(_,0,1e4);var A=new t(o(g).replace("DPS",o("Damage Per Second")),l[g].text);A.add(e[g].tip),A.add(y),l[g].tip=A.html(),e[g].nobp||(m.add(k),u=u.concat(M))}}else b.push(g)}if(b.length>=p.length)break;p=b}for(w=0;w<p.length;++w)delete l[p[w]];if(u.length&&!c){for(var P=[],N=0;N<u.length;++N)P.push(o("{0} frames").format(u[N]));var C="Breakpoint"+(P.length>1?"s":""),P=P.join(" / ");m.header(C,P),l[C]={value:u,text:P,tip:m.html()}}return l}}();