function Quaternion(t,i,m,r){this.load(t,i,m,r)}J3DIHasCSSMatrix=!1,J3DIHasCSSMatrixCopy=!1,J3DIMatrix4=function(t){if(this.$matrix=J3DIHasCSSMatrix?new WebKitCSSMatrix:new Object,"object"==typeof t){if("length"in t&&t.length>=16)return void this.load(t);if(t instanceof J3DIMatrix4)return void this.load(t)}this.makeIdentity()},J3DIMatrix4.prototype.load=function(){if(1==arguments.length&&"object"==typeof arguments[0]){var t;if(arguments[0]instanceof J3DIMatrix4)return t=arguments[0].$matrix,this.$matrix.m11=t.m11,this.$matrix.m12=t.m12,this.$matrix.m13=t.m13,this.$matrix.m14=t.m14,this.$matrix.m21=t.m21,this.$matrix.m22=t.m22,this.$matrix.m23=t.m23,this.$matrix.m24=t.m24,this.$matrix.m31=t.m31,this.$matrix.m32=t.m32,this.$matrix.m33=t.m33,this.$matrix.m34=t.m34,this.$matrix.m41=t.m41,this.$matrix.m42=t.m42,this.$matrix.m43=t.m43,void(this.$matrix.m44=t.m44);if(t=arguments[0],"length"in t&&t.length>=16)return this.$matrix.m11=t[0],this.$matrix.m12=t[1],this.$matrix.m13=t[2],this.$matrix.m14=t[3],this.$matrix.m21=t[4],this.$matrix.m22=t[5],this.$matrix.m23=t[6],this.$matrix.m24=t[7],this.$matrix.m31=t[8],this.$matrix.m32=t[9],this.$matrix.m33=t[10],this.$matrix.m34=t[11],this.$matrix.m41=t[12],this.$matrix.m42=t[13],this.$matrix.m43=t[14],void(this.$matrix.m44=t[15])}this.makeIdentity()},J3DIMatrix4.prototype.getAsArray=function(){return[this.$matrix.m11,this.$matrix.m12,this.$matrix.m13,this.$matrix.m14,this.$matrix.m21,this.$matrix.m22,this.$matrix.m23,this.$matrix.m24,this.$matrix.m31,this.$matrix.m32,this.$matrix.m33,this.$matrix.m34,this.$matrix.m41,this.$matrix.m42,this.$matrix.m43,this.$matrix.m44]},J3DIMatrix4.prototype.getAsFloat32Array=function(){if(J3DIHasCSSMatrixCopy){var t=new Float32Array(16);return this.$matrix.copy(t),t}return new Float32Array(this.getAsArray())},J3DIMatrix4.prototype.writeToArray=function(t,i){t[i+0]=this.$matrix.m11,t[i+1]=this.$matrix.m12,t[i+2]=this.$matrix.m13,t[i+3]=this.$matrix.m14,t[i+4]=this.$matrix.m21,t[i+5]=this.$matrix.m22,t[i+6]=this.$matrix.m23,t[i+7]=this.$matrix.m24,t[i+8]=this.$matrix.m31,t[i+9]=this.$matrix.m32,t[i+10]=this.$matrix.m33,t[i+11]=this.$matrix.m34,t[i+12]=this.$matrix.m41,t[i+13]=this.$matrix.m42,t[i+14]=this.$matrix.m43,t[i+15]=this.$matrix.m44},J3DIMatrix4.prototype.setUniform=function(t,i,m){void 0==J3DIMatrix4.setUniformArray&&(J3DIMatrix4.setUniformWebGLArray=new Float32Array(16),J3DIMatrix4.setUniformArray=new Array(16)),J3DIHasCSSMatrixCopy?this.$matrix.copy(J3DIMatrix4.setUniformWebGLArray):(J3DIMatrix4.setUniformArray[0]=this.$matrix.m11,J3DIMatrix4.setUniformArray[1]=this.$matrix.m12,J3DIMatrix4.setUniformArray[2]=this.$matrix.m13,J3DIMatrix4.setUniformArray[3]=this.$matrix.m14,J3DIMatrix4.setUniformArray[4]=this.$matrix.m21,J3DIMatrix4.setUniformArray[5]=this.$matrix.m22,J3DIMatrix4.setUniformArray[6]=this.$matrix.m23,J3DIMatrix4.setUniformArray[7]=this.$matrix.m24,J3DIMatrix4.setUniformArray[8]=this.$matrix.m31,J3DIMatrix4.setUniformArray[9]=this.$matrix.m32,J3DIMatrix4.setUniformArray[10]=this.$matrix.m33,J3DIMatrix4.setUniformArray[11]=this.$matrix.m34,J3DIMatrix4.setUniformArray[12]=this.$matrix.m41,J3DIMatrix4.setUniformArray[13]=this.$matrix.m42,J3DIMatrix4.setUniformArray[14]=this.$matrix.m43,J3DIMatrix4.setUniformArray[15]=this.$matrix.m44,J3DIMatrix4.setUniformWebGLArray.set(J3DIMatrix4.setUniformArray)),t.uniformMatrix4fv(i,m,J3DIMatrix4.setUniformWebGLArray)},J3DIMatrix4.prototype.makeIdentity=function(){this.$matrix.m11=1,this.$matrix.m12=0,this.$matrix.m13=0,this.$matrix.m14=0,this.$matrix.m21=0,this.$matrix.m22=1,this.$matrix.m23=0,this.$matrix.m24=0,this.$matrix.m31=0,this.$matrix.m32=0,this.$matrix.m33=1,this.$matrix.m34=0,this.$matrix.m41=0,this.$matrix.m42=0,this.$matrix.m43=0,this.$matrix.m44=1},J3DIMatrix4.prototype.transpose=function(){var t=this.$matrix.m12;this.$matrix.m12=this.$matrix.m21,this.$matrix.m21=t,t=this.$matrix.m13,this.$matrix.m13=this.$matrix.m31,this.$matrix.m31=t,t=this.$matrix.m14,this.$matrix.m14=this.$matrix.m41,this.$matrix.m41=t,t=this.$matrix.m23,this.$matrix.m23=this.$matrix.m32,this.$matrix.m32=t,t=this.$matrix.m24,this.$matrix.m24=this.$matrix.m42,this.$matrix.m42=t,t=this.$matrix.m34,this.$matrix.m34=this.$matrix.m43,this.$matrix.m43=t},J3DIMatrix4.prototype.invert=function(){if(J3DIHasCSSMatrix)return void(this.$matrix=this.$matrix.inverse());var t=this._determinant4x4();return Math.abs(t)<1e-8?null:(this._makeAdjoint(),this.$matrix.m11/=t,this.$matrix.m12/=t,this.$matrix.m13/=t,this.$matrix.m14/=t,this.$matrix.m21/=t,this.$matrix.m22/=t,this.$matrix.m23/=t,this.$matrix.m24/=t,this.$matrix.m31/=t,this.$matrix.m32/=t,this.$matrix.m33/=t,this.$matrix.m34/=t,this.$matrix.m41/=t,this.$matrix.m42/=t,this.$matrix.m43/=t,void(this.$matrix.m44/=t))},J3DIMatrix4.prototype.translate=function(t,i,m){if("object"==typeof t&&"length"in t){var r=t;t=r[0],i=r[1],m=r[2]}else void 0==t&&(t=0),void 0==i&&(i=0),void 0==m&&(m=0);if(J3DIHasCSSMatrix)return void(this.$matrix=this.$matrix.translate(t,i,m));var a=new J3DIMatrix4;a.$matrix.m41=t,a.$matrix.m42=i,a.$matrix.m43=m,this.multiply(a)},J3DIMatrix4.prototype.scale=function(t,i,m){if("object"==typeof t&&"length"in t){var r=t;t=r[0],i=r[1],m=r[2]}else void 0==t&&(t=1),void 0==m?void 0==i?(i=t,m=t):m=1:void 0==i&&(i=t);if(J3DIHasCSSMatrix)return void(this.$matrix=this.$matrix.scale(t,i,m));var a=new J3DIMatrix4;a.$matrix.m11=t,a.$matrix.m22=i,a.$matrix.m33=m,this.multiply(a)},J3DIMatrix4.prototype.rotate=function(t,i,m,r){if("object"==typeof i&&"length"in i){var a=i;i=a[0],m=a[1],r=a[2]}else if(1==arguments.length)i=0,m=0,r=1;else if(3==arguments.length)return this.rotate(t,1,0,0),this.rotate(i,0,1,0),void this.rotate(m,0,0,1);if(J3DIHasCSSMatrix)return void(this.$matrix=this.$matrix.rotateAxisAngle(i,m,r,t));t=t/180*Math.PI,t/=2;var x=Math.sin(t),$=Math.cos(t),s=x*x,h=Math.sqrt(i*i+m*m+r*r);0==h?(i=0,m=0,r=1):1!=h&&(i/=h,m/=h,r/=h);var e=new J3DIMatrix4;if(1==i&&0==m&&0==r)e.$matrix.m11=1,e.$matrix.m12=0,e.$matrix.m13=0,e.$matrix.m21=0,e.$matrix.m22=1-2*s,e.$matrix.m23=2*x*$,e.$matrix.m31=0,e.$matrix.m32=-2*x*$,e.$matrix.m33=1-2*s,e.$matrix.m14=e.$matrix.m24=e.$matrix.m34=0,e.$matrix.m41=e.$matrix.m42=e.$matrix.m43=0,e.$matrix.m44=1;else if(0==i&&1==m&&0==r)e.$matrix.m11=1-2*s,e.$matrix.m12=0,e.$matrix.m13=-2*x*$,e.$matrix.m21=0,e.$matrix.m22=1,e.$matrix.m23=0,e.$matrix.m31=2*x*$,e.$matrix.m32=0,e.$matrix.m33=1-2*s,e.$matrix.m14=e.$matrix.m24=e.$matrix.m34=0,e.$matrix.m41=e.$matrix.m42=e.$matrix.m43=0,e.$matrix.m44=1;else if(0==i&&0==m&&1==r)e.$matrix.m11=1-2*s,e.$matrix.m12=2*x*$,e.$matrix.m13=0,e.$matrix.m21=-2*x*$,e.$matrix.m22=1-2*s,e.$matrix.m23=0,e.$matrix.m31=0,e.$matrix.m32=0,e.$matrix.m33=1,e.$matrix.m14=e.$matrix.m24=e.$matrix.m34=0,e.$matrix.m41=e.$matrix.m42=e.$matrix.m43=0,e.$matrix.m44=1;else{var n=i*i,o=m*m,f=r*r;e.$matrix.m11=1-2*(o+f)*s,e.$matrix.m12=2*(i*m*s+r*x*$),e.$matrix.m13=2*(i*r*s-m*x*$),e.$matrix.m21=2*(m*i*s-r*x*$),e.$matrix.m22=1-2*(f+n)*s,e.$matrix.m23=2*(m*r*s+i*x*$),e.$matrix.m31=2*(r*i*s+m*x*$),e.$matrix.m32=2*(r*m*s-i*x*$),e.$matrix.m33=1-2*(n+o)*s,e.$matrix.m14=e.$matrix.m24=e.$matrix.m34=0,e.$matrix.m41=e.$matrix.m42=e.$matrix.m43=0,e.$matrix.m44=1}this.multiply(e)},J3DIMatrix4.prototype.multiply=function(t){if(J3DIHasCSSMatrix)return void(this.$matrix=this.$matrix.multiply(t.$matrix));var i=t.$matrix.m11*this.$matrix.m11+t.$matrix.m12*this.$matrix.m21+t.$matrix.m13*this.$matrix.m31+t.$matrix.m14*this.$matrix.m41,m=t.$matrix.m11*this.$matrix.m12+t.$matrix.m12*this.$matrix.m22+t.$matrix.m13*this.$matrix.m32+t.$matrix.m14*this.$matrix.m42,r=t.$matrix.m11*this.$matrix.m13+t.$matrix.m12*this.$matrix.m23+t.$matrix.m13*this.$matrix.m33+t.$matrix.m14*this.$matrix.m43,a=t.$matrix.m11*this.$matrix.m14+t.$matrix.m12*this.$matrix.m24+t.$matrix.m13*this.$matrix.m34+t.$matrix.m14*this.$matrix.m44,x=t.$matrix.m21*this.$matrix.m11+t.$matrix.m22*this.$matrix.m21+t.$matrix.m23*this.$matrix.m31+t.$matrix.m24*this.$matrix.m41,$=t.$matrix.m21*this.$matrix.m12+t.$matrix.m22*this.$matrix.m22+t.$matrix.m23*this.$matrix.m32+t.$matrix.m24*this.$matrix.m42,s=t.$matrix.m21*this.$matrix.m13+t.$matrix.m22*this.$matrix.m23+t.$matrix.m23*this.$matrix.m33+t.$matrix.m24*this.$matrix.m43,h=t.$matrix.m21*this.$matrix.m14+t.$matrix.m22*this.$matrix.m24+t.$matrix.m23*this.$matrix.m34+t.$matrix.m24*this.$matrix.m44,e=t.$matrix.m31*this.$matrix.m11+t.$matrix.m32*this.$matrix.m21+t.$matrix.m33*this.$matrix.m31+t.$matrix.m34*this.$matrix.m41,n=t.$matrix.m31*this.$matrix.m12+t.$matrix.m32*this.$matrix.m22+t.$matrix.m33*this.$matrix.m32+t.$matrix.m34*this.$matrix.m42,o=t.$matrix.m31*this.$matrix.m13+t.$matrix.m32*this.$matrix.m23+t.$matrix.m33*this.$matrix.m33+t.$matrix.m34*this.$matrix.m43,f=t.$matrix.m31*this.$matrix.m14+t.$matrix.m32*this.$matrix.m24+t.$matrix.m33*this.$matrix.m34+t.$matrix.m34*this.$matrix.m44,y=t.$matrix.m41*this.$matrix.m11+t.$matrix.m42*this.$matrix.m21+t.$matrix.m43*this.$matrix.m31+t.$matrix.m44*this.$matrix.m41,p=t.$matrix.m41*this.$matrix.m12+t.$matrix.m42*this.$matrix.m22+t.$matrix.m43*this.$matrix.m32+t.$matrix.m44*this.$matrix.m42,u=t.$matrix.m41*this.$matrix.m13+t.$matrix.m42*this.$matrix.m23+t.$matrix.m43*this.$matrix.m33+t.$matrix.m44*this.$matrix.m43,I=t.$matrix.m41*this.$matrix.m14+t.$matrix.m42*this.$matrix.m24+t.$matrix.m43*this.$matrix.m34+t.$matrix.m44*this.$matrix.m44;this.$matrix.m11=i,this.$matrix.m12=m,this.$matrix.m13=r,this.$matrix.m14=a,this.$matrix.m21=x,this.$matrix.m22=$,this.$matrix.m23=s,this.$matrix.m24=h,this.$matrix.m31=e,this.$matrix.m32=n,this.$matrix.m33=o,this.$matrix.m34=f,this.$matrix.m41=y,this.$matrix.m42=p,this.$matrix.m43=u,this.$matrix.m44=I},J3DIMatrix4.prototype.divide=function(t){this.$matrix.m11/=t,this.$matrix.m12/=t,this.$matrix.m13/=t,this.$matrix.m14/=t,this.$matrix.m21/=t,this.$matrix.m22/=t,this.$matrix.m23/=t,this.$matrix.m24/=t,this.$matrix.m31/=t,this.$matrix.m32/=t,this.$matrix.m33/=t,this.$matrix.m34/=t,this.$matrix.m41/=t,this.$matrix.m42/=t,this.$matrix.m43/=t,this.$matrix.m44/=t},J3DIMatrix4.prototype.ortho=function(t,i,m,r,a,x){var $=(t+i)/(t-i),s=(r+m)/(r-m),h=(x+a)/(x-a),e=new J3DIMatrix4;e.$matrix.m11=2/(t-i),e.$matrix.m12=0,e.$matrix.m13=0,e.$matrix.m14=0,e.$matrix.m21=0,e.$matrix.m22=2/(r-m),e.$matrix.m23=0,e.$matrix.m24=0,e.$matrix.m31=0,e.$matrix.m32=0,e.$matrix.m33=-2/(x-a),e.$matrix.m34=0,e.$matrix.m41=$,e.$matrix.m42=s,e.$matrix.m43=h,e.$matrix.m44=1,this.multiply(e)},J3DIMatrix4.prototype.frustum=function(t,i,m,r,a,x){var $=new J3DIMatrix4,s=(i+t)/(i-t),h=(r+m)/(r-m),e=-(x+a)/(x-a),n=-(2*x*a)/(x-a);$.$matrix.m11=2*a/(i-t),$.$matrix.m12=0,$.$matrix.m13=0,$.$matrix.m14=0,$.$matrix.m21=0,$.$matrix.m22=2*a/(r-m),$.$matrix.m23=0,$.$matrix.m24=0,$.$matrix.m31=s,$.$matrix.m32=h,$.$matrix.m33=e,$.$matrix.m34=-1,$.$matrix.m41=0,$.$matrix.m42=0,$.$matrix.m43=n,$.$matrix.m44=0,this.multiply($)},J3DIMatrix4.prototype.perspective=function(t,i,m,r){var a=Math.tan(t*Math.PI/360)*m,x=-a,$=i*x,s=i*a;this.frustum($,s,x,a,m,r)},J3DIMatrix4.prototype.lookat=function(t,i,m,r,a,x,$,s,h){if("object"==typeof m&&"length"in m){var e=m;$=e[0],s=e[1],h=e[2],e=i,r=e[0],a=e[1],x=e[2],e=t,t=e[0],i=e[1],m=e[2]}var n=new J3DIMatrix4,o=t-r,f=i-a,y=m-x,p=Math.sqrt(o*o+f*f+y*y);p&&(o/=p,f/=p,y/=p);var u=$,I=s,M=h;xx=I*y-M*f,xy=-u*y+M*o,xz=u*f-I*o,u=f*xz-y*xy,I=-o*xz+y*xx,u=o*xy-f*xx,p=Math.sqrt(xx*xx+xy*xy+xz*xz),p&&(xx/=p,xy/=p,xz/=p),p=Math.sqrt(u*u+I*I+M*M),p&&(u/=p,I/=p,M/=p),n.$matrix.m11=xx,n.$matrix.m12=xy,n.$matrix.m13=xz,n.$matrix.m14=0,n.$matrix.m21=u,n.$matrix.m22=I,n.$matrix.m23=M,n.$matrix.m24=0,n.$matrix.m31=o,n.$matrix.m32=f,n.$matrix.m33=y,n.$matrix.m34=0,n.$matrix.m41=0,n.$matrix.m42=0,n.$matrix.m43=0,n.$matrix.m44=1,n.translate(-t,-i,-m),this.multiply(n)},J3DIMatrix4.prototype.decompose=function(t,m,r,a,x){if(0==this.$matrix.m44)return!1;var $,s,h,e,n,$=void 0!=t&&"length"in t?t:new J3DIVector3,s=void 0!=m&&"length"in m?m:new J3DIVector3,h=void 0!=r&&"length"in r?r:new J3DIVector3,e=void 0!=a&&"length"in a?a:new J3DIVector3,n=void 0!=x&&"length"in x?x:new Array(4),o=new J3DIMatrix4(this);o.divide(o.$matrix.m44);var f=new J3DIMatrix4(o);if(f.$matrix.m14=0,f.$matrix.m24=0,f.$matrix.m34=0,f.$matrix.m44=1,0==f._determinant4x4())return!1;if(0!=o.$matrix.m14||0!=o.$matrix.m24||0!=o.$matrix.m34){var y=[o.$matrix.m14,o.$matrix.m24,o.$matrix.m34,o.$matrix.m44],p=new J3DIMatrix4(f);p.invert();var u=new J3DIMatrix4(p);u.transpose(),u.multVecMatrix(n,y),o.$matrix.m14=o.$matrix.m24=o.$matrix.m34=0,o.$matrix.m44=1}else n[0]=n[1]=n[2]=0,n[3]=1;$[0]=o.$matrix.m41,o.$matrix.m41=0,$[1]=o.$matrix.m42,o.$matrix.m42=0,$[2]=o.$matrix.m43,o.$matrix.m43=0;var I=new J3DIVector3(o.$matrix.m11,o.$matrix.m12,o.$matrix.m13),M=new J3DIVector3(o.$matrix.m21,o.$matrix.m22,o.$matrix.m23),c=new J3DIVector3(o.$matrix.m31,o.$matrix.m32,o.$matrix.m33);h[0]=I.vectorLength(),I.divide(h[0]),e[0]=I.dot(M),M.combine(I,1,-e[0]),h[1]=M.vectorLength(),M.divide(h[1]),e[0]/=h[1],e[1]=M.dot(c),c.combine(I,1,-e[1]),e[2]=M.dot(c),c.combine(M,1,-e[2]),h[2]=c.vectorLength(),c.divide(h[2]),e[1]/=h[2],e[2]/=h[2];var D=new J3DIVector3(M);if(D.cross(c),I.dot(D)<0)for(i=0;i<3;i++)h[i]*=-1,row[0][i]*=-1,row[1][i]*=-1,row[2][i]*=-1;s[1]=Math.asin(-I[2]),0!=Math.cos(s[1])?(s[0]=Math.atan2(M[2],c[2]),s[2]=Math.atan2(I[1],I[0])):(s[0]=Math.atan2(-c[0],M[1]),s[2]=0);var J=180/Math.PI;return s[0]*=J,s[1]*=J,s[2]*=J,!0},J3DIMatrix4.prototype._determinant2x2=function(t,i,m,r){return t*r-i*m},J3DIMatrix4.prototype._determinant3x3=function(t,i,m,r,a,x,$,s,h){return t*this._determinant2x2(a,x,s,h)-r*this._determinant2x2(i,m,s,h)+$*this._determinant2x2(i,m,a,x)},J3DIMatrix4.prototype._determinant4x4=function(){var t=this.$matrix.m11,i=this.$matrix.m12,m=this.$matrix.m13,r=this.$matrix.m14,a=this.$matrix.m21,x=this.$matrix.m22,$=this.$matrix.m23,s=this.$matrix.m24,h=this.$matrix.m31,e=this.$matrix.m32,n=this.$matrix.m33,o=this.$matrix.m34,f=this.$matrix.m41,y=this.$matrix.m42,p=this.$matrix.m43,u=this.$matrix.m44;return t*this._determinant3x3(x,e,y,$,n,p,s,o,u)-i*this._determinant3x3(a,h,f,$,n,p,s,o,u)+m*this._determinant3x3(a,h,f,x,e,y,s,o,u)-r*this._determinant3x3(a,h,f,x,e,y,$,n,p)},J3DIMatrix4.prototype._makeAdjoint=function(){var t=this.$matrix.m11,i=this.$matrix.m12,m=this.$matrix.m13,r=this.$matrix.m14,a=this.$matrix.m21,x=this.$matrix.m22,$=this.$matrix.m23,s=this.$matrix.m24,h=this.$matrix.m31,e=this.$matrix.m32,n=this.$matrix.m33,o=this.$matrix.m34,f=this.$matrix.m41,y=this.$matrix.m42,p=this.$matrix.m43,u=this.$matrix.m44;this.$matrix.m11=this._determinant3x3(x,e,y,$,n,p,s,o,u),this.$matrix.m21=-this._determinant3x3(a,h,f,$,n,p,s,o,u),this.$matrix.m31=this._determinant3x3(a,h,f,x,e,y,s,o,u),this.$matrix.m41=-this._determinant3x3(a,h,f,x,e,y,$,n,p),this.$matrix.m12=-this._determinant3x3(i,e,y,m,n,p,r,o,u),this.$matrix.m22=this._determinant3x3(t,h,f,m,n,p,r,o,u),this.$matrix.m32=-this._determinant3x3(t,h,f,i,e,y,r,o,u),this.$matrix.m42=this._determinant3x3(t,h,f,i,e,y,m,n,p),this.$matrix.m13=this._determinant3x3(i,x,y,m,$,p,r,s,u),this.$matrix.m23=-this._determinant3x3(t,a,f,m,$,p,r,s,u),this.$matrix.m33=this._determinant3x3(t,a,f,i,x,y,r,s,u),this.$matrix.m43=-this._determinant3x3(t,a,f,i,x,y,m,$,p),this.$matrix.m14=-this._determinant3x3(i,x,e,m,$,n,r,s,o),this.$matrix.m24=this._determinant3x3(t,a,h,m,$,n,r,s,o),this.$matrix.m34=-this._determinant3x3(t,a,h,i,x,e,r,s,o),this.$matrix.m44=this._determinant3x3(t,a,h,i,x,e,m,$,n)},J3DIVector3=function(t,i,m){this.load(t,i,m)},J3DIVector3.prototype.load=function(t,i,m){"object"==typeof t&&"length"in t?(this[0]=t[0],this[1]=t[1],this[2]=t[2]):"number"==typeof t?(this[0]=t,this[1]=i,this[2]=m):(this[0]=0,this[1]=0,this[2]=0)},J3DIVector3.prototype.getAsArray=function(){return[this[0],this[1],this[2]]},J3DIVector3.prototype.getAsFloat32Array=function(){return new Float32Array(this.getAsArray())},J3DIVector3.prototype.vectorLength=function(){return Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2])},J3DIVector3.prototype.divide=function(t){this[0]/=t,this[1]/=t,this[2]/=t},J3DIVector3.prototype.cross=function(t){this[0]=this[1]*t[2]-this[2]*t[1],this[1]=-this[0]*t[2]+this[2]*t[0],this[2]=this[0]*t[1]-this[1]*t[0]},J3DIVector3.prototype.dot=function(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]},J3DIVector3.prototype.combine=function(t,i,m){this[0]=i*this[0]+m*t[0],this[1]=i*this[1]+m*t[1],this[2]=i*this[2]+m*t[2]},J3DIVector3.prototype.multVecMatrix=function(t){var i=this[0],m=this[1],r=this[2];this[0]=t.$matrix.m41+i*t.$matrix.m11+m*t.$matrix.m21+r*t.$matrix.m31,this[1]=t.$matrix.m42+i*t.$matrix.m12+m*t.$matrix.m22+r*t.$matrix.m32,this[2]=t.$matrix.m43+i*t.$matrix.m13+m*t.$matrix.m23+r*t.$matrix.m33;var a=t.$matrix.m44+i*t.$matrix.m14+m*t.$matrix.m24+r*t.$matrix.m34;1!=a&&0!=a&&(this[0]/=a,this[1]/=a,this[2]/=a)},J3DIVector3.prototype.toString=function(){return"["+this[0]+","+this[1]+","+this[2]+"]"},Quaternion.prototype.load=function(t,i,m,r){"object"==typeof t&&"length"in t||t instanceof Quaternion?(this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3]):"number"==typeof t?(this[0]=t,this[1]=i,this[2]=m,this[3]=r):(this[0]=0,this[1]=0,this[2]=0,this[3]=1)},Quaternion.prototype.slerp=function(t,i){var m=this[0]*t[0]+this[1]*t[1]+this[2]*t[2]+this[3]*t[3];if(-.99999999>m||m>.99999999)return new Quaternion(this);var r=Math.acos(m),a=1/Math.sin(r),x=a*Math.sin((1-i)*r),$=a*Math.sin(i*r);return new Quaternion(this[0]*x+t[0]*$,this[1]*x+t[1]*$,this[2]*x+t[2]*$,this[3]*x+t[3]*$)},Quaternion.prototype.matrix=function(){var t=this[0],i=this[1],m=this[2],r=this[3];return new J3DIMatrix4([1-2*(i*i+m*m),2*(t*i+m*r),2*(m*t-i*r),0,2*(t*i-m*r),1-2*(m*m+t*t),2*(i*m+t*r),0,2*(m*t+i*r),2*(i*m-t*r),1-2*(i*i+t*t),0,0,0,0,1])};